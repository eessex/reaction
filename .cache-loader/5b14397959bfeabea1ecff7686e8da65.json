{"remainingRequest":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js??ref--5-1!/Users/eve/development/reaction/src/Components/Onboarding/Steps/Genes/SuggestedGenes.tsx","dependencies":[{"path":"/Users/eve/development/reaction/src/Components/Onboarding/Steps/Genes/SuggestedGenes.tsx","mtime":1522865193000},{"path":"/Users/eve/development/reaction/.babelrc","mtime":1527877289000},{"path":"/Users/eve/development/reaction/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js","mtime":1509489566000}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SuggestedGenes = void 0;\n\nvar React = _interopRequireWildcard(require(\"react\"));\n\nvar _reactRelay = require(\"react-relay\");\n\nvar _Events = _interopRequireDefault(require(\"../../../../Utils/Events\"));\n\nvar _track = require(\"../../../../Utils/track\");\n\nvar _ReplaceTransition = _interopRequireDefault(require(\"../../../Animation/ReplaceTransition\"));\n\nvar _Artsy = require(\"../../../Artsy\");\n\nvar _ItemLink = _interopRequireWildcard(require(\"../../ItemLink\"));\n\nvar _graphql, _graphql2, _dec, _class;\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nvar SuggestedGenesContent = (_dec = (0, _track.track)({}, {\n  dispatch: function dispatch(data) {\n    return _Events.default.postEvent(data);\n  }\n}), _dec(_class =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(SuggestedGenesContent, _React$Component);\n\n  function SuggestedGenesContent(props, context) {\n    var _this;\n\n    _classCallCheck(this, SuggestedGenesContent);\n\n    _this = _possibleConstructorReturn(this, (SuggestedGenesContent.__proto__ || Object.getPrototypeOf(SuggestedGenesContent)).call(this, props, context));\n    Object.defineProperty(_assertThisInitialized(_this), \"excludedGeneIds\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_assertThisInitialized(_this), \"followCount\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: 0\n    });\n    _this.excludedGeneIds = new Set(_this.props.suggested_genes.map(function (item) {\n      return item._id;\n    }));\n    return _this;\n  }\n\n  _createClass(SuggestedGenesContent, [{\n    key: \"onGeneFollowed\",\n    value: function onGeneFollowed(gene, store, data) {\n      var suggestedGene = store.get(data.followGene.gene.similar.edges[0].node.__id);\n      this.excludedGeneIds.add(suggestedGene.getValue(\"_id\"));\n      var suggestedGenesRootField = store.get(\"client:root\");\n      var suggestedGenes = suggestedGenesRootField.getLinkedRecords(\"suggested_genes\");\n      var updatedSuggestedGenes = suggestedGenes.map(function (geneItem) {\n        return geneItem.getValue(\"id\") === gene.id ? suggestedGene : geneItem;\n      });\n      suggestedGenesRootField.setLinkedRecords(updatedSuggestedGenes, \"suggested_genes\");\n      this.followCount += 1;\n      this.props.updateFollowCount(this.followCount);\n      this.props.tracking.trackEvent({\n        action: \"Followed Gene\",\n        entity_id: gene._id,\n        entity_slug: gene.id,\n        context_module: \"onboarding recommended\"\n      });\n    }\n  }, {\n    key: \"followedGene\",\n    value: function followedGene(gene) {\n      var _this2 = this;\n\n      this.excludedGeneIds.add(gene._id);\n      (0, _reactRelay.commitMutation)(this.props.relay.environment, {\n        mutation: _graphql || (_graphql = function _graphql() {\n          var node = require(\"../../../../__generated__/SuggestedGenesFollowGeneMutation.graphql\");\n\n          if (node.hash && node.hash !== \"73a7ed7e539207c9a26f3edac371a0b0\") {\n            console.error(\"The definition of 'SuggestedGenesFollowGeneMutation' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data.\");\n          }\n\n          return require(\"../../../../__generated__/SuggestedGenesFollowGeneMutation.graphql\");\n        }),\n        variables: {\n          input: {\n            gene_id: gene.id\n          },\n          excludedGeneIds: Array.from(this.excludedGeneIds)\n        },\n        updater: function updater(store, data) {\n          return _this2.onGeneFollowed(gene, store, data);\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var items = this.props.suggested_genes.map(function (item, index) {\n        return React.createElement(_ItemLink.LinkContainer, {\n          key: \"suggested-genes-\".concat(index)\n        }, React.createElement(_ReplaceTransition.default, {\n          transitionEnterTimeout: 1000,\n          transitionLeaveTimeout: 400\n        }, React.createElement(_ItemLink.default, {\n          href: \"#\",\n          item: item,\n          key: item.id,\n          id: item.id,\n          _id: item._id,\n          name: item.name,\n          image_url: item.image.cropped.url,\n          onClick: function onClick() {\n            return _this3.followedGene(item);\n          }\n        })));\n      });\n      return React.createElement(\"div\", null, items);\n    }\n  }]);\n\n  return SuggestedGenesContent;\n}(React.Component)) || _class);\nvar SuggestedGenesContainer = (0, _reactRelay.createFragmentContainer)(SuggestedGenesContent, {\n  suggested_genes: function suggested_genes() {\n    var node = require(\"../../../../__generated__/SuggestedGenesContent_suggested_genes.graphql\");\n\n    if (node.hash && node.hash !== \"ad7d9ea0e33ce748ebcb67864853561d\") {\n      console.error(\"The definition of 'SuggestedGenesContent_suggested_genes' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data.\");\n    }\n\n    return require(\"../../../../__generated__/SuggestedGenesContent_suggested_genes.graphql\");\n  }\n});\n\nvar SuggestedGenesComponent = function SuggestedGenesComponent(_ref) {\n  var relayEnvironment = _ref.relayEnvironment,\n      updateFollowCount = _ref.updateFollowCount;\n  return React.createElement(_reactRelay.QueryRenderer, {\n    environment: relayEnvironment,\n    query: _graphql2 || (_graphql2 = function _graphql2() {\n      var node = require(\"../../../../__generated__/SuggestedGenesQuery.graphql\");\n\n      if (node.hash && node.hash !== \"a9738ea08755f945124085b68763957f\") {\n        console.error(\"The definition of 'SuggestedGenesQuery' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data.\");\n      }\n\n      return require(\"../../../../__generated__/SuggestedGenesQuery.graphql\");\n    }),\n    variables: {},\n    render: function render(_ref2) {\n      var error = _ref2.error,\n          props = _ref2.props;\n\n      if (props) {\n        return React.createElement(SuggestedGenesContainer, {\n          suggested_genes: props.suggested_genes,\n          updateFollowCount: updateFollowCount\n        });\n      } else {\n        return null;\n      }\n    }\n  });\n};\n\nvar SuggestedGenes = (0, _Artsy.ContextConsumer)(SuggestedGenesComponent);\nexports.SuggestedGenes = SuggestedGenes;",{"version":3,"sources":["src/Components/Onboarding/Steps/Genes/SuggestedGenes.tsx"],"names":["SuggestedGenesContent","dispatch","postEvent","data","props","context","excludedGeneIds","Set","suggested_genes","map","item","_id","gene","store","suggestedGene","get","followGene","similar","edges","node","__id","add","getValue","suggestedGenesRootField","suggestedGenes","getLinkedRecords","updatedSuggestedGenes","geneItem","id","setLinkedRecords","followCount","updateFollowCount","tracking","trackEvent","action","entity_id","entity_slug","context_module","relay","environment","mutation","variables","input","gene_id","Array","from","updater","onGeneFollowed","items","index","name","image","cropped","url","followedGene","React","Component","SuggestedGenesContainer","SuggestedGenesComponent","relayEnvironment","error","SuggestedGenes"],"mappings":"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","file":"/Users/eve/development/reaction/src/Components/Onboarding/Steps/Genes/SuggestedGenes.tsx","sourceRoot":"/Users/eve/development/reaction","sourcesContent":["import * as React from \"react\"\nimport {\n  commitMutation,\n  createFragmentContainer,\n  graphql,\n  QueryRenderer,\n  RelayProp,\n} from \"react-relay\"\nimport { RecordSourceSelectorProxy, SelectorData } from \"relay-runtime\"\nimport Events from \"../../../../Utils/Events\"\nimport { track } from \"../../../../Utils/track\"\nimport ReplaceTransition from \"../../../Animation/ReplaceTransition\"\nimport { ContextConsumer, ContextProps } from \"../../../Artsy\"\nimport ItemLink, { LinkContainer } from \"../../ItemLink\"\nimport { FollowProps } from \"../../Types\"\n\ninterface Gene {\n  id: string | null\n  _id: string | null\n  __id: string | null\n  name: string | null\n  image: {\n    cropped: {\n      url: string | null\n    }\n  } | null\n}\n\ninterface RelayProps {\n  relay?: RelayProp\n  suggested_genes: Gene[]\n}\n\ninterface Props\n  extends React.HTMLProps<HTMLAnchorElement>,\n    RelayProps,\n    FollowProps {\n  tracking?: any\n}\n\n@track({}, { dispatch: data => Events.postEvent(data) })\nclass SuggestedGenesContent extends React.Component<Props, null> {\n  private excludedGeneIds: Set<string>\n  followCount: number = 0\n\n  constructor(props: Props, context: any) {\n    super(props, context)\n    this.excludedGeneIds = new Set(\n      this.props.suggested_genes.map(item => item._id)\n    )\n  }\n\n  onGeneFollowed(\n    gene: Gene,\n    store: RecordSourceSelectorProxy,\n    data: SelectorData\n  ): void {\n    const suggestedGene = store.get(\n      data.followGene.gene.similar.edges[0].node.__id\n    )\n    this.excludedGeneIds.add(suggestedGene.getValue(\"_id\"))\n\n    const suggestedGenesRootField = store.get(\"client:root\")\n    const suggestedGenes = suggestedGenesRootField.getLinkedRecords(\n      \"suggested_genes\"\n    )\n    const updatedSuggestedGenes = suggestedGenes.map(\n      geneItem =>\n        geneItem.getValue(\"id\") === gene.id ? suggestedGene : geneItem\n    )\n\n    suggestedGenesRootField.setLinkedRecords(\n      updatedSuggestedGenes,\n      \"suggested_genes\"\n    )\n\n    this.followCount += 1\n\n    this.props.updateFollowCount(this.followCount)\n\n    this.props.tracking.trackEvent({\n      action: \"Followed Gene\",\n      entity_id: gene._id,\n      entity_slug: gene.id,\n      context_module: \"onboarding recommended\",\n    })\n  }\n\n  followedGene(gene: Gene) {\n    this.excludedGeneIds.add(gene._id)\n\n    commitMutation(this.props.relay.environment, {\n      mutation: graphql`\n        mutation SuggestedGenesFollowGeneMutation(\n          $input: FollowGeneInput!\n          $excludedGeneIds: [String]!\n        ) {\n          followGene(input: $input) {\n            gene {\n              similar(first: 1, exclude_gene_ids: $excludedGeneIds) {\n                edges {\n                  node {\n                    id\n                    _id\n                    __id\n                    name\n                    image {\n                      cropped(width: 100, height: 100) {\n                        url\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      `,\n      variables: {\n        input: {\n          gene_id: gene.id,\n        },\n        excludedGeneIds: Array.from(this.excludedGeneIds),\n      },\n      updater: (store: RecordSourceSelectorProxy, data: SelectorData) =>\n        this.onGeneFollowed(gene, store, data),\n    })\n  }\n\n  render() {\n    const items = this.props.suggested_genes.map((item, index) => (\n      <LinkContainer key={`suggested-genes-${index}`}>\n        <ReplaceTransition\n          transitionEnterTimeout={1000}\n          transitionLeaveTimeout={400}\n        >\n          <ItemLink\n            href=\"#\"\n            item={item}\n            key={item.id}\n            id={item.id}\n            _id={item._id}\n            name={item.name}\n            image_url={item.image.cropped.url}\n            onClick={() => this.followedGene(item)}\n          />\n        </ReplaceTransition>\n      </LinkContainer>\n    ))\n\n    return <div>{items}</div>\n  }\n}\n\nconst SuggestedGenesContainer = createFragmentContainer(\n  SuggestedGenesContent,\n  graphql`\n    fragment SuggestedGenesContent_suggested_genes on Gene\n      @relay(plural: true) {\n      id\n      _id\n      name\n      image {\n        cropped(width: 100, height: 100) {\n          url\n        }\n      }\n    }\n  `\n)\n\nconst SuggestedGenesComponent: React.SFC<ContextProps & FollowProps> = ({\n  relayEnvironment,\n  updateFollowCount,\n}) => {\n  return (\n    <QueryRenderer\n      environment={relayEnvironment}\n      query={graphql`\n        query SuggestedGenesQuery {\n          suggested_genes {\n            ...SuggestedGenesContent_suggested_genes\n          }\n        }\n      `}\n      variables={{}}\n      render={({ error, props }) => {\n        if (props) {\n          return (\n            <SuggestedGenesContainer\n              suggested_genes={props.suggested_genes}\n              updateFollowCount={updateFollowCount}\n            />\n          )\n        } else {\n          return null\n        }\n      }}\n    />\n  )\n}\n\nexport const SuggestedGenes = ContextConsumer(SuggestedGenesComponent)\n"]}]}