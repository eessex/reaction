{"remainingRequest":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js??ref--6-1!/Users/eve/development/reaction/src/Styleguide/Components/Lightbox/Lightbox.tsx","dependencies":[{"path":"/Users/eve/development/reaction/src/Styleguide/Components/Lightbox/Lightbox.tsx","mtime":1537112679000},{"path":"/Users/eve/development/reaction/.babelrc","mtime":1537112679000},{"path":"/Users/eve/development/reaction/node_modules/cache-loader/dist/cjs.js","mtime":0},{"path":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _throttle from \"lodash/throttle\";\nimport _once from \"lodash/once\";\nimport _bind from \"lodash/bind\";\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Box, color, Flex, space } from \"@artsy/palette\";\nimport FadeTransition from \"../../../Components/Animation/FadeTransition\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport styled from \"styled-components\";\nimport { CloseButton } from \"./CloseButton\";\nimport { Slider } from \"./LightboxSlider\";\nvar KEYBOARD_EVENT = \"keyup\";\nvar ZOOM_PER_CLICK = 1.4;\nvar HIDE_ZOOM_SLIDER_AFTER = 2500;\nvar DeepZoomContainer = styled.div.withConfig({\n  displayName: \"Lightbox__DeepZoomContainer\",\n  componentId: \"x16d3j-0\"\n})([\"position:fixed !important;top:0;right:0;bottom:0;left:0;z-index:1000;background-color:\", \";\"], color(\"black100\"));\nexport var Lightbox =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Lightbox, _React$Component);\n\n  function Lightbox() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Lightbox);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Lightbox)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"state\", {\n      element: null,\n      viewer: null,\n      shown: false,\n      activityTimer: null,\n      showZoomSlider: true,\n      deepZoomRef: React.createRef(),\n      slider: {\n        min: 0,\n        max: 1,\n        step: 0.001,\n        value: 0\n      },\n\n      /**\n       * FIXME: convert to import('openseadragon) once force supports it\n       */\n      promisedDragon: Promise.resolve(require(\"openseadragon\"))\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"renderPortal\", function () {\n      return _this.state.element ? ReactDOM.createPortal(_this.renderLightbox(), _this.state.element) : null;\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"postRender\", function () {\n      _this.state.viewer.addHandler(\"zoom\", _bind(_throttle(_this.onZoomChanged, 50), _assertThisInitialized(_assertThisInitialized(_this))));\n\n      _this.state.viewer.addHandler(\"tile-drawn\", _once(function () {\n        _this.setState({\n          slider: _objectSpread({}, _this.state.slider, {\n            min: _this.state.viewer.viewport.getMinZoom(),\n            max: _this.state.viewer.viewport.getMaxZoom(),\n            value: _this.state.viewer.viewport.getHomeZoom()\n          })\n        });\n      }));\n\n      _this.detectActivity();\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"show\", function (event) {\n      _this.setState({\n        shown: true,\n        showZoomSlider: true\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"hide\", function () {\n      _this.setState({\n        shown: false\n      });\n\n      if (_this.state.viewer) {\n        _this.state.viewer.destroy();\n\n        _this.state.viewer = null;\n      }\n\n      document.removeEventListener(KEYBOARD_EVENT, _this.handleKeyPress);\n      clearTimeout(_this.state.activityTimer);\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handleKeyPress\", function (event) {\n      if (event && event.key === \"Escape\") {\n        _this.hide();\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"detectActivity\", _throttle(function () {\n      clearTimeout(_this.state.activityTimer);\n\n      _this.setState({\n        showZoomSlider: true,\n        activityTimer: setTimeout(function () {\n          _this.setState({\n            showZoomSlider: false\n          });\n        }, HIDE_ZOOM_SLIDER_AFTER)\n      });\n    }, 500));\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"zoomBy\", function (amount) {\n      if (_this.state.viewer.viewport) {\n        _this.state.viewer.viewport.zoomBy(amount);\n\n        _this.state.viewer.viewport.applyConstraints();\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"zoomIn\", function () {\n      _this.zoomBy(ZOOM_PER_CLICK);\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"zoomOut\", function () {\n      _this.zoomBy(1 / ZOOM_PER_CLICK);\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"initSeaDragon\", function () {\n      _this.state.promisedDragon.then(function (OpenSeaDragon) {\n        var viewer = OpenSeaDragon({\n          element: _this.state.deepZoomRef.current,\n          debugMode: false,\n          showNavigationControl: false,\n          immediateRender: false,\n          useCanvas: true,\n          constrainDuringPan: false,\n          blendTime: 0.0,\n          animationTime: 1.5,\n          springStiffness: 15.0,\n          maxZoomPixelRatio: 1.0,\n          minZoomImageRatio: 0.9,\n          zoomPerClick: ZOOM_PER_CLICK,\n          zoomPerScroll: 1.4,\n          clickDistThreshold: 5,\n          clickTimeThreshold: 300,\n          visibilityRatio: 1,\n          tileSources: _this.props.deepZoom,\n          gestureSettingsTouch: {\n            scrolltozoom: false,\n            clicktozoom: true,\n            pinchtozoom: true,\n            flickenabled: true,\n            flickminspeed: 20,\n            flickmomentum: 0.4\n          }\n        });\n        document.addEventListener(KEYBOARD_EVENT, _this.handleKeyPress);\n\n        _this.setState({\n          viewer: viewer\n        });\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"onSliderChanged\", function (event) {\n      _this.state.viewer.viewport.zoomTo(event.target.value);\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"onZoomChanged\", function () {\n      if (!_this.state.viewer) return;\n\n      _this.setState({\n        slider: _objectSpread({}, _this.state.slider, {\n          min: _this.state.viewer.viewport.getMinZoom(),\n          max: _this.state.viewer.viewport.getMaxZoom(),\n          value: _this.state.viewer.viewport.getZoom()\n        })\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(Lightbox, [{\n    key: \"renderLightbox\",\n    value: function renderLightbox() {\n      var _this2 = this;\n\n      var slider = this.state.slider;\n      return React.createElement(FadeTransition, {\n        in: this.state.shown,\n        mountOnEnter: true,\n        unmountOnExit: true,\n        timeout: {\n          enter: 250,\n          exit: 300\n        }\n      }, React.createElement(DeepZoomContainer, {\n        onMouseMove: this.detectActivity,\n        onWheel: this.detectActivity,\n        onTouchStart: this.detectActivity,\n        onTouchMove: this.detectActivity,\n        innerRef: this.state.deepZoomRef\n        /* TODO Update SC */\n\n      }, React.createElement(Box, {\n        position: \"absolute\",\n        top: space(3) / 2,\n        right: space(3) / 2,\n        zIndex: 1001\n      }, React.createElement(CloseButton, {\n        onClick: function onClick() {\n          return _this2.hide();\n        }\n      })), React.createElement(Flex, {\n        position: \"absolute\",\n        width: \"100%\",\n        justifyContent: \"center\",\n        zIndex: 1001,\n        bottom: space(2)\n      }, React.createElement(FadeTransition, {\n        in: this.state.showZoomSlider,\n        timeout: {\n          enter: 50,\n          exit: 150\n        }\n      }, React.createElement(Slider, {\n        min: slider.min,\n        max: slider.max,\n        step: slider.step,\n        value: slider.value,\n        onChange: this.onSliderChanged,\n        onZoomInClicked: function onZoomInClicked() {\n          return _this2.zoomIn();\n        },\n        onZoomOutClicked: function onZoomOutClicked() {\n          return _this2.zoomOut();\n        }\n      })))));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var children = this.props.children;\n      var modifiedChildren = React.Children.map(children, function (child) {\n        return React.cloneElement(child, {\n          style: {\n            cursor: \"zoom-in\"\n          },\n          onClick: _this3.show\n        });\n      });\n      return React.createElement(React.Fragment, null, this.renderPortal(), modifiedChildren);\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.setState({\n        element: document.getElementById(this.props.lightboxId)\n      });\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.hide();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      if (this.state.shown === true && prevState.shown === false) {\n        this.initSeaDragon();\n      }\n\n      if (this.state.viewer && !prevState.viewer) {\n        this.postRender();\n      }\n    }\n  }]);\n\n  return Lightbox;\n}(React.Component);\n\n_defineProperty(Lightbox, \"defaultProps\", {\n  lightboxId: \"lightbox-container\"\n});",{"version":3,"sources":["/Users/eve/development/reaction/src/Styleguide/Components/Lightbox/Lightbox.tsx"],"names":["Box","color","Flex","space","FadeTransition","React","ReactDOM","styled","CloseButton","Slider","KEYBOARD_EVENT","ZOOM_PER_CLICK","HIDE_ZOOM_SLIDER_AFTER","DeepZoomContainer","div","Lightbox","element","viewer","shown","activityTimer","showZoomSlider","deepZoomRef","createRef","slider","min","max","step","value","promisedDragon","Promise","resolve","require","state","createPortal","renderLightbox","addHandler","onZoomChanged","setState","viewport","getMinZoom","getMaxZoom","getHomeZoom","detectActivity","event","destroy","document","removeEventListener","handleKeyPress","clearTimeout","key","hide","setTimeout","amount","zoomBy","applyConstraints","then","OpenSeaDragon","current","debugMode","showNavigationControl","immediateRender","useCanvas","constrainDuringPan","blendTime","animationTime","springStiffness","maxZoomPixelRatio","minZoomImageRatio","zoomPerClick","zoomPerScroll","clickDistThreshold","clickTimeThreshold","visibilityRatio","tileSources","props","deepZoom","gestureSettingsTouch","scrolltozoom","clicktozoom","pinchtozoom","flickenabled","flickminspeed","flickmomentum","addEventListener","zoomTo","target","getZoom","enter","exit","onSliderChanged","zoomIn","zoomOut","children","modifiedChildren","Children","map","child","cloneElement","style","cursor","onClick","show","renderPortal","getElementById","lightboxId","prevProps","prevState","initSeaDragon","postRender","Component"],"mappings":"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","sourcesContent":["import { Box, color, Flex, space } from \"@artsy/palette\"\nimport FadeTransition from \"Components/Animation/FadeTransition\"\nimport { bind, once, throttle } from \"lodash\"\nimport React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport styled from \"styled-components\"\nimport { CloseButton } from \"./CloseButton\"\nimport { Slider, SliderProps } from \"./LightboxSlider\"\n\nconst KEYBOARD_EVENT = \"keyup\"\nconst ZOOM_PER_CLICK = 1.4\nconst HIDE_ZOOM_SLIDER_AFTER = 2500\n\nconst DeepZoomContainer = styled.div`\n  position: fixed !important;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  z-index: 1000;\n  background-color: ${color(\"black100\")};\n`\n\nexport interface LightboxProps {\n  deepZoom: {\n    Image: {\n      xmlns: string\n      Url: string\n      Format: string\n      Overlap: number\n      TileSize: number\n      Size: {\n        Width: number\n        Height: number\n      }\n    }\n  }\n  /**\n   * Id of the element to render the lightbox in\n   * Defaults to lightbox-container\n   */\n  lightboxId?: string\n}\n\nexport interface LightboxState {\n  shown: boolean\n  element: Element\n  viewer: any\n  deepZoomRef: any\n  slider: SliderProps\n  showZoomSlider: boolean\n  promisedDragon: Promise<any>\n  activityTimer?: NodeJS.Timer\n}\n\nexport class Lightbox extends React.Component<LightboxProps, LightboxState> {\n  static defaultProps = {\n    lightboxId: \"lightbox-container\",\n  }\n  state = {\n    element: null,\n    viewer: null,\n    shown: false,\n    activityTimer: null,\n    showZoomSlider: true,\n    deepZoomRef: React.createRef(),\n    slider: {\n      min: 0,\n      max: 1,\n      step: 0.001,\n      value: 0,\n    },\n    /**\n     * FIXME: convert to import('openseadragon) once force supports it\n     */\n    promisedDragon: Promise.resolve(require(\"openseadragon\")),\n  }\n\n  renderLightbox() {\n    const { slider } = this.state\n    return (\n      <FadeTransition\n        in={this.state.shown}\n        mountOnEnter\n        unmountOnExit\n        timeout={{ enter: 250, exit: 300 }}\n      >\n        <DeepZoomContainer\n          onMouseMove={this.detectActivity}\n          onWheel={this.detectActivity}\n          onTouchStart={this.detectActivity}\n          onTouchMove={this.detectActivity}\n          innerRef={this.state.deepZoomRef as any /* TODO Update SC */}\n        >\n          <Box\n            position=\"absolute\"\n            top={space(3) / 2}\n            right={space(3) / 2}\n            zIndex={1001}\n          >\n            <CloseButton onClick={() => this.hide()} />\n          </Box>\n          <Flex\n            position=\"absolute\"\n            width=\"100%\"\n            justifyContent=\"center\"\n            zIndex={1001}\n            bottom={space(2)}\n          >\n            <FadeTransition\n              in={this.state.showZoomSlider}\n              timeout={{ enter: 50, exit: 150 }}\n            >\n              <Slider\n                min={slider.min}\n                max={slider.max}\n                step={slider.step}\n                value={slider.value}\n                onChange={this.onSliderChanged}\n                onZoomInClicked={() => this.zoomIn()}\n                onZoomOutClicked={() => this.zoomOut()}\n              />\n            </FadeTransition>\n          </Flex>\n        </DeepZoomContainer>\n      </FadeTransition>\n    )\n  }\n\n  renderPortal = () => {\n    return this.state.element\n      ? ReactDOM.createPortal(this.renderLightbox(), this.state.element)\n      : null\n  }\n\n  render() {\n    const { children } = this.props\n    const modifiedChildren = React.Children.map(\n      children,\n      (child: React.ReactElement<any>) =>\n        React.cloneElement(child, {\n          style: { cursor: \"zoom-in\" },\n          onClick: this.show,\n        })\n    )\n    return (\n      <React.Fragment>\n        {this.renderPortal()}\n        {modifiedChildren}\n      </React.Fragment>\n    )\n  }\n\n  postRender = () => {\n    this.state.viewer.addHandler(\n      \"zoom\",\n      bind(throttle(this.onZoomChanged, 50), this)\n    )\n    this.state.viewer.addHandler(\n      \"tile-drawn\",\n      once(() => {\n        this.setState({\n          slider: {\n            ...this.state.slider,\n            min: this.state.viewer.viewport.getMinZoom(),\n            max: this.state.viewer.viewport.getMaxZoom(),\n            value: this.state.viewer.viewport.getHomeZoom(),\n          },\n        })\n      })\n    )\n    this.detectActivity()\n  }\n\n  show = event => {\n    this.setState({ shown: true, showZoomSlider: true })\n  }\n\n  hide = () => {\n    this.setState({ shown: false })\n    if (this.state.viewer) {\n      this.state.viewer.destroy()\n      this.state.viewer = null\n    }\n    document.removeEventListener(KEYBOARD_EVENT, this.handleKeyPress)\n    clearTimeout(this.state.activityTimer)\n  }\n\n  handleKeyPress = event => {\n    if (event && event.key === \"Escape\") {\n      this.hide()\n    }\n  }\n\n  detectActivity = throttle(() => {\n    clearTimeout(this.state.activityTimer)\n    this.setState({\n      showZoomSlider: true,\n      activityTimer: setTimeout(() => {\n        this.setState({\n          showZoomSlider: false,\n        })\n      }, HIDE_ZOOM_SLIDER_AFTER),\n    })\n  }, 500) as () => void\n\n  zoomBy = amount => {\n    if (this.state.viewer.viewport) {\n      this.state.viewer.viewport.zoomBy(amount)\n      this.state.viewer.viewport.applyConstraints()\n    }\n  }\n\n  zoomIn = () => {\n    this.zoomBy(ZOOM_PER_CLICK)\n  }\n\n  zoomOut = () => {\n    this.zoomBy(1 / ZOOM_PER_CLICK)\n  }\n\n  initSeaDragon = () => {\n    this.state.promisedDragon.then(OpenSeaDragon => {\n      const viewer = OpenSeaDragon({\n        element: this.state.deepZoomRef.current,\n\n        debugMode: false,\n        showNavigationControl: false,\n        immediateRender: false,\n        useCanvas: true,\n        constrainDuringPan: false,\n        blendTime: 0.0,\n        animationTime: 1.5,\n        springStiffness: 15.0,\n        maxZoomPixelRatio: 1.0,\n        minZoomImageRatio: 0.9,\n        zoomPerClick: ZOOM_PER_CLICK,\n        zoomPerScroll: 1.4,\n        clickDistThreshold: 5,\n        clickTimeThreshold: 300,\n        visibilityRatio: 1,\n        tileSources: this.props.deepZoom,\n\n        gestureSettingsTouch: {\n          scrolltozoom: false,\n          clicktozoom: true,\n          pinchtozoom: true,\n          flickenabled: true,\n          flickminspeed: 20,\n          flickmomentum: 0.4,\n        },\n      })\n      document.addEventListener(KEYBOARD_EVENT, this.handleKeyPress)\n      this.setState({\n        viewer,\n      })\n    })\n  }\n\n  onSliderChanged = event => {\n    this.state.viewer.viewport.zoomTo(event.target.value)\n  }\n\n  onZoomChanged = () => {\n    if (!this.state.viewer) return\n    this.setState({\n      slider: {\n        ...this.state.slider,\n        min: this.state.viewer.viewport.getMinZoom(),\n        max: this.state.viewer.viewport.getMaxZoom(),\n        value: this.state.viewer.viewport.getZoom(),\n      },\n    })\n  }\n\n  componentDidMount() {\n    this.setState({\n      element: document.getElementById(this.props.lightboxId),\n    })\n  }\n\n  componentWillUnmount() {\n    this.hide()\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (this.state.shown === true && prevState.shown === false) {\n      this.initSeaDragon()\n    }\n    if (this.state.viewer && !prevState.viewer) {\n      this.postRender()\n    }\n  }\n}\n"]}]}