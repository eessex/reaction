{"remainingRequest":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js??ref--5-1!/Users/eve/development/reaction/src/Components/Publishing/ToolTip/LinkWithToolTip.tsx","dependencies":[{"path":"/Users/eve/development/reaction/src/Components/Publishing/ToolTip/LinkWithToolTip.tsx","mtime":1527880679000},{"path":"/Users/eve/development/reaction/.babelrc","mtime":1527877289000},{"path":"/Users/eve/development/reaction/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js","mtime":1509489566000}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = exports.Background = exports.Link = exports.PrimaryLink = exports.LinkWithToolTip = void 0;\n\nvar _url = _interopRequireDefault(require(\"url\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _reactDom = require(\"react-dom\");\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _styledComponents = _interopRequireDefault(require(\"styled-components\"));\n\nvar _track = require(\"../../../Utils/track\");\n\nvar _ToolTip = require(\"./ToolTip\");\n\nvar _Colors = _interopRequireDefault(require(\"../../../Assets/Colors\"));\n\nvar _FadeTransition = _interopRequireDefault(require(\"../../Animation/FadeTransition\"));\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nvar LinkWithToolTip =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(LinkWithToolTip, _Component);\n\n  function LinkWithToolTip() {\n    var _ref;\n\n    var _temp, _this;\n\n    _classCallCheck(this, LinkWithToolTip);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _possibleConstructorReturn(_this, (_temp = _this = _possibleConstructorReturn(this, (_ref = LinkWithToolTip.__proto__ || Object.getPrototypeOf(LinkWithToolTip)).call.apply(_ref, [this].concat(args))), Object.defineProperty(_assertThisInitialized(_this), \"link\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: void 0\n    }), Object.defineProperty(_assertThisInitialized(_this), \"SetupToolTipPosition\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: void 0\n    }), Object.defineProperty(_assertThisInitialized(_this), \"state\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: {\n        inToolTip: false,\n        maybeHideToolTip: false,\n        position: null,\n        orientation: \"up\"\n      }\n    }), Object.defineProperty(_assertThisInitialized(_this), \"entityTypeToEntity\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value() {\n        var _this$urlToEntityType = _this.urlToEntityType(),\n            entityType = _this$urlToEntityType.entityType,\n            slug = _this$urlToEntityType.slug;\n\n        var data = _this.context.toolTipsData;\n        var collectionKey = entityType + \"s\";\n        if (!data || !data[collectionKey]) return null;\n        return {\n          entityType: entityType,\n          entity: data[collectionKey][slug]\n        };\n      }\n    }), Object.defineProperty(_assertThisInitialized(_this), \"showToolTip\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value(toolTipData) {\n        var tracking = _this.props.tracking;\n        var onTriggerToolTip = _this.context.onTriggerToolTip;\n        var entity = toolTipData.entity,\n            entityType = toolTipData.entityType;\n\n        if (entity) {\n          onTriggerToolTip(entity.id);\n          tracking.trackEvent({\n            action: \"Viewed tooltip\",\n            type: \"intext tooltip\",\n            entity_type: entityType,\n            entity_id: entity._id,\n            entity_slug: entity.id\n          });\n        }\n      }\n    }), Object.defineProperty(_assertThisInitialized(_this), \"trackClick\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value(toolTipData) {\n        var tracking = _this.props.tracking;\n        var entity = toolTipData.entity,\n            entityType = toolTipData.entityType;\n\n        if (entity) {\n          tracking.trackEvent({\n            action: \"Click\",\n            flow: \"tooltip\",\n            type: \"\".concat(entityType, \" stub\"),\n            context_module: \"intext tooltip\",\n            destination_path: entity.href\n          });\n        }\n      }\n    }), Object.defineProperty(_assertThisInitialized(_this), \"leftLink\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value() {\n        _this.setState({\n          maybeHideToolTip: true\n        });\n      }\n    }), Object.defineProperty(_assertThisInitialized(_this), \"hideToolTip\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value() {\n        _this.context.onTriggerToolTip(null);\n\n        _this.setState({\n          inToolTip: false,\n          maybeHideToolTip: false\n        });\n      }\n    }), Object.defineProperty(_assertThisInitialized(_this), \"maybeHideToolTip\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value() {\n        var _this$state = _this.state,\n            inToolTip = _this$state.inToolTip,\n            maybeHideToolTip = _this$state.maybeHideToolTip;\n        setTimeout(function () {\n          if (!inToolTip && maybeHideToolTip) {\n            _this.hideToolTip();\n          }\n        }, 750);\n      }\n    }), Object.defineProperty(_assertThisInitialized(_this), \"onLeaveLink\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value() {\n        _this.leftLink();\n\n        (0, _lodash.defer)(_this.maybeHideToolTip);\n      }\n    }), Object.defineProperty(_assertThisInitialized(_this), \"getToolTipPosition\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value(type) {\n        if (_this.link) {\n          var _this$state$position = _this.state.position,\n              left = _this$state$position.left,\n              width = _this$state$position.width,\n              x = _this$state$position.x;\n          var linkCenter = width / 2;\n          var toolTipWidth = type === \"artist\" ? 360 : 280;\n          var toolTipLeft = linkCenter - toolTipWidth / 2;\n          var isAtWindowBoundary = x + toolTipLeft < 10;\n          var arrowLeft = null;\n\n          if (isAtWindowBoundary) {\n            var padding = 20;\n            var arrowSize = 30;\n            arrowLeft = left + linkCenter - padding - arrowSize;\n            toolTipLeft = 10 - x;\n          }\n\n          return {\n            arrowLeft: arrowLeft,\n            toolTipLeft: toolTipLeft\n          };\n        }\n      }\n    }), Object.defineProperty(_assertThisInitialized(_this), \"getOrientation\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value(position) {\n        var height = window ? window.innerHeight : 0;\n        var linkPosition = position.top;\n        var orientation = height - linkPosition > 350 ? \"down\" : \"up\";\n        return orientation;\n      }\n    }), Object.defineProperty(_assertThisInitialized(_this), \"setupToolTipPosition\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value() {\n        if (_this.link) {\n          var _position = (0, _reactDom.findDOMNode)(_this.link).getBoundingClientRect();\n\n          var _orientation = _this.getOrientation(_position);\n\n          _this.setState({\n            position: _position,\n            orientation: _orientation\n          });\n        }\n      }\n    }), _temp));\n  }\n\n  _createClass(LinkWithToolTip, [{\n    key: \"urlToEntityType\",\n    value: function urlToEntityType() {\n      var urlComponents = _url.default.parse(this.props.url).pathname.split(\"/\");\n\n      urlComponents.shift();\n      return {\n        entityType: urlComponents[0],\n        slug: urlComponents[1]\n      };\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.SetupToolTipPosition = function () {\n        return (0, _lodash.defer)(_this2.setupToolTipPosition);\n      };\n\n      this.setupToolTipPosition();\n      window.addEventListener(\"scroll\", this.SetupToolTipPosition);\n      window.addEventListener(\"resize\", this.SetupToolTipPosition);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener(\"scroll\", this.SetupToolTipPosition);\n      window.removeEventListener(\"resize\", this.SetupToolTipPosition);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var _props = this.props,\n          showMarketData = _props.showMarketData,\n          url = _props.url;\n      var _context = this.context,\n          activeToolTip = _context.activeToolTip,\n          waitForFade = _context.waitForFade;\n      var orientation = this.state.orientation;\n      var toolTipData = this.entityTypeToEntity();\n      var entity = toolTipData.entity,\n          entityType = toolTipData.entityType;\n      var id = entity ? entity.id : null;\n      var toolTipPosition = this.getToolTipPosition(entityType);\n      var show = id && activeToolTip ? id === activeToolTip : false;\n      var showWithFade = show || waitForFade && waitForFade === id;\n      return _react.default.createElement(Link, {\n        onMouseEnter: function onMouseEnter() {\n          !show && _this3.showToolTip(toolTipData);\n        },\n        ref: function ref(link) {\n          return _this3.link = link;\n        },\n        show: showWithFade\n      }, _react.default.createElement(PrimaryLink, {\n        href: url,\n        target: \"_blank\",\n        show: showWithFade,\n        onClick: function onClick() {\n          return _this3.trackClick(toolTipData);\n        }\n      }, this.props.children), _react.default.createElement(FadeContainer, null, _react.default.createElement(_FadeTransition.default, {\n        \"in\": show,\n        mountOnEnter: true,\n        unmountOnExit: true,\n        timeout: {\n          enter: 200,\n          exit: 250\n        }\n      }, _react.default.createElement(_ToolTip.ToolTip, {\n        entity: entity,\n        model: entityType,\n        showMarketData: showMarketData,\n        onMouseLeave: this.hideToolTip,\n        onMouseEnter: function onMouseEnter() {\n          _this3.setState({\n            inToolTip: true\n          });\n        },\n        positionLeft: toolTipPosition && toolTipPosition.toolTipLeft,\n        arrowLeft: toolTipPosition && toolTipPosition.arrowLeft,\n        orientation: orientation\n      }))), show && _react.default.createElement(Background, {\n        onMouseLeave: this.onLeaveLink,\n        href: url,\n        target: \"_blank\",\n        onClick: function onClick() {\n          return _this3.trackClick(toolTipData);\n        }\n      }));\n    }\n  }]);\n\n  return LinkWithToolTip;\n}(_react.Component);\n\nexports.LinkWithToolTip = LinkWithToolTip;\nObject.defineProperty(LinkWithToolTip, \"contextTypes\", {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  value: {\n    toolTipsData: _propTypes.default.object,\n    onTriggerToolTip: _propTypes.default.func,\n    activeToolTip: _propTypes.default.any,\n    waitForFade: _propTypes.default.string\n  }\n});\n\nvar PrimaryLink =\n/*#__PURE__*/\n_styledComponents.default.a.attrs({}).withConfig({\n  displayName: \"LinkWithToolTip__PrimaryLink\",\n  componentId: \"smiox9-0\"\n})([\"z-index:auto;color:black;transition:color 0.25s;background-image:linear-gradient( to right,\", \" 50%,transparent 50% ) !important;background-size:3px 1.75px !important;background-position:0 1.07em !important;\", \";\"], _Colors.default.graySemibold, function (props) {\n  return props.show && \"\\n    color: \".concat(_Colors.default.grayDark, \" !important;\\n    background-image: linear-gradient(\\n      to right,\\n      \").concat(_Colors.default.grayDark, \" 50%,\\n      transparent 50%\\n    ) !important;\\n  \");\n});\n\nexports.PrimaryLink = PrimaryLink;\n\nvar FadeContainer =\n/*#__PURE__*/\n_styledComponents.default.div.withConfig({\n  displayName: \"LinkWithToolTip__FadeContainer\",\n  componentId: \"smiox9-1\"\n})([\"position:absolute;top:0;left:0;bottom:0;right:0;z-index:0;\"]);\n\nvar Link =\n/*#__PURE__*/\n_styledComponents.default.div.attrs({}).withConfig({\n  displayName: \"LinkWithToolTip__Link\",\n  componentId: \"smiox9-2\"\n})([\"display:inline-block;position:relative;cursor:pointer;z-index:\", \";\", \"{\", \";}\"], function (props) {\n  return props.show ? 10 : 0;\n}, FadeContainer, function (props) {\n  return props.show && \"z-index: 10\";\n});\n\nexports.Link = Link;\n\nvar Background =\n/*#__PURE__*/\n_styledComponents.default.a.withConfig({\n  displayName: \"LinkWithToolTip__Background\",\n  componentId: \"smiox9-3\"\n})([\"position:absolute;left:0;top:-10px;bottom:-10px;right:0;z-index:10;background-image:none !important;\"]);\n\nexports.Background = Background;\n\nvar _default = (0, _track.track)()(LinkWithToolTip);\n\nexports.default = _default;",{"version":3,"sources":["src/Components/Publishing/ToolTip/LinkWithToolTip.tsx"],"names":["LinkWithToolTip","inToolTip","maybeHideToolTip","position","orientation","urlToEntityType","entityType","slug","data","context","toolTipsData","collectionKey","entity","tracking","props","onTriggerToolTip","toolTipData","id","trackEvent","action","type","entity_type","entity_id","_id","entity_slug","flow","context_module","destination_path","href","setState","state","setTimeout","hideToolTip","leftLink","link","left","width","x","linkCenter","toolTipWidth","toolTipLeft","isAtWindowBoundary","arrowLeft","padding","arrowSize","height","window","innerHeight","linkPosition","top","getBoundingClientRect","getOrientation","urlComponents","parse","url","pathname","split","shift","SetupToolTipPosition","setupToolTipPosition","addEventListener","removeEventListener","showMarketData","activeToolTip","waitForFade","entityTypeToEntity","toolTipPosition","getToolTipPosition","show","showWithFade","showToolTip","trackClick","children","enter","exit","onLeaveLink","object","func","any","string","PrimaryLink","a","attrs","graySemibold","grayDark","FadeContainer","div","Link","Background"],"mappings":"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","file":"/Users/eve/development/reaction/src/Components/Publishing/ToolTip/LinkWithToolTip.tsx","sourceRoot":"/Users/eve/development/reaction","sourcesContent":["import url from \"url\"\nimport { defer } from \"lodash\"\nimport { findDOMNode } from \"react-dom\"\nimport React, { Component } from \"react\"\nimport PropTypes from \"prop-types\"\nimport styled from \"styled-components\"\nimport { track } from \"../../../Utils/track\"\nimport { ToolTip } from \"./ToolTip\"\nimport Colors from \"Assets/Colors\"\nimport FadeTransition from \"../../Animation/FadeTransition\"\n\ninterface Props {\n  url: string\n  showMarketData?: boolean\n  tracking?: any\n}\n\ninterface State {\n  inToolTip: boolean\n  maybeHideToolTip: boolean\n  position: ClientRect\n  orientation?: string\n}\n\nexport class LinkWithToolTip extends Component<Props, State> {\n  static contextTypes = {\n    toolTipsData: PropTypes.object,\n    onTriggerToolTip: PropTypes.func,\n    activeToolTip: PropTypes.any,\n    waitForFade: PropTypes.string,\n  }\n\n  public link: any\n  public SetupToolTipPosition: any\n\n  state = {\n    inToolTip: false,\n    maybeHideToolTip: false,\n    position: null,\n    orientation: \"up\",\n  }\n\n  urlToEntityType(): { entityType: string; slug: string } {\n    const urlComponents = url.parse(this.props.url).pathname.split(\"/\")\n    urlComponents.shift()\n\n    return {\n      entityType: urlComponents[0],\n      slug: urlComponents[1],\n    }\n  }\n\n  componentDidMount() {\n    this.SetupToolTipPosition = () => defer(this.setupToolTipPosition)\n    this.setupToolTipPosition()\n\n    window.addEventListener(\"scroll\", this.SetupToolTipPosition)\n    window.addEventListener(\"resize\", this.SetupToolTipPosition)\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"scroll\", this.SetupToolTipPosition)\n    window.removeEventListener(\"resize\", this.SetupToolTipPosition)\n  }\n\n  entityTypeToEntity = () => {\n    const { entityType, slug } = this.urlToEntityType()\n    const data = this.context.toolTipsData\n    const collectionKey = entityType + \"s\"\n\n    if (!data || !data[collectionKey]) return null\n\n    return {\n      entityType,\n      entity: data[collectionKey][slug],\n    }\n  }\n\n  showToolTip = toolTipData => {\n    const { tracking } = this.props\n    const { onTriggerToolTip } = this.context\n    const { entity, entityType } = toolTipData\n\n    if (entity) {\n      onTriggerToolTip(entity.id)\n\n      tracking.trackEvent({\n        action: \"Viewed tooltip\",\n        type: \"intext tooltip\",\n        entity_type: entityType,\n        entity_id: entity._id,\n        entity_slug: entity.id,\n      })\n    }\n  }\n\n  trackClick = toolTipData => {\n    const { tracking } = this.props\n    const { entity, entityType } = toolTipData\n\n    if (entity) {\n      tracking.trackEvent({\n        action: \"Click\",\n        flow: \"tooltip\",\n        type: `${entityType} stub`,\n        context_module: \"intext tooltip\",\n        destination_path: entity.href,\n      })\n    }\n  }\n\n  leftLink = () => {\n    this.setState({ maybeHideToolTip: true })\n  }\n\n  hideToolTip = () => {\n    this.context.onTriggerToolTip(null)\n\n    this.setState({\n      inToolTip: false,\n      maybeHideToolTip: false,\n    })\n  }\n\n  maybeHideToolTip = () => {\n    const { inToolTip, maybeHideToolTip } = this.state\n    setTimeout(() => {\n      if (!inToolTip && maybeHideToolTip) {\n        this.hideToolTip()\n      }\n    }, 750)\n  }\n\n  onLeaveLink = () => {\n    this.leftLink()\n    defer(this.maybeHideToolTip)\n  }\n\n  getToolTipPosition = type => {\n    if (this.link) {\n      const { left, width, x } = this.state.position\n      const linkCenter = width / 2\n      const toolTipWidth = type === \"artist\" ? 360 : 280\n\n      let toolTipLeft = linkCenter - toolTipWidth / 2\n      const isAtWindowBoundary = x + toolTipLeft < 10\n      let arrowLeft = null\n\n      if (isAtWindowBoundary) {\n        const padding = 20\n        const arrowSize = 30\n\n        arrowLeft = left + linkCenter - padding - arrowSize\n        toolTipLeft = 10 - x\n      }\n      return {\n        arrowLeft,\n        toolTipLeft,\n      }\n    }\n  }\n\n  getOrientation = position => {\n    const height = window ? window.innerHeight : 0\n    const linkPosition = position.top\n    const orientation = height - linkPosition > 350 ? \"down\" : \"up\"\n\n    return orientation\n  }\n\n  setupToolTipPosition = () => {\n    if (this.link) {\n      const position = findDOMNode(this.link).getBoundingClientRect()\n      const orientation = this.getOrientation(position)\n\n      this.setState({ position, orientation })\n    }\n  }\n\n  render() {\n    const { showMarketData, url } = this.props\n    const { activeToolTip, waitForFade } = this.context\n    const { orientation } = this.state\n\n    const toolTipData = this.entityTypeToEntity()\n    const { entity, entityType } = toolTipData\n    const id = entity ? entity.id : null\n    const toolTipPosition = this.getToolTipPosition(entityType)\n\n    const show = id && activeToolTip ? id === activeToolTip : false\n    const showWithFade = show || (waitForFade && waitForFade === id)\n\n    return (\n      <Link\n        onMouseEnter={() => {\n          !show && this.showToolTip(toolTipData)\n        }}\n        ref={link => (this.link = link)}\n        show={showWithFade}\n      >\n        <PrimaryLink\n          href={url}\n          target=\"_blank\"\n          show={showWithFade}\n          onClick={() => this.trackClick(toolTipData)}\n        >\n          {this.props.children}\n        </PrimaryLink>\n\n        <FadeContainer>\n          <FadeTransition\n            in={show}\n            mountOnEnter\n            unmountOnExit\n            timeout={{ enter: 200, exit: 250 }}\n          >\n            <ToolTip\n              entity={entity}\n              model={entityType}\n              showMarketData={showMarketData}\n              onMouseLeave={this.hideToolTip}\n              onMouseEnter={() => {\n                this.setState({ inToolTip: true })\n              }}\n              positionLeft={toolTipPosition && toolTipPosition.toolTipLeft}\n              arrowLeft={toolTipPosition && toolTipPosition.arrowLeft}\n              orientation={orientation}\n            />\n          </FadeTransition>\n        </FadeContainer>\n\n        {show && (\n          <Background\n            onMouseLeave={this.onLeaveLink}\n            href={url}\n            target=\"_blank\"\n            onClick={() => this.trackClick(toolTipData)}\n          />\n        )}\n      </Link>\n    )\n  }\n}\n\nexport const PrimaryLink = styled.a.attrs<{ show: boolean }>({})`\n  z-index: auto;\n  color: black;\n  transition: color 0.25s;\n  background-image: linear-gradient(\n    to right,\n    ${Colors.graySemibold} 50%,\n    transparent 50%\n  ) !important;\n  background-size: 3px 1.75px !important;\n  background-position: 0 1.07em !important;\n  ${props =>\n    props.show &&\n    `\n    color: ${Colors.grayDark} !important;\n    background-image: linear-gradient(\n      to right,\n      ${Colors.grayDark} 50%,\n      transparent 50%\n    ) !important;\n  `};\n`\n\nconst FadeContainer = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n  z-index: 0;\n`\n\nexport const Link = styled.div.attrs<{ onMouseEnter: any; show: boolean }>({})`\n  display: inline-block;\n  position: relative;\n  cursor: pointer;\n  z-index: ${props => (props.show ? 10 : 0)};\n  ${FadeContainer} {\n    ${props => props.show && `z-index: 10`};\n  }\n`\n\nexport const Background = styled.a`\n  position: absolute;\n  left: 0;\n  top: -10px;\n  bottom: -10px;\n  right: 0;\n  z-index: 10;\n  background-image: none !important;\n`\n\nexport default track()(LinkWithToolTip)\n"]}]}