{"remainingRequest":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js??ref--6-1!/Users/eve/development/reaction/src/Components/Publishing/ToolTip/LinkWithTooltip.tsx","dependencies":[{"path":"/Users/eve/development/reaction/src/Components/Publishing/ToolTip/LinkWithTooltip.tsx","mtime":1535727457000},{"path":"/Users/eve/development/reaction/.babelrc","mtime":1537112679000},{"path":"/Users/eve/development/reaction/node_modules/cache-loader/dist/cjs.js","mtime":0},{"path":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _defer from \"lodash/defer\";\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport Colors from \"../../../Assets/Colors\";\nimport PropTypes from \"prop-types\";\nimport React, { Component } from \"react\";\nimport { findDOMNode } from \"react-dom\";\nimport track from \"react-tracking\";\nimport styled from \"styled-components\";\nimport { parse as parseURL } from \"url\";\nimport FadeTransition from \"../../Animation/FadeTransition\";\nimport { ToolTip } from \"./ToolTip\";\nexport var LinkWithTooltip =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(LinkWithTooltip, _Component);\n\n  function LinkWithTooltip() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, LinkWithTooltip);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(LinkWithTooltip)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"link\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"SetupToolTipPosition\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"state\", {\n      inToolTip: false,\n      maybeHideToolTip: false,\n      position: null,\n      orientation: \"up\"\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"entityTypeToEntity\", function () {\n      var _this$urlToEntityType = _this.urlToEntityType(),\n          entityType = _this$urlToEntityType.entityType,\n          slug = _this$urlToEntityType.slug;\n\n      var data = _this.context.tooltipsData;\n      var collectionKey = entityType + \"s\";\n      if (!data || !data[collectionKey]) return null;\n      return {\n        entityType: entityType,\n        entity: data[collectionKey][slug]\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"showToolTip\", function (toolTipData) {\n      var tracking = _this.props.tracking;\n      var onTriggerToolTip = _this.context.onTriggerToolTip;\n      var entity = toolTipData.entity,\n          entityType = toolTipData.entityType;\n\n      if (entity) {\n        onTriggerToolTip(entity.id);\n        tracking.trackEvent({\n          action: \"Viewed tooltip\",\n          type: \"intext tooltip\",\n          entity_type: entityType,\n          entity_id: entity._id,\n          entity_slug: entity.id\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"trackClick\", function (toolTipData) {\n      var tracking = _this.props.tracking;\n      var entity = toolTipData.entity,\n          entityType = toolTipData.entityType;\n\n      if (entity) {\n        tracking.trackEvent({\n          action: \"Click\",\n          flow: \"tooltip\",\n          type: \"\".concat(entityType, \" stub\"),\n          context_module: \"intext tooltip\",\n          destination_path: entity.href\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"leftLink\", function () {\n      _this.setState({\n        maybeHideToolTip: true\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"hideToolTip\", function () {\n      _this.context.onTriggerToolTip(null);\n\n      _this.setState({\n        inToolTip: false,\n        maybeHideToolTip: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"maybeHideToolTip\", function () {\n      var _this$state = _this.state,\n          inToolTip = _this$state.inToolTip,\n          maybeHideToolTip = _this$state.maybeHideToolTip;\n      setTimeout(function () {\n        if (!inToolTip && maybeHideToolTip) {\n          _this.hideToolTip();\n        }\n      }, 750);\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"onLeaveLink\", function () {\n      _this.leftLink();\n\n      _defer(_this.maybeHideToolTip);\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"getToolTipPosition\", function (type) {\n      if (_this.link) {\n        var _this$state$position = _this.state.position,\n            left = _this$state$position.left,\n            width = _this$state$position.width,\n            x = _this$state$position.x;\n        var linkCenter = width / 2;\n        var toolTipWidth = type === \"artist\" ? 360 : 280;\n        var toolTipLeft = linkCenter - toolTipWidth / 2;\n        var isAtWindowBoundary = x + toolTipLeft < 10;\n        var arrowLeft = null;\n\n        if (isAtWindowBoundary) {\n          var padding = 20;\n          var arrowSize = 30;\n          arrowLeft = left + linkCenter - padding - arrowSize;\n          toolTipLeft = 10 - x;\n        }\n\n        return {\n          arrowLeft: arrowLeft,\n          toolTipLeft: toolTipLeft\n        };\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"getOrientation\", function (position) {\n      var height = window ? window.innerHeight : 0;\n      var linkPosition = position.top;\n      var orientation = height - linkPosition > 350 ? \"down\" : \"up\";\n      return orientation;\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"setupToolTipPosition\", function () {\n      if (_this.link) {\n        var _position = findDOMNode(_this.link).getBoundingClientRect();\n\n        var _orientation = _this.getOrientation(_position);\n\n        _this.setState({\n          position: _position,\n          orientation: _orientation\n        });\n      }\n    });\n\n    return _this;\n  }\n\n  _createClass(LinkWithTooltip, [{\n    key: \"urlToEntityType\",\n    value: function urlToEntityType() {\n      var urlComponents = parseURL(this.props.url).pathname.split(\"/\");\n      urlComponents.shift();\n      return {\n        entityType: urlComponents[0],\n        slug: urlComponents[1]\n      };\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.SetupToolTipPosition = function () {\n        return _defer(_this2.setupToolTipPosition);\n      };\n\n      this.setupToolTipPosition();\n      window.addEventListener(\"scroll\", this.SetupToolTipPosition);\n      window.addEventListener(\"resize\", this.SetupToolTipPosition);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      window.removeEventListener(\"scroll\", this.SetupToolTipPosition);\n      window.removeEventListener(\"resize\", this.SetupToolTipPosition);\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n\n      var url = this.props.url;\n      var _this$context = this.context,\n          activeToolTip = _this$context.activeToolTip,\n          waitForFade = _this$context.waitForFade;\n      var orientation = this.state.orientation;\n      var toolTipData = this.entityTypeToEntity();\n      var entity = toolTipData.entity,\n          entityType = toolTipData.entityType;\n      var id = entity ? entity.id : null;\n      var toolTipPosition = this.getToolTipPosition(entityType);\n      var show = id && activeToolTip ? id === activeToolTip : false;\n      var showWithFade = show || waitForFade && waitForFade === id;\n      return React.createElement(Link, {\n        onMouseEnter: function onMouseEnter() {\n          !show && _this3.showToolTip(toolTipData);\n        },\n        ref: function ref(link) {\n          return _this3.link = link;\n        },\n        show: showWithFade\n      }, React.createElement(PrimaryLink, {\n        href: url,\n        target: \"_blank\",\n        show: showWithFade,\n        onClick: function onClick() {\n          return _this3.trackClick(toolTipData);\n        }\n      }, this.props.children), React.createElement(FadeContainer, null, React.createElement(FadeTransition, {\n        in: show,\n        mountOnEnter: true,\n        unmountOnExit: true,\n        timeout: {\n          enter: 200,\n          exit: 250\n        }\n      }, React.createElement(ToolTip, {\n        entity: entity,\n        model: entityType,\n        onMouseLeave: this.hideToolTip,\n        onMouseEnter: function onMouseEnter() {\n          _this3.setState({\n            inToolTip: true\n          });\n        },\n        positionLeft: toolTipPosition && toolTipPosition.toolTipLeft,\n        arrowLeft: toolTipPosition && toolTipPosition.arrowLeft,\n        orientation: orientation\n      }))), show && React.createElement(Background, {\n        onMouseLeave: this.onLeaveLink,\n        href: url,\n        target: \"_blank\",\n        onClick: function onClick() {\n          return _this3.trackClick(toolTipData);\n        }\n      }));\n    }\n  }]);\n\n  return LinkWithTooltip;\n}(Component);\n\n_defineProperty(LinkWithTooltip, \"contextTypes\", {\n  tooltipsData: PropTypes.object,\n  onTriggerToolTip: PropTypes.func,\n  activeToolTip: PropTypes.any,\n  waitForFade: PropTypes.string\n});\n\nexport var PrimaryLink = styled.a.attrs({}).withConfig({\n  displayName: \"LinkWithTooltip__PrimaryLink\",\n  componentId: \"s1omtxql-0\"\n})([\"z-index:auto;color:black;transition:color 0.25s;background-image:linear-gradient( to right,\", \" 50%,transparent 50% ) !important;background-size:3px 1.75px !important;background-position:0 1.07em !important;\", \";\"], Colors.graySemibold, function (props) {\n  return props.show && \"\\n    color: \".concat(Colors.grayDark, \" !important;\\n    background-image: linear-gradient(\\n      to right,\\n      \").concat(Colors.grayDark, \" 50%,\\n      transparent 50%\\n    ) !important;\\n  \");\n});\nvar FadeContainer = styled.div.withConfig({\n  displayName: \"LinkWithTooltip__FadeContainer\",\n  componentId: \"s1omtxql-1\"\n})([\"position:absolute;top:0;left:0;bottom:0;right:0;z-index:0;\"]);\nexport var Link = styled.div.attrs({}).withConfig({\n  displayName: \"LinkWithTooltip__Link\",\n  componentId: \"s1omtxql-2\"\n})([\"display:inline-block;position:relative;cursor:pointer;z-index:\", \";\", \"{\", \";}\"], function (props) {\n  return props.show ? 10 : 0;\n}, FadeContainer, function (props) {\n  return props.show && \"z-index: 10\";\n});\nexport var Background = styled.a.withConfig({\n  displayName: \"LinkWithTooltip__Background\",\n  componentId: \"s1omtxql-3\"\n})([\"position:absolute;left:0;top:-10px;bottom:-10px;right:0;z-index:10;background-image:none !important;\"]);\nexport default track()(LinkWithTooltip);",{"version":3,"sources":["/Users/eve/development/reaction/src/Components/Publishing/ToolTip/LinkWithTooltip.tsx"],"names":["Colors","PropTypes","React","Component","findDOMNode","track","styled","parse","parseURL","FadeTransition","ToolTip","LinkWithTooltip","inToolTip","maybeHideToolTip","position","orientation","urlToEntityType","entityType","slug","data","context","tooltipsData","collectionKey","entity","toolTipData","tracking","props","onTriggerToolTip","id","trackEvent","action","type","entity_type","entity_id","_id","entity_slug","flow","context_module","destination_path","href","setState","state","setTimeout","hideToolTip","leftLink","link","left","width","x","linkCenter","toolTipWidth","toolTipLeft","isAtWindowBoundary","arrowLeft","padding","arrowSize","height","window","innerHeight","linkPosition","top","getBoundingClientRect","getOrientation","urlComponents","url","pathname","split","shift","SetupToolTipPosition","setupToolTipPosition","addEventListener","removeEventListener","activeToolTip","waitForFade","entityTypeToEntity","toolTipPosition","getToolTipPosition","show","showWithFade","showToolTip","trackClick","children","enter","exit","onLeaveLink","object","func","any","string","PrimaryLink","a","attrs","graySemibold","grayDark","FadeContainer","div","Link","Background"],"mappings":"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","sourcesContent":["import Colors from \"Assets/Colors\"\nimport { defer } from \"lodash\"\nimport PropTypes from \"prop-types\"\nimport React, { Component } from \"react\"\nimport { findDOMNode } from \"react-dom\"\nimport track from \"react-tracking\"\nimport styled from \"styled-components\"\nimport { parse as parseURL } from \"url\"\nimport FadeTransition from \"../../Animation/FadeTransition\"\nimport { ToolTip } from \"./ToolTip\"\n\ninterface Props {\n  url: string\n  tracking?: any\n}\n\ninterface State {\n  inToolTip: boolean\n  maybeHideToolTip: boolean\n  position: ClientRect\n  orientation?: string\n}\n\nexport class LinkWithTooltip extends Component<Props, State> {\n  static contextTypes = {\n    tooltipsData: PropTypes.object,\n    onTriggerToolTip: PropTypes.func,\n    activeToolTip: PropTypes.any,\n    waitForFade: PropTypes.string,\n  }\n\n  public link: any\n  public SetupToolTipPosition: any\n\n  state = {\n    inToolTip: false,\n    maybeHideToolTip: false,\n    position: null,\n    orientation: \"up\",\n  }\n\n  urlToEntityType(): { entityType: string; slug: string } {\n    const urlComponents = parseURL(this.props.url).pathname.split(\"/\")\n    urlComponents.shift()\n\n    return {\n      entityType: urlComponents[0],\n      slug: urlComponents[1],\n    }\n  }\n\n  componentDidMount() {\n    this.SetupToolTipPosition = () => defer(this.setupToolTipPosition)\n    this.setupToolTipPosition()\n\n    window.addEventListener(\"scroll\", this.SetupToolTipPosition)\n    window.addEventListener(\"resize\", this.SetupToolTipPosition)\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener(\"scroll\", this.SetupToolTipPosition)\n    window.removeEventListener(\"resize\", this.SetupToolTipPosition)\n  }\n\n  entityTypeToEntity = () => {\n    const { entityType, slug } = this.urlToEntityType()\n    const data = this.context.tooltipsData\n    const collectionKey = entityType + \"s\"\n\n    if (!data || !data[collectionKey]) return null\n\n    return {\n      entityType,\n      entity: data[collectionKey][slug],\n    }\n  }\n\n  showToolTip = toolTipData => {\n    const { tracking } = this.props\n    const { onTriggerToolTip } = this.context\n    const { entity, entityType } = toolTipData\n\n    if (entity) {\n      onTriggerToolTip(entity.id)\n\n      tracking.trackEvent({\n        action: \"Viewed tooltip\",\n        type: \"intext tooltip\",\n        entity_type: entityType,\n        entity_id: entity._id,\n        entity_slug: entity.id,\n      })\n    }\n  }\n\n  trackClick = toolTipData => {\n    const { tracking } = this.props\n    const { entity, entityType } = toolTipData\n\n    if (entity) {\n      tracking.trackEvent({\n        action: \"Click\",\n        flow: \"tooltip\",\n        type: `${entityType} stub`,\n        context_module: \"intext tooltip\",\n        destination_path: entity.href,\n      })\n    }\n  }\n\n  leftLink = () => {\n    this.setState({ maybeHideToolTip: true })\n  }\n\n  hideToolTip = () => {\n    this.context.onTriggerToolTip(null)\n\n    this.setState({\n      inToolTip: false,\n      maybeHideToolTip: false,\n    })\n  }\n\n  maybeHideToolTip = () => {\n    const { inToolTip, maybeHideToolTip } = this.state\n    setTimeout(() => {\n      if (!inToolTip && maybeHideToolTip) {\n        this.hideToolTip()\n      }\n    }, 750)\n  }\n\n  onLeaveLink = () => {\n    this.leftLink()\n    defer(this.maybeHideToolTip)\n  }\n\n  getToolTipPosition = type => {\n    if (this.link) {\n      const { left, width, x } = this.state.position\n      const linkCenter = width / 2\n      const toolTipWidth = type === \"artist\" ? 360 : 280\n\n      let toolTipLeft = linkCenter - toolTipWidth / 2\n      const isAtWindowBoundary = x + toolTipLeft < 10\n      let arrowLeft = null\n\n      if (isAtWindowBoundary) {\n        const padding = 20\n        const arrowSize = 30\n\n        arrowLeft = left + linkCenter - padding - arrowSize\n        toolTipLeft = 10 - x\n      }\n      return {\n        arrowLeft,\n        toolTipLeft,\n      }\n    }\n  }\n\n  getOrientation = position => {\n    const height = window ? window.innerHeight : 0\n    const linkPosition = position.top\n    const orientation = height - linkPosition > 350 ? \"down\" : \"up\"\n\n    return orientation\n  }\n\n  setupToolTipPosition = () => {\n    if (this.link) {\n      const position = (findDOMNode(\n        this.link\n      ) as Element).getBoundingClientRect()\n      const orientation = this.getOrientation(position)\n\n      this.setState({ position, orientation })\n    }\n  }\n\n  render() {\n    const { url } = this.props\n    const { activeToolTip, waitForFade } = this.context\n    const { orientation } = this.state\n\n    const toolTipData = this.entityTypeToEntity()\n    const { entity, entityType } = toolTipData\n    const id = entity ? entity.id : null\n    const toolTipPosition = this.getToolTipPosition(entityType)\n\n    const show = id && activeToolTip ? id === activeToolTip : false\n    const showWithFade = show || (waitForFade && waitForFade === id)\n\n    return (\n      <Link\n        onMouseEnter={() => {\n          !show && this.showToolTip(toolTipData)\n        }}\n        ref={link => (this.link = link)}\n        show={showWithFade}\n      >\n        <PrimaryLink\n          href={url}\n          target=\"_blank\"\n          show={showWithFade}\n          onClick={() => this.trackClick(toolTipData)}\n        >\n          {this.props.children}\n        </PrimaryLink>\n\n        <FadeContainer>\n          <FadeTransition\n            in={show}\n            mountOnEnter\n            unmountOnExit\n            timeout={{ enter: 200, exit: 250 }}\n          >\n            <ToolTip\n              entity={entity}\n              model={entityType}\n              onMouseLeave={this.hideToolTip}\n              onMouseEnter={() => {\n                this.setState({ inToolTip: true })\n              }}\n              positionLeft={toolTipPosition && toolTipPosition.toolTipLeft}\n              arrowLeft={toolTipPosition && toolTipPosition.arrowLeft}\n              orientation={orientation}\n            />\n          </FadeTransition>\n        </FadeContainer>\n\n        {show && (\n          <Background\n            onMouseLeave={this.onLeaveLink}\n            href={url}\n            target=\"_blank\"\n            onClick={() => this.trackClick(toolTipData)}\n          />\n        )}\n      </Link>\n    )\n  }\n}\n\nexport const PrimaryLink = styled.a.attrs<{ show: boolean }>({})`\n  z-index: auto;\n  color: black;\n  transition: color 0.25s;\n  background-image: linear-gradient(\n    to right,\n    ${Colors.graySemibold} 50%,\n    transparent 50%\n  ) !important;\n  background-size: 3px 1.75px !important;\n  background-position: 0 1.07em !important;\n  ${props =>\n    props.show &&\n    `\n    color: ${Colors.grayDark} !important;\n    background-image: linear-gradient(\n      to right,\n      ${Colors.grayDark} 50%,\n      transparent 50%\n    ) !important;\n  `};\n`\n\nconst FadeContainer = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  right: 0;\n  z-index: 0;\n`\n\nexport const Link = styled.div.attrs<{ onMouseEnter: any; show: boolean }>({})`\n  display: inline-block;\n  position: relative;\n  cursor: pointer;\n  z-index: ${props => (props.show ? 10 : 0)};\n  ${FadeContainer} {\n    ${props => props.show && `z-index: 10`};\n  }\n`\n\nexport const Background = styled.a`\n  position: absolute;\n  left: 0;\n  top: -10px;\n  bottom: -10px;\n  right: 0;\n  z-index: 10;\n  background-image: none !important;\n`\n\nexport default track()(LinkWithTooltip)\n"]}]}