{"remainingRequest":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js??ref--5-1!/Users/eve/development/reaction/src/Components/Publishing/Layouts/ArticleLayout.tsx","dependencies":[{"path":"/Users/eve/development/reaction/src/Components/Publishing/Layouts/ArticleLayout.tsx","mtime":1523976323000},{"path":"/Users/eve/development/reaction/.babelrc","mtime":1519658991000},{"path":"/Users/eve/development/reaction/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js","mtime":1509489566000}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ArticleLayout = void 0;\n\nvar _lodash = require(\"lodash\");\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _styledComponents = _interopRequireDefault(require(\"styled-components\"));\n\nvar _Colors = _interopRequireDefault(require(\"../../../Assets/Colors\"));\n\nvar _Events = _interopRequireDefault(require(\"../../../Utils/Events\"));\n\nvar _Responsive = require(\"../../../Utils/Responsive\");\n\nvar _track = _interopRequireDefault(require(\"../../../Utils/track\"));\n\nvar _Helpers = require(\"../../Helpers\");\n\nvar _Canvas = require(\"../Display/Canvas\");\n\nvar _DisplayPanel = require(\"../Display/DisplayPanel\");\n\nvar _EmailPanel = require(\"../Email/EmailPanel\");\n\nvar _Header = require(\"../Header/Header\");\n\nvar _ReadMoreButton = require(\"../ReadMore/ReadMoreButton\");\n\nvar _ReadMoreWrapper = require(\"../ReadMore/ReadMoreWrapper\");\n\nvar _RelatedArticlesCanvas = require(\"../RelatedArticles/RelatedArticlesCanvas\");\n\nvar _RelatedArticlesPanel = require(\"../RelatedArticles/RelatedArticlesPanel\");\n\nvar _FullscreenViewer = require(\"../Sections/FullscreenViewer/FullscreenViewer\");\n\nvar _withFullScreen = require(\"../Sections/FullscreenViewer/withFullScreen\");\n\nvar _Sections = require(\"../Sections/Sections\");\n\nvar _Sidebar = require(\"./Components/Sidebar\");\n\nvar _FeatureLayout = require(\"./FeatureLayout\");\n\nvar _StandardLayout = require(\"./StandardLayout\");\n\nvar _dec, _class;\n\nvar _templateObject = /*#__PURE__*/ _taggedTemplateLiteral([\"\\n  margin-top: \", \";\\n\"], [\"\\n  margin-top: \", \";\\n\"]),\n    _templateObject2 = /*#__PURE__*/ _taggedTemplateLiteral([\"\\n    margin: 0 20px;\\n  \"], [\"\\n    margin: 0 20px;\\n  \"]);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _taggedTemplateLiteral(strings, raw) { return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nvar ArticleLayout = (_dec = (0, _track.default)(function (props) {\n  return {\n    page: \"Article\",\n    entity_type: \"article\",\n    entity_id: props.article.id\n  };\n}, {\n  dispatch: function dispatch(data) {\n    return _Events.default.postEvent(data);\n  }\n}), _dec(_class = (0, _withFullScreen.withFullScreen)(_class =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(ArticleLayout, _React$Component);\n\n  function ArticleLayout(props) {\n    var _this;\n\n    _classCallCheck(this, ArticleLayout);\n\n    _this = _possibleConstructorReturn(this, (ArticleLayout.__proto__ || Object.getPrototypeOf(ArticleLayout)).call(this, props));\n\n    _initialiseProps.call(_assertThisInitialized(_this));\n\n    var _this$indexAndExtract = _this.indexAndExtractImages(),\n        fullscreenImages = _this$indexAndExtract.fullscreenImages,\n        article = _this$indexAndExtract.article;\n\n    _this.state = {\n      fullscreenImages: fullscreenImages,\n      article: article,\n      isTruncated: props.isTruncated || false\n    };\n    return _this;\n  }\n\n  _createClass(ArticleLayout, [{\n    key: \"renderFeatureArticle\",\n    value: function renderFeatureArticle() {\n      var _props = this.props,\n          headerHeight = _props.headerHeight,\n          isMobile = _props.isMobile,\n          isSuper = _props.isSuper,\n          relatedArticlesForCanvas = _props.relatedArticlesForCanvas;\n      var article = this.state.article;\n      return _react.default.createElement(\"div\", null, _react.default.createElement(_Header.Header, {\n        article: article,\n        height: headerHeight,\n        isMobile: isMobile\n      }), _react.default.createElement(_FeatureLayout.FeatureLayout, {\n        className: \"article-content\"\n      }, _react.default.createElement(_Sections.Sections, {\n        article: article,\n        isMobile: isMobile\n      })), relatedArticlesForCanvas && !isSuper && _react.default.createElement(_RelatedArticlesCanvas.RelatedArticlesCanvas, {\n        articles: relatedArticlesForCanvas,\n        vertical: article.vertical\n      }));\n    }\n  }, {\n    key: \"renderStandardArticle\",\n    value: function renderStandardArticle() {\n      var _this2 = this;\n\n      var _props2 = this.props,\n          display = _props2.display,\n          relatedArticlesForCanvas = _props2.relatedArticlesForCanvas,\n          relatedArticlesForPanel = _props2.relatedArticlesForPanel;\n      var article = this.state.article;\n      var hasPanel = (0, _lodash.get)(display, \"panel\", false);\n      var campaign = (0, _lodash.omit)(display, \"panel\", \"canvas\");\n      var displayOverflows = display && display.canvas.layout === \"slideshow\";\n      return _react.default.createElement(_Responsive.Responsive, {\n        initialState: {\n          isMobile: this.props.isMobile\n        }\n      }, function (_ref) {\n        var isMobile = _ref.isMobile,\n            xs = _ref.xs,\n            sm = _ref.sm,\n            md = _ref.md;\n        var isMobileAd = Boolean(isMobile || xs || sm || md);\n\n        var DisplayPanelAd = function DisplayPanelAd() {\n          return hasPanel && _react.default.createElement(_DisplayPanel.DisplayPanel, {\n            isMobile: isMobileAd,\n            unit: _this2.props.display.panel,\n            campaign: campaign,\n            article: article\n          });\n        };\n\n        return _react.default.createElement(\"div\", null, _react.default.createElement(_ReadMoreWrapper.ReadMoreWrapper, {\n          isTruncated: _this2.state.isTruncated,\n          hideButton: _this2.removeTruncation\n        }, _react.default.createElement(_Header.Header, {\n          article: article,\n          isMobile: isMobile\n        }), _react.default.createElement(_StandardLayout.StandardLayoutParent, null, _react.default.createElement(_StandardLayout.StandardLayout, null, _react.default.createElement(_Sections.Sections, {\n          DisplayPanel: DisplayPanelAd,\n          article: article,\n          isMobile: isMobile\n        }), _react.default.createElement(_Sidebar.Sidebar, null, _this2.props.emailSignupUrl && _react.default.createElement(SidebarItem, null, _react.default.createElement(_EmailPanel.EmailPanel, {\n          signupUrl: _this2.props.emailSignupUrl\n        })), relatedArticlesForPanel && _react.default.createElement(SidebarItem, null, _react.default.createElement(_RelatedArticlesPanel.RelatedArticlesPanel, {\n          label: \"Related Stories\",\n          articles: relatedArticlesForPanel\n        })), !isMobileAd && _this2.props.display && _react.default.createElement(DisplayPanelAd, null)))), relatedArticlesForCanvas && _react.default.createElement(\"div\", null, _react.default.createElement(LineBreak, null), _react.default.createElement(_RelatedArticlesCanvas.RelatedArticlesCanvas, {\n          articles: relatedArticlesForCanvas,\n          isMobile: isMobile,\n          vertical: article.vertical\n        }))), _this2.state.isTruncated && _react.default.createElement(_ReadMoreButton.ReadMore, {\n          onClick: _this2.removeTruncation\n        }), _this2.props.display && _react.default.createElement(\"div\", null, _react.default.createElement(LineBreak, null), displayOverflows ? _react.default.createElement(\"div\", null, _react.default.createElement(_Canvas.DisplayCanvas, {\n          unit: _this2.props.display.canvas,\n          campaign: campaign,\n          article: article\n        })) : _react.default.createElement(FooterContainer, null, _react.default.createElement(_Canvas.DisplayCanvas, {\n          unit: _this2.props.display.canvas,\n          campaign: campaign,\n          article: article\n        }))));\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var article = this.state.article;\n      var marginTop = this.props.marginTop;\n      return _react.default.createElement(ArticleContainer, {\n        marginTop: marginTop\n      }, article.layout === \"feature\" ? this.renderFeatureArticle() : this.renderStandardArticle(), _react.default.createElement(_FullscreenViewer.FullscreenViewer, {\n        onClose: this.props.closeViewer,\n        show: this.props.viewerIsOpen,\n        slideIndex: this.props.slideIndex,\n        images: this.state.fullscreenImages\n      }));\n    }\n  }]);\n\n  return ArticleLayout;\n}(_react.default.Component)) || _class) || _class);\nexports.ArticleLayout = ArticleLayout;\nObject.defineProperty(ArticleLayout, \"defaultProps\", {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  value: {\n    isMobile: false,\n    isSuper: false,\n    article: {},\n    isTruncated: false\n  }\n});\n\nvar _initialiseProps = function _initialiseProps() {\n  var _this3 = this;\n\n  Object.defineProperty(this, \"removeTruncation\", {\n    configurable: true,\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      _this3.setState({\n        isTruncated: false\n      });\n    }\n  });\n  Object.defineProperty(this, \"indexAndExtractImages\", {\n    configurable: true,\n    enumerable: true,\n    writable: true,\n    value: function value() {\n      var article = (0, _lodash.cloneDeep)(_this3.props.article);\n      var fullscreenImages = [];\n      var sectionIndex = 0;\n      var newSections = (0, _lodash.map)(article.sections, function (section) {\n        if ((0, _lodash.includes)([\"image_collection\", \"image_set\"], section.type)) {\n          var newImages = (0, _lodash.map)(section.images, function (image) {\n            image.setTitle = section.title;\n            image.index = sectionIndex;\n            fullscreenImages.push(image);\n            sectionIndex = sectionIndex + 1;\n            return image;\n          });\n          section.images = newImages;\n        }\n\n        return section;\n      });\n      article.sections = newSections;\n      return {\n        fullscreenImages: fullscreenImages,\n        article: article\n      };\n    }\n  });\n};\n\nvar ArticleDiv = _styledComponents.default.div;\nvar ArticleContainer = ArticleDiv(_templateObject, function (props) {\n  return props.marginTop || \"50px\";\n});\n\nvar LineBreak =\n/*#__PURE__*/\n_styledComponents.default.div.withConfig({\n  displayName: \"ArticleLayout__LineBreak\",\n  componentId: \"s1457dek-0\"\n})([\"border-top:1px solid \", \";width:100%;\"], _Colors.default.grayRegular);\n\nvar SidebarItem =\n/*#__PURE__*/\n_styledComponents.default.div.withConfig({\n  displayName: \"ArticleLayout__SidebarItem\",\n  componentId: \"s1457dek-1\"\n})([\"margin-bottom:40px;\"]);\n\nvar FooterContainer =\n/*#__PURE__*/\n_styledComponents.default.div.withConfig({\n  displayName: \"ArticleLayout__FooterContainer\",\n  componentId: \"s1457dek-2\"\n})([\"margin:0 40px;\", \";\"], _Helpers.pMedia.sm(_templateObject2));",{"version":3,"sources":["src/Components/Publishing/Layouts/ArticleLayout.tsx"],"names":["ArticleLayout","page","entity_type","entity_id","props","article","id","dispatch","postEvent","data","indexAndExtractImages","fullscreenImages","state","isTruncated","headerHeight","isMobile","isSuper","relatedArticlesForCanvas","vertical","display","relatedArticlesForPanel","hasPanel","campaign","displayOverflows","canvas","layout","xs","sm","md","isMobileAd","Boolean","DisplayPanelAd","panel","removeTruncation","emailSignupUrl","marginTop","renderFeatureArticle","renderStandardArticle","closeViewer","viewerIsOpen","slideIndex","Component","setState","sectionIndex","newSections","sections","section","type","newImages","images","image","setTitle","title","index","push","ArticleDiv","div","ArticleContainer","LineBreak","grayRegular","SidebarItem","FooterContainer"],"mappings":"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","file":"/Users/eve/development/reaction/src/Components/Publishing/Layouts/ArticleLayout.tsx","sourceRoot":"/Users/eve/development/reaction","sourcesContent":["import { get } from \"lodash\"\nimport { cloneDeep, includes, map, omit } from \"lodash\"\nimport React from \"react\"\nimport styled, { StyledFunction } from \"styled-components\"\nimport Colors from \"../../../Assets/Colors\"\nimport Events from \"../../../Utils/Events\"\nimport { Responsive } from \"../../../Utils/Responsive\"\nimport track from \"../../../Utils/track\"\nimport { pMedia } from \"../../Helpers\"\nimport { DisplayCanvas } from \"../Display/Canvas\"\nimport { DisplayPanel } from \"../Display/DisplayPanel\"\nimport { EmailPanel } from \"../Email/EmailPanel\"\nimport { Header } from \"../Header/Header\"\nimport { ReadMore } from \"../ReadMore/ReadMoreButton\"\nimport { ReadMoreWrapper } from \"../ReadMore/ReadMoreWrapper\"\nimport { RelatedArticlesCanvas } from \"../RelatedArticles/RelatedArticlesCanvas\"\nimport { RelatedArticlesPanel } from \"../RelatedArticles/RelatedArticlesPanel\"\nimport { FullscreenViewer } from \"../Sections/FullscreenViewer/FullscreenViewer\"\nimport { withFullScreen } from \"../Sections/FullscreenViewer/withFullScreen\"\nimport { Sections } from \"../Sections/Sections\"\nimport { ArticleData } from \"../Typings\"\nimport { Sidebar } from \"./Components/Sidebar\"\nimport { FeatureLayout } from \"./FeatureLayout\"\nimport { StandardLayout, StandardLayoutParent } from \"./StandardLayout\"\n\nexport interface ArticleProps {\n  article: ArticleData\n  closeViewer?: () => void\n  display?: {\n    name: string\n    panel: object\n    canvas: any\n  }\n  emailSignupUrl?: string\n  headerHeight?: string\n  isMobile?: boolean\n  isSuper?: boolean\n  isTruncated?: boolean\n  marginTop?: string\n  relatedArticlesForCanvas?: any\n  relatedArticlesForPanel?: any\n  slideIndex?: number\n  viewerIsOpen?: boolean\n}\n\ninterface ArticleState {\n  fullscreenImages: any\n  article: any\n  isTruncated: boolean\n}\n\ninterface ArticleContainerProps {\n  marginTop?: string\n}\n\n@track(\n  props => {\n    return {\n      page: \"Article\",\n      entity_type: \"article\",\n      entity_id: props.article.id,\n    }\n  },\n  {\n    dispatch: data => Events.postEvent(data),\n  }\n)\n@withFullScreen\nexport class ArticleLayout extends React.Component<ArticleProps, ArticleState> {\n  static defaultProps = {\n    isMobile: false,\n    isSuper: false,\n    article: {},\n    isTruncated: false,\n  }\n\n  constructor(props) {\n    super(props)\n    const { fullscreenImages, article } = this.indexAndExtractImages()\n    this.state = {\n      fullscreenImages,\n      article,\n      isTruncated: props.isTruncated || false,\n    }\n  }\n\n  removeTruncation = () => {\n    this.setState({ isTruncated: false })\n  }\n\n  indexAndExtractImages = () => {\n    const article = cloneDeep(this.props.article)\n    const fullscreenImages = []\n    let sectionIndex = 0\n    const newSections = map(article.sections, section => {\n      if (includes([\"image_collection\", \"image_set\"], section.type)) {\n        const newImages = map(section.images, image => {\n          image.setTitle = section.title\n          image.index = sectionIndex\n          fullscreenImages.push(image)\n          sectionIndex = sectionIndex + 1\n          return image\n        })\n        section.images = newImages\n      }\n      return section\n    })\n    article.sections = newSections\n    return { fullscreenImages, article }\n  }\n\n  renderFeatureArticle() {\n    const {\n      headerHeight,\n      isMobile,\n      isSuper,\n      relatedArticlesForCanvas,\n    } = this.props\n    const { article } = this.state\n\n    return (\n      <div>\n        <Header article={article} height={headerHeight} isMobile={isMobile} />\n\n        <FeatureLayout className=\"article-content\">\n          <Sections article={article} isMobile={isMobile} />\n        </FeatureLayout>\n\n        {relatedArticlesForCanvas &&\n          !isSuper && (\n            <RelatedArticlesCanvas\n              articles={relatedArticlesForCanvas}\n              vertical={article.vertical}\n            />\n          )}\n      </div>\n    )\n  }\n\n  renderStandardArticle() {\n    const {\n      display,\n      relatedArticlesForCanvas,\n      relatedArticlesForPanel,\n    } = this.props\n\n    const { article } = this.state\n\n    const hasPanel = get(display, \"panel\", false)\n    const campaign = omit(display, \"panel\", \"canvas\")\n    const displayOverflows = display && display.canvas.layout === \"slideshow\"\n\n    return (\n      <Responsive initialState={{ isMobile: this.props.isMobile }}>\n        {({ isMobile, xs, sm, md }) => {\n          const isMobileAd = Boolean(isMobile || xs || sm || md)\n\n          const DisplayPanelAd = () => {\n            return (\n              hasPanel && (\n                <DisplayPanel\n                  isMobile={isMobileAd}\n                  unit={this.props.display.panel}\n                  campaign={campaign}\n                  article={article}\n                />\n              )\n            )\n          }\n\n          return (\n            <div>\n              <ReadMoreWrapper\n                isTruncated={this.state.isTruncated}\n                hideButton={this.removeTruncation}\n              >\n                {/*\n                  Header\n                */}\n                <Header article={article} isMobile={isMobile} />\n\n                <StandardLayoutParent>\n                  <StandardLayout>\n                    {/*\n                      Body Content\n                    */}\n                    <Sections\n                      DisplayPanel={DisplayPanelAd}\n                      article={article}\n                      isMobile={isMobile}\n                    />\n\n                    {/*\n                      Sidebar\n                    */}\n                    <Sidebar>\n                      {this.props.emailSignupUrl && (\n                        <SidebarItem>\n                          <EmailPanel signupUrl={this.props.emailSignupUrl} />\n                        </SidebarItem>\n                      )}\n\n                      {/*\n                        Related Articles\n                      */}\n                      {relatedArticlesForPanel && (\n                        <SidebarItem>\n                          <RelatedArticlesPanel\n                            label={\"Related Stories\"}\n                            articles={relatedArticlesForPanel}\n                          />\n                        </SidebarItem>\n                      )}\n\n                      {/*\n                        Display Ad\n                      */}\n                      {!isMobileAd && this.props.display && <DisplayPanelAd />}\n                    </Sidebar>\n                  </StandardLayout>\n                </StandardLayoutParent>\n\n                {/*\n                  Canvas: Related Articles\n                */}\n                {relatedArticlesForCanvas && (\n                  <div>\n                    <LineBreak />\n                    <RelatedArticlesCanvas\n                      articles={relatedArticlesForCanvas}\n                      isMobile={isMobile}\n                      vertical={article.vertical}\n                    />\n                  </div>\n                )}\n              </ReadMoreWrapper>\n\n              {/*\n                Read More Button\n              */}\n              {this.state.isTruncated && (\n                <ReadMore onClick={this.removeTruncation} />\n              )}\n\n              {/*\n                Footer\n              */}\n              {this.props.display && (\n                <div>\n                  <LineBreak />\n\n                  {displayOverflows ? (\n                    <div>\n                      <DisplayCanvas\n                        unit={this.props.display.canvas}\n                        campaign={campaign}\n                        article={article}\n                      />\n                    </div>\n                  ) : (\n                    <FooterContainer>\n                      <DisplayCanvas\n                        unit={this.props.display.canvas}\n                        campaign={campaign}\n                        article={article}\n                      />\n                    </FooterContainer>\n                  )}\n                </div>\n              )}\n            </div>\n          )\n        }}\n      </Responsive>\n    )\n  }\n\n  render() {\n    const { article } = this.state\n    const { marginTop } = this.props\n\n    return (\n      <ArticleContainer marginTop={marginTop}>\n        {article.layout === \"feature\"\n          ? this.renderFeatureArticle()\n          : this.renderStandardArticle()}\n\n        <FullscreenViewer\n          onClose={this.props.closeViewer}\n          show={this.props.viewerIsOpen}\n          slideIndex={this.props.slideIndex}\n          images={this.state.fullscreenImages}\n        />\n      </ArticleContainer>\n    )\n  }\n}\n\nconst ArticleDiv: StyledFunction<\n  ArticleContainerProps & React.HTMLProps<HTMLDivElement>\n> =\n  styled.div\n\nconst ArticleContainer = ArticleDiv`\n  margin-top: ${props => props.marginTop || \"50px\"};\n`\n\nconst LineBreak = styled.div`\n  border-top: 1px solid ${Colors.grayRegular};\n  width: 100%;\n`\n\nconst SidebarItem = styled.div`\n  margin-bottom: 40px;\n`\n\nconst FooterContainer = styled.div`\n  margin: 0 40px;\n  ${pMedia.sm`\n    margin: 0 20px;\n  `};\n`\n"]}]}