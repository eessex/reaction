{"remainingRequest":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js??ref--6-1!/Users/eve/development/reaction/src/Components/Publishing/Display/Canvas/CanvasContainer.tsx","dependencies":[{"path":"/Users/eve/development/reaction/src/Components/Publishing/Display/Canvas/CanvasContainer.tsx","mtime":1535727435000},{"path":"/Users/eve/development/reaction/.babelrc","mtime":1537112679000},{"path":"/Users/eve/development/reaction/node_modules/cache-loader/dist/cjs.js","mtime":0},{"path":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["var _dec, _dec2, _class, _class2, _class3, _temp;\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _templateObject6() {\n  var data = _taggedTemplateLiteral([\"\\n  background: black;\\n  position: absolute;\\n  left: 0;\\n  right: 0;\\n  top: 0;\\n  bottom: 0;\\n  z-index: -1;\\n  &:before {\\n    content: '';\\n    background-image: url(\", \");\\n    position: absolute;\\n    left: 0;\\n    right: 0;\\n    top: 0;\\n    bottom: 0;\\n    background-size: cover;\\n    background-position: 50%;\\n    z-index: 1;\\n    opacity: .7;\\n  }\\n\"]);\n\n  _templateObject6 = function _templateObject6() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject5() {\n  var data = _taggedTemplateLiteral([\"\\n    max-width: 100%;\\n    width: 100%;\\n    height: auto;\\n  \"]);\n\n  _templateObject5 = function _templateObject5() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n    padding: 0;\\n    width: 100%;\\n    height: 400px;\\n    min-height: fit-content;\\n    flex-direction: column;\\n    justify-content: flex-start;\\n  \"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n    \", \"\\n  \"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 460px;\\n  color: #000;\\n  text-decoration: none;\\n  align-items: center;\\n  position: relative;\\n  display: flex;\\n  flex-direction: row-reverse;\\n  justify-content: \", \"\\n  \", \"\\n  \", \"\\n\"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    width: 100%;\\n    max-width: 100%;\\n    height: auto;\\n    max-height: initial;\\n    object-fit: contain;\\n  \"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _taggedTemplateLiteral(strings, raw) { if (!raw) { raw = strings.slice(0); } return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) { var desc = {}; Object['ke' + 'ys'](descriptor).forEach(function (key) { desc[key] = descriptor[key]; }); desc.enumerable = !!desc.enumerable; desc.configurable = !!desc.configurable; if ('value' in desc || desc.initializer) { desc.writable = true; } desc = decorators.slice().reverse().reduce(function (desc, decorator) { return decorator(target, property, desc) || desc; }, desc); if (context && desc.initializer !== void 0) { desc.value = desc.initializer ? desc.initializer.call(context) : void 0; desc.initializer = undefined; } if (desc.initializer === void 0) { Object['define' + 'Property'](target, property, desc); desc = null; } return desc; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); }\n\nfunction _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nimport React from \"react\";\nimport sizeMe from \"react-sizeme\";\nimport track from \"react-tracking\";\nimport styled from \"styled-components\";\nimport { crop } from \"../../../../Utils/resizer\";\nimport { pMedia } from \"../../../Helpers\";\nimport { getCurrentUnixTimestamp } from \"../../Constants\";\nimport { SIZE_ME_REFRESH_RATE } from \"../../Constants\";\nimport { replaceWithCacheBuster } from \"../ExternalTrackers\";\nimport { CanvasSlideshow } from \"./CanvasSlideshow\";\nimport { CanvasText } from \"./CanvasText\";\nimport { CanvasVideo } from \"./CanvasVideo\";\nexport var CanvasContainerComponent = (_dec = track(), _dec2 = track(function (props, state, _ref) {\n  var _ref2 = _slicedToArray(_ref, 1),\n      e = _ref2[0];\n\n  if (!isVideoClickArea(e)) {\n    return {\n      action: \"Click\",\n      label: \"Display ad clickthrough\",\n      entity_type: \"display_ad\",\n      campaign_name: props.campaign.name,\n      unit_layout: unitLayout(props)\n    };\n  }\n}), _dec(_class = (_class2 = (_temp = _class3 =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(CanvasContainerComponent, _React$Component);\n\n  function CanvasContainerComponent(props) {\n    var _this;\n\n    _classCallCheck(this, CanvasContainerComponent);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(CanvasContainerComponent).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"canvasVideoHandlers\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"state\", {\n      isMounted: false\n    });\n\n    _this.openLink = _this.openLink.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(CanvasContainerComponent, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.setState({\n        isMounted: true\n      });\n    } // TODO: Ensure that full element can be clicked on video complete\n    // Prevent links from blocking video playback.\n\n  }, {\n    key: \"openLink\",\n    value: function openLink(e) {\n      e.preventDefault();\n\n      if (!isVideoClickArea(e)) {\n        if (this.canvasVideoHandlers) {\n          this.canvasVideoHandlers.pauseVideo();\n        }\n\n        var url = replaceWithCacheBuster(e.currentTarget.attributes.href.value, getCurrentUnixTimestamp());\n        window.open(url, \"_blank\");\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          campaign = _this$props.campaign,\n          disclaimer = _this$props.disclaimer,\n          size = _this$props.size,\n          unit = _this$props.unit;\n      var assets = unit.assets,\n          cover_image_url = unit.cover_image_url,\n          layout = unit.layout,\n          url = unit.link.url;\n      var isOverlay = layout === \"overlay\";\n      var isSlideshow = layout === \"slideshow\"; // Props for Link units\n\n      var linkProps = {\n        onClick: this.openLink,\n        href: url,\n        target: \"_blank\",\n        containerWidth: size.width,\n        layout: layout // TODO: For whatever the slideshow leads to a race condition when rendering\n        // app in Force. Defer execution and everything works fine.\n\n      };\n\n      if (!this.state.isMounted) {\n        return React.createElement(\"div\", null);\n      } // Overlay\n\n\n      if (isOverlay) {\n        var _backgroundUrl = assets[0].url;\n        return React.createElement(CanvasLink, linkProps, React.createElement(Background, {\n          backgroundUrl: _backgroundUrl\n        }), React.createElement(CanvasText, {\n          unit: unit\n        })); // Slideshow\n      } else if (isSlideshow) {\n        var slideshowProps = {\n          unit: unit,\n          campaign: campaign,\n          disclaimer: disclaimer,\n          containerWidth: size.width\n        };\n        return React.createElement(CanvasSlideshow, slideshowProps, React.createElement(CanvasLink, linkProps, React.createElement(CanvasText, {\n          unit: unit,\n          disclaimer: disclaimer\n        }))); // Video / Image\n      } else {\n        var _unit$assets = _slicedToArray(unit.assets, 1),\n            asset = _unit$assets[0];\n\n        var src = asset && asset.url || \"\";\n        var isVideo = src.includes(\"mp4\");\n        return React.createElement(CanvasLink, linkProps, isVideo ? React.createElement(CanvasVideo, {\n          coverUrl: cover_image_url,\n          src: src,\n          campaign: campaign,\n          onInit: function onInit(h) {\n            return _this2.canvasVideoHandlers = h;\n          }\n        }) : src && React.createElement(Image, {\n          src: crop(src, {\n            width: 1200,\n            height: 760,\n            isDisplayAd: true\n          })\n        }), React.createElement(StandardContainer, null, React.createElement(CanvasText, {\n          unit: unit,\n          disclaimer: disclaimer\n        })));\n      }\n    }\n  }]);\n\n  return CanvasContainerComponent;\n}(React.Component), _defineProperty(_class3, \"defaultProps\", {\n  size: {\n    width: 1250\n  }\n}), _temp), (_applyDecoratedDescriptor(_class2.prototype, \"openLink\", [_dec2], Object.getOwnPropertyDescriptor(_class2.prototype, \"openLink\"), _class2.prototype)), _class2)) || _class);\nvar Div = styled.div;\nvar responsiveLink = styled.a;\nexport var unitLayout = function unitLayout(props) {\n  switch (props.unit.layout) {\n    case \"overlay\":\n      return \"canvas_overlay\";\n\n    case \"slideshow\":\n      return \"canvas_slideshow\";\n\n    default:\n      return \"canvas_standard\";\n  }\n};\n\nvar isVideoClickArea = function isVideoClickArea(e) {\n  var videoClasses = [\"PlayButton\", \"PlayButton__PlayButtonCaret\", \"CanvasVideo__video\", \"CanvasVideo__cover\"];\n  var isVideo = videoClasses.some(function (c) {\n    return e.target.className.includes(c);\n  });\n  return isVideo;\n};\n\nexport var maxAssetSize = function maxAssetSize(containerWidth) {\n  var width = containerWidth * 0.65;\n  var height = width * 0.59;\n  return {\n    width: width,\n    height: height\n  };\n};\nvar Image = styled.img.withConfig({\n  displayName: \"CanvasContainer__Image\",\n  componentId: \"qubp26-0\"\n})([\"display:block;width:65%;height:100%;object-fit:cover;\", \";\"], pMedia.sm(_templateObject()));\nexport var CanvasLink = responsiveLink(_templateObject2(), function (props) {\n  return props.layout === \"standard\" ? \"space-between;\" : \"center;\";\n}, function (props) {\n  return pMedia.lg(_templateObject3(), props.layout !== \"overlay\" && \"max-height: \" + maxAssetSize(props.containerWidth).height + \"px;\");\n}, pMedia.sm(_templateObject4()));\nvar StandardContainer = styled.div.withConfig({\n  displayName: \"CanvasContainer__StandardContainer\",\n  componentId: \"qubp26-1\"\n})([\"max-width:calc(35% - 20px);height:100%;margin-right:auto;\", \";\"], pMedia.sm(_templateObject5()));\nvar Background = Div(_templateObject6(), function (props) {\n  return props.backgroundUrl && props.backgroundUrl;\n});\nvar sizeMeOptions = {\n  refreshRate: SIZE_ME_REFRESH_RATE,\n  noPlaceholder: true\n};\nexport var CanvasContainer = sizeMe(sizeMeOptions)(CanvasContainerComponent);",{"version":3,"sources":["/Users/eve/development/reaction/src/Components/Publishing/Display/Canvas/CanvasContainer.tsx"],"names":["React","sizeMe","track","styled","crop","pMedia","getCurrentUnixTimestamp","SIZE_ME_REFRESH_RATE","replaceWithCacheBuster","CanvasSlideshow","CanvasText","CanvasVideo","CanvasContainerComponent","props","state","e","isVideoClickArea","action","label","entity_type","campaign_name","campaign","name","unit_layout","unitLayout","isMounted","openLink","bind","setState","preventDefault","canvasVideoHandlers","pauseVideo","url","currentTarget","attributes","href","value","window","open","disclaimer","size","unit","assets","cover_image_url","layout","link","isOverlay","isSlideshow","linkProps","onClick","target","containerWidth","width","backgroundUrl","slideshowProps","asset","src","isVideo","includes","h","height","isDisplayAd","Component","Div","div","responsiveLink","a","videoClasses","some","c","className","maxAssetSize","Image","img","sm","CanvasLink","lg","StandardContainer","Background","sizeMeOptions","refreshRate","noPlaceholder","CanvasContainer"],"mappings":"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","sourcesContent":["import React from \"react\"\nimport sizeMe from \"react-sizeme\"\nimport track from \"react-tracking\"\nimport styled, { StyledFunction } from \"styled-components\"\nimport { crop } from \"../../../../Utils/resizer\"\nimport { pMedia } from \"../../../Helpers\"\nimport { getCurrentUnixTimestamp } from \"../../Constants\"\nimport { SIZE_ME_REFRESH_RATE } from \"../../Constants\"\nimport { replaceWithCacheBuster } from \"../ExternalTrackers\"\nimport { CanvasSlideshow } from \"./CanvasSlideshow\"\nimport { CanvasText } from \"./CanvasText\"\nimport { CanvasVideo } from \"./CanvasVideo\"\n\ninterface CanvasContainerProps {\n  campaign: any\n  article?: any\n  disclaimer?: any\n  size?: {\n    width: number\n  }\n  unit?: any\n}\n\ninterface State {\n  isMounted: boolean\n}\n\n@track()\nexport class CanvasContainerComponent extends React.Component<\n  CanvasContainerProps,\n  State\n> {\n  static defaultProps = {\n    size: { width: 1250 },\n  }\n\n  public canvasVideoHandlers: any\n\n  state = {\n    isMounted: false,\n  }\n\n  constructor(props) {\n    super(props)\n    this.openLink = this.openLink.bind(this)\n  }\n\n  componentDidMount() {\n    this.setState({\n      isMounted: true,\n    })\n  }\n\n  // TODO: Ensure that full element can be clicked on video complete\n  // Prevent links from blocking video playback.\n  @track((props, state, [e]) => {\n    if (!isVideoClickArea(e)) {\n      return {\n        action: \"Click\",\n        label: \"Display ad clickthrough\",\n        entity_type: \"display_ad\",\n        campaign_name: props.campaign.name,\n        unit_layout: unitLayout(props),\n      }\n    }\n  })\n  openLink(e) {\n    e.preventDefault()\n\n    if (!isVideoClickArea(e)) {\n      if (this.canvasVideoHandlers) {\n        this.canvasVideoHandlers.pauseVideo()\n      }\n\n      const url = replaceWithCacheBuster(\n        e.currentTarget.attributes.href.value,\n        getCurrentUnixTimestamp()\n      )\n      window.open(url, \"_blank\")\n    }\n  }\n\n  render() {\n    const { campaign, disclaimer, size, unit } = this.props\n    const {\n      assets,\n      cover_image_url,\n      layout,\n      link: { url },\n    } = unit\n    const isOverlay = layout === \"overlay\"\n    const isSlideshow = layout === \"slideshow\"\n\n    // Props for Link units\n    const linkProps = {\n      onClick: this.openLink,\n      href: url,\n      target: \"_blank\",\n      containerWidth: size.width,\n      layout,\n    }\n\n    // TODO: For whatever the slideshow leads to a race condition when rendering\n    // app in Force. Defer execution and everything works fine.\n    if (!this.state.isMounted) {\n      return <div />\n    }\n\n    // Overlay\n    if (isOverlay) {\n      const backgroundUrl = assets[0].url\n\n      return (\n        <CanvasLink {...linkProps}>\n          <Background backgroundUrl={backgroundUrl} />\n          <CanvasText unit={unit} />\n        </CanvasLink>\n      )\n\n      // Slideshow\n    } else if (isSlideshow) {\n      const slideshowProps = {\n        unit,\n        campaign,\n        disclaimer,\n        containerWidth: size.width,\n      }\n\n      return (\n        <CanvasSlideshow {...slideshowProps}>\n          <CanvasLink {...linkProps}>\n            <CanvasText unit={unit} disclaimer={disclaimer} />\n          </CanvasLink>\n        </CanvasSlideshow>\n      )\n\n      // Video / Image\n    } else {\n      const [asset] = unit.assets\n      const src = (asset && asset.url) || \"\"\n      const isVideo = src.includes(\"mp4\")\n\n      return (\n        <CanvasLink {...linkProps}>\n          {isVideo ? (\n            <CanvasVideo\n              coverUrl={cover_image_url}\n              src={src}\n              campaign={campaign}\n              onInit={h => (this.canvasVideoHandlers = h)}\n            />\n          ) : (\n            src && (\n              <Image\n                src={crop(src, {\n                  width: 1200,\n                  height: 760,\n                  isDisplayAd: true,\n                })}\n              />\n            )\n          )}\n\n          <StandardContainer>\n            <CanvasText unit={unit} disclaimer={disclaimer} />\n          </StandardContainer>\n        </CanvasLink>\n      )\n    }\n  }\n}\n\ninterface DivProps extends React.HTMLProps<HTMLDivElement> {\n  backgroundUrl?: string\n}\n\ninterface ResponsiveProps extends React.HTMLProps<HTMLLinkElement> {\n  containerWidth: any\n  href: any\n  layout: string\n  target: string\n}\n\nconst Div: StyledFunction<DivProps> = styled.div\nconst responsiveLink: StyledFunction<ResponsiveProps> = styled.a\n\nexport const unitLayout = props => {\n  switch (props.unit.layout) {\n    case \"overlay\":\n      return \"canvas_overlay\"\n    case \"slideshow\":\n      return \"canvas_slideshow\"\n    default:\n      return \"canvas_standard\"\n  }\n}\n\nconst isVideoClickArea = e => {\n  const videoClasses = [\n    \"PlayButton\",\n    \"PlayButton__PlayButtonCaret\",\n    \"CanvasVideo__video\",\n    \"CanvasVideo__cover\",\n  ]\n\n  const isVideo = videoClasses.some(c => {\n    return e.target.className.includes(c)\n  })\n  return isVideo\n}\n\nexport const maxAssetSize = containerWidth => {\n  const width = containerWidth * 0.65\n  const height = width * 0.59\n  return { width, height }\n}\n\nconst Image = styled.img`\n  display: block;\n  width: 65%;\n  height: 100%;\n  object-fit: cover;\n  ${pMedia.sm`\n    width: 100%;\n    max-width: 100%;\n    height: auto;\n    max-height: initial;\n    object-fit: contain;\n  `};\n`\nexport const CanvasLink = responsiveLink`\n  width: 100%;\n  height: 460px;\n  color: #000;\n  text-decoration: none;\n  align-items: center;\n  position: relative;\n  display: flex;\n  flex-direction: row-reverse;\n  justify-content: ${props =>\n    props.layout === \"standard\" ? \"space-between;\" : \"center;\"}\n  ${props => pMedia.lg`\n    ${props.layout !== \"overlay\" &&\n      \"max-height: \" + maxAssetSize(props.containerWidth).height + \"px;\"}\n  `}\n  ${pMedia.sm`\n    padding: 0;\n    width: 100%;\n    height: 400px;\n    min-height: fit-content;\n    flex-direction: column;\n    justify-content: flex-start;\n  `}\n`\nconst StandardContainer = styled.div`\n  max-width: calc(35% - 20px);\n  height: 100%;\n  margin-right: auto;\n  ${pMedia.sm`\n    max-width: 100%;\n    width: 100%;\n    height: auto;\n  `};\n`\nconst Background = Div`\n  background: black;\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  z-index: -1;\n  &:before {\n    content: '';\n    background-image: url(${props =>\n      props.backgroundUrl && props.backgroundUrl});\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    background-size: cover;\n    background-position: 50%;\n    z-index: 1;\n    opacity: .7;\n  }\n`\n\nconst sizeMeOptions = {\n  refreshRate: SIZE_ME_REFRESH_RATE,\n  noPlaceholder: true,\n}\n\nexport const CanvasContainer = sizeMe(sizeMeOptions)(CanvasContainerComponent)\n"]}]}