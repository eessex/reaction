{"remainingRequest":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js??ref--5-1!/Users/eve/development/reaction/src/Components/Publishing/Display/Canvas/CanvasVideo.tsx","dependencies":[{"path":"/Users/eve/development/reaction/src/Components/Publishing/Display/Canvas/CanvasVideo.tsx","mtime":1524585020000},{"path":"/Users/eve/development/reaction/.babelrc","mtime":1527877289000},{"path":"/Users/eve/development/reaction/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js","mtime":1509489566000}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CanvasVideo = void 0;\n\nvar _lodash = require(\"lodash\");\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _styledComponents = _interopRequireDefault(require(\"styled-components\"));\n\nvar _track = require(\"../../../../Utils/track\");\n\nvar _Helpers = require(\"../../../Helpers\");\n\nvar _VideoControls = require(\"../../Sections/VideoControls\");\n\nvar _dec, _dec2, _class, _class2;\n\nvar _templateObject = /*#__PURE__*/ _taggedTemplateLiteral([\"\\n    width: 100%;\\n    height: auto;\\n    overflow: visible;\\n    video {\\n      height: auto;\\n    }\\n  \"], [\"\\n    width: 100%;\\n    height: auto;\\n    overflow: visible;\\n    video {\\n      height: auto;\\n    }\\n  \"]),\n    _templateObject2 = /*#__PURE__*/ _taggedTemplateLiteral([\"\\n  background: url(\", \") no-repeat center center;\\n  background-size: cover;\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n  right: 0;\\n  bottom: 0;\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n\"], [\"\\n  background: url(\", \") no-repeat center center;\\n  background-size: cover;\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n  right: 0;\\n  bottom: 0;\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n\"]);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _taggedTemplateLiteral(strings, raw) { return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) { var desc = {}; Object['ke' + 'ys'](descriptor).forEach(function (key) { desc[key] = descriptor[key]; }); desc.enumerable = !!desc.enumerable; desc.configurable = !!desc.configurable; if ('value' in desc || desc.initializer) { desc.writable = true; } desc = decorators.slice().reverse().reduce(function (desc, decorator) { return decorator(target, property, desc) || desc; }, desc); if (context && desc.initializer !== void 0) { desc.value = desc.initializer ? desc.initializer.call(context) : void 0; desc.initializer = undefined; } if (desc.initializer === void 0) { Object['define' + 'Property'](target, property, desc); desc = null; } return desc; }\n\nvar CanvasVideo = (_dec = (0, _track.track)(), _dec2 = (0, _track.track)((0, _lodash.once)(function (props) {\n  return {\n    action: \"Click\",\n    label: \"Display ad play video\",\n    entity_type: \"display_ad\",\n    campaign_name: props.campaign.name,\n    unit_layout: \"canvas_standard\"\n  };\n})), _dec(_class = (_class2 =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(CanvasVideo, _Component);\n\n  function CanvasVideo(props) {\n    var _this;\n\n    _classCallCheck(this, CanvasVideo);\n\n    _this = _possibleConstructorReturn(this, (CanvasVideo.__proto__ || Object.getPrototypeOf(CanvasVideo)).call(this, props));\n    Object.defineProperty(_assertThisInitialized(_this), \"video\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_assertThisInitialized(_this), \"trackProgress\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value() {\n        var secondsComplete = Math.floor(_this.video.currentTime);\n        var percentComplete = Math.floor(_this.video.currentTime / _this.video.duration * 100);\n        var percentCompleteInterval = Math.floor(percentComplete / 25) * 25; // Track 25% duration intervals\n\n        if (percentCompleteInterval > 0) {\n          _this.trackDuration(percentCompleteInterval);\n        } // Track 3 & 10 seconds\n\n\n        if (secondsComplete === 3 || secondsComplete === 10) {\n          _this.trackSeconds(secondsComplete);\n        }\n      }\n    });\n    Object.defineProperty(_assertThisInitialized(_this), \"trackDuration\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: (0, _lodash.memoize)(function (percentComplete) {\n        _this.props.tracking.trackEvent({\n          action: \"Video duration\",\n          label: \"Display ad video duration\",\n          percent_complete: percentComplete,\n          campaign_name: _this.props.campaign.name,\n          unit_layout: \"canvas_standard\"\n        });\n      })\n    });\n    Object.defineProperty(_assertThisInitialized(_this), \"trackSeconds\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: (0, _lodash.memoize)(function (secondsComplete) {\n        _this.props.tracking.trackEvent({\n          action: \"Video seconds\",\n          label: \"Display ad video seconds\",\n          seconds_complete: secondsComplete,\n          campaign_name: _this.props.campaign.name,\n          unit_layout: \"canvas_standard\"\n        });\n      })\n    });\n    Object.defineProperty(_assertThisInitialized(_this), \"playVideo\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value() {\n        if (_this.video) {\n          _this.video.play();\n\n          _this.setState({\n            isPlaying: true\n          });\n        }\n      }\n    });\n    Object.defineProperty(_assertThisInitialized(_this), \"pauseVideo\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value() {\n        if (_this.video) {\n          _this.video.pause();\n\n          _this.setState({\n            isPlaying: false\n          });\n        }\n      }\n    });\n    Object.defineProperty(_assertThisInitialized(_this), \"toggleVideo\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value() {\n        if (_this.state.isPlaying) {\n          _this.pauseVideo();\n        } else {\n          _this.playVideo();\n        }\n      }\n    });\n    _this.onPlayVideo = _this.onPlayVideo.bind(_assertThisInitialized(_this));\n    _this.state = {\n      isPlaying: false\n    };\n    return _this;\n  }\n\n  _createClass(CanvasVideo, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var onInit = this.props.onInit;\n\n      if (onInit) {\n        // Pass handlers back to CanvasContainer so that it can pause video\n        // when Display is clicked.\n        onInit({\n          playVideo: this.playVideo,\n          pauseVideo: this.pauseVideo,\n          toggleVideo: this.toggleVideo\n        });\n      }\n    }\n  }, {\n    key: \"componentWillUpdate\",\n    value: function componentWillUpdate() {\n      this.video.removeEventListener(\"timeupdate\", this.trackProgress);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      this.video.addEventListener(\"timeupdate\", this.trackProgress);\n    }\n  }, {\n    key: \"onPlayVideo\",\n    value: function onPlayVideo() {\n      this.toggleVideo();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var isPlaying = this.state.isPlaying;\n      return _react.default.createElement(VideoContainer, {\n        onClick: this.onPlayVideo\n      }, !isPlaying && _react.default.createElement(Cover, {\n        coverUrl: this.props.coverUrl\n      }, _react.default.createElement(_VideoControls.VideoControls, null)), _react.default.createElement(\"video\", {\n        playsInline: true,\n        src: this.props.src,\n        className: \"CanvasVideo__video\",\n        controls: false,\n        ref: function ref(video) {\n          return _this2.video = video;\n        }\n      }));\n    }\n  }]);\n\n  return CanvasVideo;\n}(_react.Component), (_applyDecoratedDescriptor(_class2.prototype, \"onPlayVideo\", [_dec2], Object.getOwnPropertyDescriptor(_class2.prototype, \"onPlayVideo\"), _class2.prototype)), _class2)) || _class);\nexports.CanvasVideo = CanvasVideo;\nObject.defineProperty(CanvasVideo, \"defaultProps\", {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  value: {\n    coverUrl: \"\"\n  }\n});\n\nvar VideoContainer =\n/*#__PURE__*/\n_styledComponents.default.div.withConfig({\n  displayName: \"CanvasVideo__VideoContainer\",\n  componentId: \"o24y14-0\"\n})([\"width:65%;max-width:760px;height:100%;overflow:hidden;position:relative;video{width:100%;height:100%;object-fit:cover;}\", \";\"], _Helpers.pMedia.sm(_templateObject));\n\nvar div = _styledComponents.default.div;\nvar Cover = div(_templateObject2, function (p) {\n  return p.coverUrl || \"\";\n});",{"version":3,"sources":["src/Components/Publishing/Display/Canvas/CanvasVideo.tsx"],"names":["CanvasVideo","action","label","entity_type","campaign_name","props","campaign","name","unit_layout","secondsComplete","Math","floor","video","currentTime","percentComplete","duration","percentCompleteInterval","trackDuration","trackSeconds","tracking","trackEvent","percent_complete","seconds_complete","play","setState","isPlaying","pause","state","pauseVideo","playVideo","onPlayVideo","bind","onInit","toggleVideo","removeEventListener","trackProgress","addEventListener","coverUrl","src","VideoContainer","div","sm","Cover","p"],"mappings":"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","file":"/Users/eve/development/reaction/src/Components/Publishing/Display/Canvas/CanvasVideo.tsx","sourceRoot":"/Users/eve/development/reaction","sourcesContent":["import { memoize, once } from \"lodash\"\nimport React, { Component } from \"react\"\nimport styled, { StyledFunction } from \"styled-components\"\nimport { track } from \"../../../../Utils/track\"\nimport { pMedia } from \"../../../Helpers\"\nimport { VideoControls } from \"../../Sections/VideoControls\"\n\ninterface Props {\n  campaign: any\n  coverUrl?: string\n  src: any\n  onInit?: any\n  tracking?: any\n}\n\n@track()\nexport class CanvasVideo extends Component<Props, any> {\n  public video: HTMLVideoElement\n\n  static defaultProps = {\n    coverUrl: \"\",\n  }\n\n  constructor(props) {\n    super(props)\n    this.onPlayVideo = this.onPlayVideo.bind(this)\n\n    this.state = {\n      isPlaying: false,\n    }\n  }\n\n  componentDidMount() {\n    const { onInit } = this.props\n\n    if (onInit) {\n      // Pass handlers back to CanvasContainer so that it can pause video\n      // when Display is clicked.\n      onInit({\n        playVideo: this.playVideo,\n        pauseVideo: this.pauseVideo,\n        toggleVideo: this.toggleVideo,\n      })\n    }\n  }\n\n  componentWillUpdate() {\n    this.video.removeEventListener(\"timeupdate\", this.trackProgress)\n  }\n\n  componentDidUpdate() {\n    this.video.addEventListener(\"timeupdate\", this.trackProgress)\n  }\n\n  trackProgress = () => {\n    const secondsComplete = Math.floor(this.video.currentTime)\n    const percentComplete = Math.floor(\n      this.video.currentTime / this.video.duration * 100\n    )\n    const percentCompleteInterval = Math.floor(percentComplete / 25) * 25\n\n    // Track 25% duration intervals\n    if (percentCompleteInterval > 0) {\n      this.trackDuration(percentCompleteInterval)\n    }\n\n    // Track 3 & 10 seconds\n    if (secondsComplete === 3 || secondsComplete === 10) {\n      this.trackSeconds(secondsComplete)\n    }\n  }\n\n  trackDuration = memoize(percentComplete => {\n    this.props.tracking.trackEvent({\n      action: \"Video duration\",\n      label: \"Display ad video duration\",\n      percent_complete: percentComplete,\n      campaign_name: this.props.campaign.name,\n      unit_layout: \"canvas_standard\",\n    })\n  })\n\n  trackSeconds = memoize(secondsComplete => {\n    this.props.tracking.trackEvent({\n      action: \"Video seconds\",\n      label: \"Display ad video seconds\",\n      seconds_complete: secondsComplete,\n      campaign_name: this.props.campaign.name,\n      unit_layout: \"canvas_standard\",\n    })\n  })\n\n  @track(\n    once(props => ({\n      action: \"Click\",\n      label: \"Display ad play video\",\n      entity_type: \"display_ad\",\n      campaign_name: props.campaign.name,\n      unit_layout: \"canvas_standard\",\n    }))\n  )\n  onPlayVideo() {\n    this.toggleVideo()\n  }\n\n  playVideo = () => {\n    if (this.video) {\n      this.video.play()\n\n      this.setState({\n        isPlaying: true,\n      })\n    }\n  }\n\n  pauseVideo = () => {\n    if (this.video) {\n      this.video.pause()\n\n      this.setState({\n        isPlaying: false,\n      })\n    }\n  }\n\n  toggleVideo = () => {\n    if (this.state.isPlaying) {\n      this.pauseVideo()\n    } else {\n      this.playVideo()\n    }\n  }\n\n  render() {\n    const { isPlaying } = this.state\n\n    return (\n      <VideoContainer onClick={this.onPlayVideo}>\n        {!isPlaying && (\n          <Cover coverUrl={this.props.coverUrl}>\n            <VideoControls />\n          </Cover>\n        )}\n\n        <video\n          playsInline\n          src={this.props.src}\n          className=\"CanvasVideo__video\"\n          controls={false}\n          ref={video => (this.video = video)}\n        />\n      </VideoContainer>\n    )\n  }\n}\n\nconst VideoContainer = styled.div`\n  width: 65%;\n  max-width: 760px;\n  height: 100%;\n  overflow: hidden;\n  position: relative;\n\n  video {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n  }\n\n  ${pMedia.sm`\n    width: 100%;\n    height: auto;\n    overflow: visible;\n    video {\n      height: auto;\n    }\n  `};\n`\n\nconst div: StyledFunction<{\n  coverUrl?: string\n}> =\n  styled.div\n\nconst Cover = div`\n  background: url(${p => p.coverUrl || \"\"}) no-repeat center center;\n  background-size: cover;\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n`\n"]}]}