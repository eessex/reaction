{"remainingRequest":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js??ref--6-1!/Users/eve/development/reaction/src/Components/Publishing/Sections/Sections.tsx","dependencies":[{"path":"/Users/eve/development/reaction/src/Components/Publishing/Sections/Sections.tsx","mtime":1538070271000},{"path":"/Users/eve/development/reaction/.babelrc","mtime":1537112679000},{"path":"/Users/eve/development/reaction/node_modules/cache-loader/dist/cjs.js","mtime":0},{"path":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _once from \"lodash/once\";\nimport _findLastIndex from \"lodash/findLastIndex\";\nimport _compact from \"lodash/compact\";\nimport _clone from \"lodash/clone\";\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _templateObject4() {\n  var data = _taggedTemplateLiteral([\"\\n    max-width: \", \";\\n    \", \"\\n  \"]);\n\n  _templateObject4 = function _templateObject4() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject3() {\n  var data = _taggedTemplateLiteral([\"\\n    max-width: \", \";\\n  \"]);\n\n  _templateObject3 = function _templateObject3() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject2() {\n  var data = _taggedTemplateLiteral([\"\\n    max-width: \", \";\\n    \", \"\\n  \"]);\n\n  _templateObject2 = function _templateObject2() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: column;\\n  align-items: center;\\n  width: 100%;\\n  margin: \", \"\\n  max-width: \", \";\\n\\n  \", \"\\n\\n  \", \"\\n  \", \"\\n\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nfunction _taggedTemplateLiteral(strings, raw) { if (!raw) { raw = strings.slice(0); } return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { Component } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport styled from \"styled-components\";\nimport { pMedia } from \"../../Helpers\";\nimport { Authors } from \"./Authors\";\nimport { Embed } from \"./Embed\";\nimport { ImageCollection } from \"./ImageCollection\";\nimport { ImageSetPreview } from \"./ImageSetPreview\";\nimport { SectionContainer } from \"./SectionContainer\";\nimport { Text } from \"./Text\";\nimport { Video } from \"./Video\";\n\n/**\n * When isMobile, hide sidebar and inject DisplayAd into the body of the\n * article at a specific paragraph index.\n */\nvar MOBILE_DISPLAY_INJECT_INDEX = 1;\nvar MOBILE_DISPLAY_INJECT_ID_PREFIX = \"__mobile_display_inject__\";\nexport var Sections =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Sections, _Component);\n\n  function Sections() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Sections);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Sections)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"displayInjectId\", void 0);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"state\", {\n      shouldInjectMobileDisplay: false\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"getContentStartIndex\", function () {\n      var _this$props$article = _this.props.article,\n          layout = _this$props$article.layout,\n          sections = _this$props$article.sections;\n\n      if (layout === \"feature\") {\n        var firstText = sections.findIndex(function (section) {\n          return section.type === \"text\";\n        });\n        return firstText;\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"getContentEndIndex\", function () {\n      var _this$props$article2 = _this.props.article,\n          layout = _this$props$article2.layout,\n          sections = _this$props$article2.sections;\n\n      if ([\"feature\", \"standard\"].includes(layout)) {\n        var lastText = _findLastIndex(sections, function (section) {\n          return section.type === \"text\";\n        });\n\n        return lastText;\n      }\n    });\n\n    return _this;\n  }\n\n  _createClass(Sections, [{\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      var _this$props = this.props,\n          layout = _this$props.article.layout,\n          isMobile = _this$props.isMobile;\n      this.injectDisplayPanelMarker = _once(this.injectDisplayPanelMarker);\n      var shouldInjectMobileDisplay = isMobile && layout !== \"feature\";\n      this.setState({\n        shouldInjectMobileDisplay: shouldInjectMobileDisplay\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (this.state.shouldInjectMobileDisplay) {\n        this.mountDisplayToMarker();\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      var _this2 = this;\n\n      var isMobile = this.props.isMobile;\n\n      if (prevProps.isMobile !== isMobile) {\n        this.setState({\n          shouldInjectMobileDisplay: isMobile\n        }, function () {\n          if (isMobile && _this2.state.shouldInjectMobileDisplay) {\n            _this2.mountDisplayToMarker();\n          }\n        });\n      }\n    }\n    /**\n     * Inject DisplayAd after a specific paragraph index\n     */\n\n  }, {\n    key: \"injectDisplayPanelMarker\",\n    value: function injectDisplayPanelMarker(body) {\n      var _this3 = this;\n\n      var articleId = this.props.article.id;\n      var tag = \"</p>\";\n\n      var updatedBody = _compact(body.split(tag)).map(function (p) {\n        return p + tag;\n      }).reduce(function (arr, block, paragraphIndex) {\n        if (paragraphIndex === MOBILE_DISPLAY_INJECT_INDEX) {\n          _this3.displayInjectId = \"\".concat(MOBILE_DISPLAY_INJECT_ID_PREFIX).concat(articleId);\n          return arr.concat([block, \"<div id=\\\"\".concat(_this3.displayInjectId, \"\\\"></div>\")]);\n        } else {\n          return arr.concat([block]);\n        }\n      }, []).join(\"\");\n\n      return updatedBody;\n    }\n  }, {\n    key: \"mountDisplayToMarker\",\n    value: function mountDisplayToMarker() {\n      var DisplayPanel = this.props.DisplayPanel;\n      var displayMountPoint = document.getElementById(this.displayInjectId);\n\n      if (displayMountPoint) {\n        ReactDOM.render(React.createElement(DisplayPanel, null), displayMountPoint);\n      } else {\n        console.error(\"(reaction/Sections.tsx) Error mounting Display: DOM node \", \"not found\", displayMountPoint);\n      }\n    }\n  }, {\n    key: \"getSection\",\n    value: function getSection(section, index) {\n      var _this$props2 = this.props,\n          article = _this$props2.article,\n          showTooltips = _this$props2.showTooltips;\n      var sections = {\n        image_collection: React.createElement(ImageCollection, {\n          sectionLayout: section.layout,\n          articleLayout: article.layout,\n          images: section.images,\n          targetHeight: 500,\n          gutter: 10\n        }),\n        image_set: React.createElement(ImageSetPreview, {\n          section: section\n        }),\n        video: React.createElement(Video, {\n          section: section\n        }),\n        embed: React.createElement(Embed, {\n          section: section\n        }),\n        text: React.createElement(Text, {\n          html: section.body,\n          layout: article.layout,\n          isContentStart: index === this.getContentStartIndex(),\n          isContentEnd: index === this.getContentEndIndex(),\n          showTooltips: showTooltips\n        }),\n        default: false\n      };\n      var sectionComponent = sections[section.type] || sections.default;\n      return sectionComponent;\n    }\n  }, {\n    key: \"renderSections\",\n    value: function renderSections() {\n      var _this4 = this;\n\n      var article = this.props.article;\n      var shouldInjectMobileDisplay = this.state.shouldInjectMobileDisplay;\n      var displayMarkerInjected = false;\n      var renderedSections = article.sections.map(function (sectionItem, index) {\n        var shouldInject = shouldInjectMobileDisplay && sectionItem.type === \"text\" && !displayMarkerInjected;\n        var section = sectionItem;\n\n        if (shouldInject) {\n          try {\n            section = _clone(sectionItem);\n            section.body = _this4.injectDisplayPanelMarker(section.body);\n            displayMarkerInjected = true;\n          } catch (error) {\n            console.error(\"(reaction/Sections.jsx) Error injecting Display:\", error);\n          }\n        }\n\n        var child = _this4.getSection(section, index);\n\n        if (child) {\n          return React.createElement(SectionContainer, {\n            key: index,\n            articleLayout: article.layout,\n            section: section\n          }, child);\n        }\n      });\n      return renderedSections;\n    }\n  }, {\n    key: \"renderAuthors\",\n    value: function renderAuthors() {\n      var authors = this.props.article.authors;\n\n      if (authors) {\n        return React.createElement(SectionContainer, null, React.createElement(Authors, {\n          authors: authors\n        }));\n      }\n    }\n  }, {\n    key: \"renderPostScript\",\n    value: function renderPostScript() {\n      var article = this.props.article;\n      var layout = article.layout,\n          postscript = article.postscript;\n\n      if (postscript) {\n        return React.createElement(SectionContainer, null, React.createElement(Text, {\n          html: postscript,\n          layout: layout,\n          postscript: Boolean(postscript)\n        }));\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var article = this.props.article;\n      return React.createElement(StyledSections, {\n        layout: article.layout\n      }, this.renderSections(), this.renderAuthors(), this.renderPostScript());\n    }\n  }]);\n\n  return Sections;\n}(Component);\n\n_defineProperty(Sections, \"defaultProps\", {\n  isMobile: false\n});\n\nvar chooseMargin = function chooseMargin(layout) {\n  if (layout === \"standard\") {\n    return \"0;\";\n  } else if (layout === \"feature\") {\n    return \"80px auto 0 auto;\";\n  }\n};\n\nvar div = styled.div;\nvar StyledSections = div(_templateObject(), function (props) {\n  return chooseMargin(props.layout);\n}, function (props) {\n  return props.layout === \"standard\" ? \"780px\" : \"auto\";\n}, function (props) {\n  return pMedia.xl(_templateObject2(), props.layout === \"standard\" ? \"680px\" : \"auto\", props.layout === \"feature\" ? \"margin: 80px auto 0 auto\" : \"\");\n}, function (props) {\n  return pMedia.md(_templateObject3(), props.layout === \"standard\" ? \"780px\" : \"auto\");\n}, function (props) {\n  return pMedia.xs(_templateObject4(), props.layout === \"standard\" ? \"780px\" : \"auto\", props.layout === \"feature\" ? \"margin: 30px auto 0 auto\" : \"\");\n});",{"version":3,"sources":["/Users/eve/development/reaction/src/Components/Publishing/Sections/Sections.tsx"],"names":["React","Component","ReactDOM","styled","pMedia","Authors","Embed","ImageCollection","ImageSetPreview","SectionContainer","Text","Video","MOBILE_DISPLAY_INJECT_INDEX","MOBILE_DISPLAY_INJECT_ID_PREFIX","Sections","shouldInjectMobileDisplay","props","article","layout","sections","firstText","findIndex","section","type","includes","lastText","isMobile","injectDisplayPanelMarker","setState","state","mountDisplayToMarker","prevProps","body","articleId","id","tag","updatedBody","split","map","p","reduce","arr","block","paragraphIndex","displayInjectId","concat","join","DisplayPanel","displayMountPoint","document","getElementById","render","console","error","index","showTooltips","image_collection","images","image_set","video","embed","text","getContentStartIndex","getContentEndIndex","default","sectionComponent","displayMarkerInjected","renderedSections","sectionItem","shouldInject","child","getSection","authors","postscript","Boolean","renderSections","renderAuthors","renderPostScript","chooseMargin","div","StyledSections","xl","md","xs"],"mappings":"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","sourcesContent":["import { clone, compact, findLastIndex, once } from \"lodash\"\nimport React, { Component } from \"react\"\nimport ReactDOM from \"react-dom\"\nimport styled, { StyledFunction } from \"styled-components\"\nimport { pMedia } from \"../../Helpers\"\nimport { ArticleData } from \"../Typings\"\nimport { Authors } from \"./Authors\"\nimport { Embed } from \"./Embed\"\nimport { ImageCollection } from \"./ImageCollection\"\nimport { ImageSetPreview } from \"./ImageSetPreview\"\nimport { SectionContainer } from \"./SectionContainer\"\nimport { Text } from \"./Text\"\nimport { Video } from \"./Video\"\n\ninterface Props {\n  DisplayPanel?: any\n  article: ArticleData\n  isMobile?: boolean\n  showTooltips?: boolean\n}\n\ninterface State {\n  shouldInjectMobileDisplay: boolean\n}\n\n/**\n * When isMobile, hide sidebar and inject DisplayAd into the body of the\n * article at a specific paragraph index.\n */\nconst MOBILE_DISPLAY_INJECT_INDEX = 1\nconst MOBILE_DISPLAY_INJECT_ID_PREFIX = \"__mobile_display_inject__\"\n\nexport class Sections extends Component<Props, State> {\n  static defaultProps = {\n    isMobile: false,\n  }\n\n  displayInjectId: string\n\n  state = {\n    shouldInjectMobileDisplay: false,\n  }\n\n  componentWillMount() {\n    const {\n      article: { layout },\n      isMobile,\n    } = this.props\n\n    this.injectDisplayPanelMarker = once(this.injectDisplayPanelMarker)\n    const shouldInjectMobileDisplay = isMobile && layout !== \"feature\"\n\n    this.setState({\n      shouldInjectMobileDisplay,\n    })\n  }\n\n  componentDidMount() {\n    if (this.state.shouldInjectMobileDisplay) {\n      this.mountDisplayToMarker()\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    const { isMobile } = this.props\n\n    if (prevProps.isMobile !== isMobile) {\n      this.setState(\n        {\n          shouldInjectMobileDisplay: isMobile,\n        },\n        () => {\n          if (isMobile && this.state.shouldInjectMobileDisplay) {\n            this.mountDisplayToMarker()\n          }\n        }\n      )\n    }\n  }\n\n  /**\n   * Inject DisplayAd after a specific paragraph index\n   */\n  injectDisplayPanelMarker(body) {\n    const articleId = this.props.article.id\n    const tag = \"</p>\"\n    const updatedBody = compact(body.split(tag))\n      .map(p => p + tag)\n      .reduce((arr, block, paragraphIndex) => {\n        if (paragraphIndex === MOBILE_DISPLAY_INJECT_INDEX) {\n          this.displayInjectId = `${MOBILE_DISPLAY_INJECT_ID_PREFIX}${articleId}`\n          return arr.concat([block, `<div id=\"${this.displayInjectId}\"></div>`])\n        } else {\n          return arr.concat([block])\n        }\n      }, [])\n      .join(\"\")\n\n    return updatedBody\n  }\n\n  mountDisplayToMarker() {\n    const { DisplayPanel } = this.props\n    const displayMountPoint = document.getElementById(this.displayInjectId)\n\n    if (displayMountPoint) {\n      ReactDOM.render(<DisplayPanel />, displayMountPoint)\n    } else {\n      console.error(\n        \"(reaction/Sections.tsx) Error mounting Display: DOM node \",\n        \"not found\",\n        displayMountPoint\n      )\n    }\n  }\n\n  getContentStartIndex = () => {\n    const {\n      article: { layout, sections },\n    } = this.props\n\n    if (layout === \"feature\") {\n      const firstText = sections.findIndex(section => {\n        return section.type === \"text\"\n      })\n      return firstText\n    }\n  }\n\n  getContentEndIndex = () => {\n    const {\n      article: { layout, sections },\n    } = this.props\n\n    if ([\"feature\", \"standard\"].includes(layout)) {\n      const lastText = findLastIndex(sections, section => {\n        return section.type === \"text\"\n      })\n      return lastText\n    }\n  }\n\n  getSection(section, index) {\n    const { article, showTooltips } = this.props\n\n    const sections = {\n      image_collection: (\n        <ImageCollection\n          sectionLayout={section.layout}\n          articleLayout={article.layout}\n          images={section.images}\n          targetHeight={500}\n          gutter={10}\n        />\n      ),\n      image_set: <ImageSetPreview section={section} />,\n      video: <Video section={section} />,\n      embed: <Embed section={section} />,\n      text: (\n        <Text\n          html={section.body}\n          layout={article.layout}\n          isContentStart={index === this.getContentStartIndex()}\n          isContentEnd={index === this.getContentEndIndex()}\n          showTooltips={showTooltips}\n        />\n      ),\n      default: false,\n    }\n\n    const sectionComponent = sections[section.type] || sections.default\n    return sectionComponent\n  }\n\n  renderSections() {\n    const { article } = this.props\n    const { shouldInjectMobileDisplay } = this.state\n    let displayMarkerInjected = false\n\n    const renderedSections = article.sections.map((sectionItem, index) => {\n      const shouldInject =\n        shouldInjectMobileDisplay &&\n        sectionItem.type === \"text\" &&\n        !displayMarkerInjected\n\n      let section = sectionItem\n\n      if (shouldInject) {\n        try {\n          section = clone(sectionItem)\n          section.body = this.injectDisplayPanelMarker(section.body)\n          displayMarkerInjected = true\n        } catch (error) {\n          console.error(\n            \"(reaction/Sections.jsx) Error injecting Display:\",\n            error\n          )\n        }\n      }\n\n      const child = this.getSection(section, index)\n\n      if (child) {\n        return (\n          <SectionContainer\n            key={index}\n            articleLayout={article.layout}\n            section={section}\n          >\n            {child}\n          </SectionContainer>\n        )\n      }\n    })\n\n    return renderedSections\n  }\n\n  renderAuthors() {\n    const {\n      article: { authors },\n    } = this.props\n\n    if (authors) {\n      return (\n        <SectionContainer>\n          <Authors authors={authors} />\n        </SectionContainer>\n      )\n    }\n  }\n\n  renderPostScript() {\n    const { article } = this.props\n    const { layout, postscript } = article\n\n    if (postscript) {\n      return (\n        <SectionContainer>\n          <Text\n            html={postscript}\n            layout={layout}\n            postscript={Boolean(postscript)}\n          />\n        </SectionContainer>\n      )\n    }\n  }\n\n  render() {\n    const { article } = this.props\n\n    return (\n      <StyledSections layout={article.layout}>\n        {this.renderSections()}\n        {this.renderAuthors()}\n        {this.renderPostScript()}\n      </StyledSections>\n    )\n  }\n}\n\nconst chooseMargin = layout => {\n  if (layout === \"standard\") {\n    return \"0;\"\n  } else if (layout === \"feature\") {\n    return \"80px auto 0 auto;\"\n  }\n}\n\nconst div: StyledFunction<{ layout: string }> = styled.div\nconst StyledSections = div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  width: 100%;\n  margin: ${props => chooseMargin(props.layout)}\n  max-width: ${props => (props.layout === \"standard\" ? \"780px\" : \"auto\")};\n\n  ${props => pMedia.xl`\n    max-width: ${props.layout === \"standard\" ? \"680px\" : \"auto\"};\n    ${props.layout === \"feature\" ? \"margin: 80px auto 0 auto\" : \"\"}\n  `}\n\n  ${props => pMedia.md`\n    max-width: ${props.layout === \"standard\" ? \"780px\" : \"auto\"};\n  `}\n  ${props => pMedia.xs`\n    max-width: ${props.layout === \"standard\" ? \"780px\" : \"auto\"};\n    ${props.layout === \"feature\" ? \"margin: 30px auto 0 auto\" : \"\"}\n  `}\n`\n"]}]}