{"remainingRequest":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js??ref--6-1!/Users/eve/development/reaction/src/Apps/Order/Routes/Shipping/index.tsx","dependencies":[{"path":"/Users/eve/development/reaction/src/Apps/Order/Routes/Shipping/index.tsx","mtime":1538070271000},{"path":"/Users/eve/development/reaction/.babelrc","mtime":1537112679000},{"path":"/Users/eve/development/reaction/node_modules/cache-loader/dist/cjs.js","mtime":0},{"path":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _pick from \"lodash/pick\";\nimport _get from \"lodash/get\";\n\nvar _graphql;\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { BorderedRadio, Button, Flex, RadioGroup, Sans, Spacer } from \"@artsy/palette\";\nimport { AddressForm, emptyAddress } from \"../../Components/AddressForm\";\nimport { BuyNowStepper } from \"../../Components/BuyNowStepper\";\nimport { Helper } from \"../../Components/Helper\";\nimport { TransactionSummaryFragmentContainer as TransactionSummary } from \"../../Components/TransactionSummary\";\nimport { TwoColumnLayout } from \"../../Components/TwoColumnLayout\";\nimport { validatePresence } from \"../../Components/Validators\";\nimport { ErrorModal } from \"../../../../Components/Modal/ErrorModal\";\nimport React, { Component } from \"react\";\nimport { commitMutation, createFragmentContainer, graphql } from \"react-relay\";\nimport { Collapse } from \"../../../../Styleguide\";\nimport { Col, Row } from \"../../../../Styleguide/Elements/Grid\";\nimport { Responsive } from \"../../../../Utils/Responsive\";\nexport var ShippingRoute =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(ShippingRoute, _Component);\n\n  function ShippingRoute() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, ShippingRoute);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(ShippingRoute)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"state\", {\n      shippingOption: _this.props.order.requestedFulfillment && _this.props.order.requestedFulfillment.__typename.toUpperCase() || \"SHIP\",\n      isCommittingMutation: false,\n      isErrorModalOpen: false,\n      address: _this.startingAddress,\n      addressErrors: {},\n      errorModalTitle: null,\n      errorModalMessage: null\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"onContinueButtonPressed\", function () {\n      _this.setState({\n        isCommittingMutation: true\n      }, function () {\n        var _this$state = _this.state,\n            address = _this$state.address,\n            shippingOption = _this$state.shippingOption;\n\n        if (_this.state.shippingOption === \"SHIP\") {\n          var errors = _this.validateAddress(_this.state.address);\n\n          if (Object.keys(errors).filter(function (key) {\n            return errors[key];\n          }).length > 0) {\n            _this.setState({\n              isCommittingMutation: false,\n              addressErrors: errors\n            });\n\n            return;\n          }\n        }\n\n        if (_this.props.relay && _this.props.relay.environment) {\n          commitMutation(_this.props.relay.environment, {\n            mutation: _graphql || (_graphql = function _graphql() {\n              var node = require(\"../../../../__generated__/ShippingOrderAddressUpdateMutation.graphql\");\n\n              if (node.hash && node.hash !== \"b4d505f0863e59f98f6a2aeaf9022bfe\") {\n                console.error(\"The definition of 'ShippingOrderAddressUpdateMutation' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data.\");\n              }\n\n              return require(\"../../../../__generated__/ShippingOrderAddressUpdateMutation.graphql\");\n            }),\n            variables: {\n              input: {\n                orderId: _this.props.order.id,\n                fulfillmentType: shippingOption,\n                shipping: address\n              }\n            },\n            onCompleted: function onCompleted(data) {\n              _this.setState({\n                isCommittingMutation: false\n              });\n\n              var orderOrError = data.setOrderShipping.orderOrError;\n\n              if (orderOrError.error) {\n                var errorCode = orderOrError.error.code;\n\n                if (errorCode && (errorCode === \"missing_region\" || errorCode === \"missing_country\" || errorCode === \"missing_postal_code\")) {\n                  _this.onMutationError(orderOrError.error, \"Invalid address\", \"There was an error processing your address. Please review and try again.\");\n                } else {\n                  _this.onMutationError(orderOrError.error);\n                }\n              } else {\n                _this.props.router.push(\"/order2/\".concat(_this.props.order.id, \"/payment\"));\n              }\n            },\n            onError: _this.onMutationError.bind(_assertThisInitialized(_assertThisInitialized(_this)))\n          });\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"onCloseModal\", function () {\n      _this.setState({\n        isErrorModalOpen: false\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"onAddressChange\", function (address, key) {\n      _this.setState({\n        address: address,\n        addressErrors: _objectSpread({}, _this.state.addressErrors, _defineProperty({}, key, _this.validateAddress(address)[key]))\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(ShippingRoute, [{\n    key: \"onMutationError\",\n    value: function onMutationError(errors, errorModalTitle, errorModalMessage) {\n      this.setState({\n        isCommittingMutation: false,\n        isErrorModalOpen: true,\n        errorModalTitle: errorModalTitle,\n        errorModalMessage: errorModalMessage\n      });\n    }\n  }, {\n    key: \"validateAddress\",\n    value: function validateAddress(address) {\n      var name = address.name,\n          addressLine1 = address.addressLine1,\n          city = address.city,\n          region = address.region,\n          country = address.country,\n          postalCode = address.postalCode,\n          phoneNumber = address.phoneNumber;\n      return {\n        name: validatePresence(name),\n        addressLine1: validatePresence(addressLine1),\n        city: validatePresence(city),\n        region: validatePresence(region),\n        country: validatePresence(country),\n        postalCode: validatePresence(postalCode),\n        phoneNumber: validatePresence(phoneNumber)\n      };\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var order = this.props.order;\n      var _this$state2 = this.state,\n          address = _this$state2.address,\n          addressErrors = _this$state2.addressErrors,\n          isCommittingMutation = _this$state2.isCommittingMutation;\n\n      var isPickupAvailable = _get(this.props, \"order.lineItems.edges[0].node.artwork.pickup_available\");\n\n      return React.createElement(React.Fragment, null, React.createElement(Row, null, React.createElement(Col, null, React.createElement(BuyNowStepper, {\n        currentStep: \"shipping\"\n      }))), React.createElement(Spacer, {\n        mb: 3\n      }), React.createElement(Responsive, null, function (_ref) {\n        var xs = _ref.xs;\n        return React.createElement(TwoColumnLayout, {\n          Content: React.createElement(Flex, {\n            flexDirection: \"column\",\n            style: isCommittingMutation ? {\n              pointerEvents: \"none\"\n            } : {}\n          }, isPickupAvailable && React.createElement(React.Fragment, null, React.createElement(RadioGroup, {\n            onSelect: function onSelect(shippingOption) {\n              return _this2.setState({\n                shippingOption: shippingOption\n              });\n            },\n            defaultValue: _this2.state.shippingOption\n          }, React.createElement(BorderedRadio, {\n            value: \"SHIP\"\n          }, \"Add shipping address\"), React.createElement(BorderedRadio, {\n            value: \"PICKUP\"\n          }, \"Arrange for pickup (free)\", React.createElement(Collapse, {\n            open: _this2.state.shippingOption === \"PICKUP\"\n          }, React.createElement(Sans, {\n            size: \"2\",\n            color: \"black60\"\n          }, \"After your order is confirmed, a specialist will contact you within 2 business days to coordinate pickup.\")))), React.createElement(Spacer, {\n            mb: 3\n          })), React.createElement(Collapse, {\n            open: !isPickupAvailable || _this2.state.shippingOption === \"SHIP\"\n          }, React.createElement(AddressForm, {\n            defaultValue: address,\n            errors: addressErrors,\n            onChange: _this2.onAddressChange\n          })), !xs && React.createElement(Button, {\n            onClick: _this2.onContinueButtonPressed,\n            loading: isCommittingMutation,\n            size: \"large\",\n            width: \"100%\"\n          }, \"Continue\")),\n          Sidebar: React.createElement(Flex, {\n            flexDirection: \"column\"\n          }, React.createElement(TransactionSummary, {\n            order: order,\n            mb: xs ? 2 : 3\n          }), React.createElement(Helper, {\n            artworkId: order.lineItems.edges[0].node.artwork.id\n          }), xs && React.createElement(React.Fragment, null, React.createElement(Spacer, {\n            mb: 3\n          }), React.createElement(Button, {\n            onClick: _this2.onContinueButtonPressed,\n            loading: isCommittingMutation,\n            size: \"large\",\n            width: \"100%\"\n          }, \"Continue\")))\n        });\n      }), React.createElement(ErrorModal, {\n        onClose: this.onCloseModal,\n        show: this.state.isErrorModalOpen,\n        detailText: this.state.errorModalMessage,\n        headerText: this.state.errorModalTitle\n      }));\n    }\n  }, {\n    key: \"startingAddress\",\n    get: function get() {\n      return _objectSpread({}, emptyAddress, {\n        country: \"US\"\n      }, _pick(this.props.order.requestedFulfillment, Object.keys(emptyAddress)));\n    }\n  }]);\n\n  return ShippingRoute;\n}(Component);\nexport var ShippingFragmentContainer = createFragmentContainer(ShippingRoute, {\n  order: function order() {\n    var node = require(\"../../../../__generated__/Shipping_order.graphql\");\n\n    if (node.hash && node.hash !== \"2ea5766b77c168a536520eed217a7c3f\") {\n      console.error(\"The definition of 'Shipping_order' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data.\");\n    }\n\n    return require(\"../../../../__generated__/Shipping_order.graphql\");\n  }\n});",{"version":3,"sources":["/Users/eve/development/reaction/src/Apps/Order/Routes/Shipping/index.tsx"],"names":["BorderedRadio","Button","Flex","RadioGroup","Sans","Spacer","AddressForm","emptyAddress","BuyNowStepper","Helper","TransactionSummaryFragmentContainer","TransactionSummary","TwoColumnLayout","validatePresence","ErrorModal","React","Component","commitMutation","createFragmentContainer","graphql","Collapse","Col","Row","Responsive","ShippingRoute","shippingOption","props","order","requestedFulfillment","__typename","toUpperCase","isCommittingMutation","isErrorModalOpen","address","startingAddress","addressErrors","errorModalTitle","errorModalMessage","setState","state","errors","validateAddress","Object","keys","filter","key","length","relay","environment","mutation","variables","input","orderId","id","fulfillmentType","shipping","onCompleted","data","orderOrError","setOrderShipping","error","errorCode","code","onMutationError","router","push","onError","bind","name","addressLine1","city","region","country","postalCode","phoneNumber","isPickupAvailable","xs","pointerEvents","onAddressChange","onContinueButtonPressed","lineItems","edges","node","artwork","onCloseModal","ShippingFragmentContainer"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,SACEA,aADF,EAEEC,MAFF,EAGEC,IAHF,EAIEC,UAJF,EAKEC,IALF,EAMEC,MANF,QAOO,gBAPP;AAaA,SAIEC,WAJF,EAKEC,YALF;AAOA,SAASC,aAAT;AACA,SAASC,MAAT;AACA,SAASC,mCAAmC,IAAIC,kBAAhD;AACA,SAASC,eAAT;AACA,SAASC,gBAAT;AACA,SAASC,UAAT;AAGA,OAAOC,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SACEC,cADF,EAEEC,uBAFF,EAGEC,OAHF,QAKO,aALP;AAMA,SAASC,QAAT;AACA,SAASC,GAAT,EAAcC,GAAd;AACA,SAASC,UAAT;AAqBA,WAAaC,aAAb;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA,oFACU;AACNC,MAAAA,cAAc,EAAI,MAAKC,KAAL,CAAWC,KAAX,CAAiBC,oBAAjB,IAChB,MAAKF,KAAL,CAAWC,KAAX,CAAiBC,oBAAjB,CAAsCC,UAAtC,CAAiDC,WAAjD,EADe,IAEf,MAHI;AAINC,MAAAA,oBAAoB,EAAE,KAJhB;AAKNC,MAAAA,gBAAgB,EAAE,KALZ;AAMNC,MAAAA,OAAO,EAAE,MAAKC,eANR;AAONC,MAAAA,aAAa,EAAE,EAPT;AAQNC,MAAAA,eAAe,EAAE,IARX;AASNC,MAAAA,iBAAiB,EAAE;AATb,KADV;;AAAA,sGAwBwC,YAAM;AAC1C,YAAKC,QAAL,CAAc;AAAEP,QAAAA,oBAAoB,EAAE;AAAxB,OAAd,EAA8C,YAAM;AAAA,0BACd,MAAKQ,KADS;AAAA,YAC1CN,OAD0C,eAC1CA,OAD0C;AAAA,YACjCR,cADiC,eACjCA,cADiC;;AAGlD,YAAI,MAAKc,KAAL,CAAWd,cAAX,KAA8B,MAAlC,EAA0C;AACxC,cAAMe,MAAM,GAAG,MAAKC,eAAL,CAAqB,MAAKF,KAAL,CAAWN,OAAhC,CAAf;;AAEA,cAAIS,MAAM,CAACC,IAAP,CAAYH,MAAZ,EAAoBI,MAApB,CAA2B,UAAAC,GAAG;AAAA,mBAAIL,MAAM,CAACK,GAAD,CAAV;AAAA,WAA9B,EAA+CC,MAA/C,GAAwD,CAA5D,EAA+D;AAC7D,kBAAKR,QAAL,CAAc;AACZP,cAAAA,oBAAoB,EAAE,KADV;AAEZI,cAAAA,aAAa,EAAEK;AAFH,aAAd;;AAIA;AACD;AACF;;AAED,YAAI,MAAKd,KAAL,CAAWqB,KAAX,IAAoB,MAAKrB,KAAL,CAAWqB,KAAX,CAAiBC,WAAzC,EAAsD;AACpD/B,UAAAA,cAAc,CACZ,MAAKS,KAAL,CAAWqB,KAAX,CAAiBC,WADL,EAEZ;AACEC,YAAAA,QAAQ;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA,cADV;AAuBEC,YAAAA,SAAS,EAAE;AACTC,cAAAA,KAAK,EAAE;AACLC,gBAAAA,OAAO,EAAE,MAAK1B,KAAL,CAAWC,KAAX,CAAiB0B,EADrB;AAELC,gBAAAA,eAAe,EAAE7B,cAFZ;AAGL8B,gBAAAA,QAAQ,EAAEtB;AAHL;AADE,aAvBb;AA8BEuB,YAAAA,WAAW,EAAE,qBAAAC,IAAI,EAAI;AACnB,oBAAKnB,QAAL,CAAc;AAAEP,gBAAAA,oBAAoB,EAAE;AAAxB,eAAd;;AADmB,kBAGG2B,YAHH,GAIfD,IAJe,CAGjBE,gBAHiB,CAGGD,YAHH;;AAMnB,kBAAIA,YAAY,CAACE,KAAjB,EAAwB;AACtB,oBAAMC,SAAS,GAAGH,YAAY,CAACE,KAAb,CAAmBE,IAArC;;AACA,oBACED,SAAS,KACRA,SAAS,KAAK,gBAAd,IACCA,SAAS,KAAK,iBADf,IAECA,SAAS,KAAK,qBAHP,CADX,EAKE;AACA,wBAAKE,eAAL,CACEL,YAAY,CAACE,KADf,EAEE,iBAFF,EAGE,0EAHF;AAKD,iBAXD,MAWO;AACL,wBAAKG,eAAL,CAAqBL,YAAY,CAACE,KAAlC;AACD;AACF,eAhBD,MAgBO;AACL,sBAAKlC,KAAL,CAAWsC,MAAX,CAAkBC,IAAlB,mBAAkC,MAAKvC,KAAL,CAAWC,KAAX,CAAiB0B,EAAnD;AACD;AACF,aAvDH;AAwDEa,YAAAA,OAAO,EAAE,MAAKH,eAAL,CAAqBI,IAArB;AAxDX,WAFY,CAAd;AA6DD;AACF,OA9ED;AA+ED,KAxGH;;AAAA,2FAwIiB,YAAM;AACnB,YAAK7B,QAAL,CAAc;AAAEN,QAAAA,gBAAgB,EAAE;AAApB,OAAd;AACD,KA1IH;;AAAA,8FA4I0C,UAACC,OAAD,EAAUY,GAAV,EAAkB;AACxD,YAAKP,QAAL,CAAc;AACZL,QAAAA,OAAO,EAAPA,OADY;AAEZE,QAAAA,aAAa,oBACR,MAAKI,KAAL,CAAWJ,aADH,sBAEVU,GAFU,EAEJ,MAAKJ,eAAL,CAAqBR,OAArB,EAA8BY,GAA9B,CAFI;AAFD,OAAd;AAOD,KApJH;;AAAA;AAAA;;AAAA;AAAA;AAAA,oCA0GkBL,MA1GlB,EA0G0BJ,eA1G1B,EA0G4CC,iBA1G5C,EA0GgE;AAC5D,WAAKC,QAAL,CAAc;AACZP,QAAAA,oBAAoB,EAAE,KADV;AAEZC,QAAAA,gBAAgB,EAAE,IAFN;AAGZI,QAAAA,eAAe,EAAfA,eAHY;AAIZC,QAAAA,iBAAiB,EAAjBA;AAJY,OAAd;AAMD;AAjHH;AAAA;AAAA,oCAmH0BJ,OAnH1B,EAmH4C;AAAA,UAEtCmC,IAFsC,GASpCnC,OAToC,CAEtCmC,IAFsC;AAAA,UAGtCC,YAHsC,GASpCpC,OAToC,CAGtCoC,YAHsC;AAAA,UAItCC,IAJsC,GASpCrC,OAToC,CAItCqC,IAJsC;AAAA,UAKtCC,MALsC,GASpCtC,OAToC,CAKtCsC,MALsC;AAAA,UAMtCC,OANsC,GASpCvC,OAToC,CAMtCuC,OANsC;AAAA,UAOtCC,UAPsC,GASpCxC,OAToC,CAOtCwC,UAPsC;AAAA,UAQtCC,WARsC,GASpCzC,OAToC,CAQtCyC,WARsC;AAUxC,aAAO;AACLN,QAAAA,IAAI,EAAEvD,gBAAgB,CAACuD,IAAD,CADjB;AAELC,QAAAA,YAAY,EAAExD,gBAAgB,CAACwD,YAAD,CAFzB;AAGLC,QAAAA,IAAI,EAAEzD,gBAAgB,CAACyD,IAAD,CAHjB;AAILC,QAAAA,MAAM,EAAE1D,gBAAgB,CAAC0D,MAAD,CAJnB;AAKLC,QAAAA,OAAO,EAAE3D,gBAAgB,CAAC2D,OAAD,CALpB;AAMLC,QAAAA,UAAU,EAAE5D,gBAAgB,CAAC4D,UAAD,CANvB;AAOLC,QAAAA,WAAW,EAAE7D,gBAAgB,CAAC6D,WAAD;AAPxB,OAAP;AASD;AAtIH;AAAA;AAAA,6BAsJW;AAAA;;AAAA,UACC/C,KADD,GACW,KAAKD,KADhB,CACCC,KADD;AAAA,yBAEkD,KAAKY,KAFvD;AAAA,UAECN,OAFD,gBAECA,OAFD;AAAA,UAEUE,aAFV,gBAEUA,aAFV;AAAA,UAEyBJ,oBAFzB,gBAEyBA,oBAFzB;;AAGP,UAAM4C,iBAAiB,GAAG,KACxB,KAAKjD,KADmB,EAExB,wDAFwB,CAA1B;;AAKA,aACE,0CACE,oBAAC,GAAD,QACE,oBAAC,GAAD,QACE,oBAAC,aAAD;AAAe,QAAA,WAAW,EAAE;AAA5B,QADF,CADF,CADF,EAME,oBAAC,MAAD;AAAQ,QAAA,EAAE,EAAE;AAAZ,QANF,EAQE,oBAAC,UAAD,QACG;AAAA,YAAGkD,EAAH,QAAGA,EAAH;AAAA,eACC,oBAAC,eAAD;AACE,UAAA,OAAO,EACL,oBAAC,IAAD;AACE,YAAA,aAAa,EAAC,QADhB;AAEE,YAAA,KAAK,EAAE7C,oBAAoB,GAAG;AAAE8C,cAAAA,aAAa,EAAE;AAAjB,aAAH,GAA+B;AAF5D,aAOGF,iBAAiB,IAChB,0CACE,oBAAC,UAAD;AACE,YAAA,QAAQ,EAAE,kBAAClD,cAAD;AAAA,qBACR,MAAI,CAACa,QAAL,CAAc;AAAEb,gBAAAA,cAAc,EAAdA;AAAF,eAAd,CADQ;AAAA,aADZ;AAIE,YAAA,YAAY,EAAE,MAAI,CAACc,KAAL,CAAWd;AAJ3B,aAME,oBAAC,aAAD;AAAe,YAAA,KAAK,EAAC;AAArB,oCANF,EAUE,oBAAC,aAAD;AAAe,YAAA,KAAK,EAAC;AAArB,0CAEE,oBAAC,QAAD;AACE,YAAA,IAAI,EAAE,MAAI,CAACc,KAAL,CAAWd,cAAX,KAA8B;AADtC,aAGE,oBAAC,IAAD;AAAM,YAAA,IAAI,EAAC,GAAX;AAAe,YAAA,KAAK,EAAC;AAArB,yHAHF,CAFF,CAVF,CADF,EAwBE,oBAAC,MAAD;AAAQ,YAAA,EAAE,EAAE;AAAZ,YAxBF,CARJ,EAoCE,oBAAC,QAAD;AACE,YAAA,IAAI,EACF,CAACkD,iBAAD,IAAsB,MAAI,CAACpC,KAAL,CAAWd,cAAX,KAA8B;AAFxD,aAKE,oBAAC,WAAD;AACE,YAAA,YAAY,EAAEQ,OADhB;AAEE,YAAA,MAAM,EAAEE,aAFV;AAGE,YAAA,QAAQ,EAAE,MAAI,CAAC2C;AAHjB,YALF,CApCF,EAgDG,CAACF,EAAD,IACC,oBAAC,MAAD;AACE,YAAA,OAAO,EAAE,MAAI,CAACG,uBADhB;AAEE,YAAA,OAAO,EAAEhD,oBAFX;AAGE,YAAA,IAAI,EAAC,OAHP;AAIE,YAAA,KAAK,EAAC;AAJR,wBAjDJ,CAFJ;AA8DE,UAAA,OAAO,EACL,oBAAC,IAAD;AAAM,YAAA,aAAa,EAAC;AAApB,aACE,oBAAC,kBAAD;AAAoB,YAAA,KAAK,EAAEJ,KAA3B;AAAkC,YAAA,EAAE,EAAEiD,EAAE,GAAG,CAAH,GAAO;AAA/C,YADF,EAEE,oBAAC,MAAD;AACE,YAAA,SAAS,EAAEjD,KAAK,CAACqD,SAAN,CAAgBC,KAAhB,CAAsB,CAAtB,EAAyBC,IAAzB,CAA8BC,OAA9B,CAAsC9B;AADnD,YAFF,EAKGuB,EAAE,IACD,0CACE,oBAAC,MAAD;AAAQ,YAAA,EAAE,EAAE;AAAZ,YADF,EAEE,oBAAC,MAAD;AACE,YAAA,OAAO,EAAE,MAAI,CAACG,uBADhB;AAEE,YAAA,OAAO,EAAEhD,oBAFX;AAGE,YAAA,IAAI,EAAC,OAHP;AAIE,YAAA,KAAK,EAAC;AAJR,wBAFF,CANJ;AA/DJ,UADD;AAAA,OADH,CARF,EAiGE,oBAAC,UAAD;AACE,QAAA,OAAO,EAAE,KAAKqD,YADhB;AAEE,QAAA,IAAI,EAAE,KAAK7C,KAAL,CAAWP,gBAFnB;AAGE,QAAA,UAAU,EAAE,KAAKO,KAAL,CAAWF,iBAHzB;AAIE,QAAA,UAAU,EAAE,KAAKE,KAAL,CAAWH;AAJzB,QAjGF,CADF;AA0GD;AAxQH;AAAA;AAAA,wBAawB;AACpB,+BACK7B,YADL;AAEEiE,QAAAA,OAAO,EAAE;AAFX,SAMK,MAAK,KAAK9C,KAAL,CAAWC,KAAX,CAAiBC,oBAAtB,EAA4Cc,MAAM,CAACC,IAAP,CAAYpC,YAAZ,CAA5C,CANL;AAQD;AAtBH;;AAAA;AAAA,EAAmCS,SAAnC;AA2QA,OAAO,IAAMqE,yBAAyB,GAAGnE,uBAAuB,CAC9DM,aAD8D;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,EAAzD","sourcesContent":["import {\n  BorderedRadio,\n  Button,\n  Flex,\n  RadioGroup,\n  Sans,\n  Spacer,\n} from \"@artsy/palette\"\nimport { Shipping_order } from \"__generated__/Shipping_order.graphql\"\nimport {\n  OrderFulfillmentType,\n  ShippingOrderAddressUpdateMutation,\n} from \"__generated__/ShippingOrderAddressUpdateMutation.graphql\"\nimport {\n  Address,\n  AddressChangeHandler,\n  AddressErrors,\n  AddressForm,\n  emptyAddress,\n} from \"Apps/Order/Components/AddressForm\"\nimport { BuyNowStepper } from \"Apps/Order/Components/BuyNowStepper\"\nimport { Helper } from \"Apps/Order/Components/Helper\"\nimport { TransactionSummaryFragmentContainer as TransactionSummary } from \"Apps/Order/Components/TransactionSummary\"\nimport { TwoColumnLayout } from \"Apps/Order/Components/TwoColumnLayout\"\nimport { validatePresence } from \"Apps/Order/Components/Validators\"\nimport { ErrorModal } from \"Components/Modal/ErrorModal\"\nimport { Router } from \"found\"\nimport { get, pick } from \"lodash\"\nimport React, { Component } from \"react\"\nimport {\n  commitMutation,\n  createFragmentContainer,\n  graphql,\n  RelayProp,\n} from \"react-relay\"\nimport { Collapse } from \"Styleguide\"\nimport { Col, Row } from \"Styleguide/Elements/Grid\"\nimport { Responsive } from \"Utils/Responsive\"\n\nexport interface ShippingProps {\n  order: Shipping_order\n  mediator?: {\n    trigger: (action: string, config: object) => void\n  }\n  relay?: RelayProp\n  router: Router\n}\n\nexport interface ShippingState {\n  shippingOption: OrderFulfillmentType\n  address: Address\n  addressErrors: AddressErrors\n  isCommittingMutation: boolean\n  isErrorModalOpen: boolean\n  errorModalTitle: string\n  errorModalMessage: string\n}\n\nexport class ShippingRoute extends Component<ShippingProps, ShippingState> {\n  state = {\n    shippingOption: ((this.props.order.requestedFulfillment &&\n      this.props.order.requestedFulfillment.__typename.toUpperCase()) ||\n      \"SHIP\") as OrderFulfillmentType,\n    isCommittingMutation: false,\n    isErrorModalOpen: false,\n    address: this.startingAddress,\n    addressErrors: {},\n    errorModalTitle: null,\n    errorModalMessage: null,\n  }\n\n  get startingAddress() {\n    return {\n      ...emptyAddress,\n      country: \"US\",\n      // We need to pull out _only_ the values specified by the Address type,\n      // since our state will be used for Relay variables later on. The\n      // easiest way to do this is with the emptyAddress.\n      ...pick(this.props.order.requestedFulfillment, Object.keys(emptyAddress)),\n    }\n  }\n\n  onContinueButtonPressed: () => void = () => {\n    this.setState({ isCommittingMutation: true }, () => {\n      const { address, shippingOption } = this.state\n\n      if (this.state.shippingOption === \"SHIP\") {\n        const errors = this.validateAddress(this.state.address)\n\n        if (Object.keys(errors).filter(key => errors[key]).length > 0) {\n          this.setState({\n            isCommittingMutation: false,\n            addressErrors: errors,\n          })\n          return\n        }\n      }\n\n      if (this.props.relay && this.props.relay.environment) {\n        commitMutation<ShippingOrderAddressUpdateMutation>(\n          this.props.relay.environment,\n          {\n            mutation: graphql`\n              mutation ShippingOrderAddressUpdateMutation(\n                $input: SetOrderShippingInput!\n              ) {\n                setOrderShipping(input: $input) {\n                  orderOrError {\n                    ... on OrderWithMutationSuccess {\n                      order {\n                        state\n                      }\n                    }\n                    ... on OrderWithMutationFailure {\n                      error {\n                        type\n                        code\n                        data\n                      }\n                    }\n                  }\n                }\n              }\n            `,\n            variables: {\n              input: {\n                orderId: this.props.order.id,\n                fulfillmentType: shippingOption,\n                shipping: address,\n              },\n            },\n            onCompleted: data => {\n              this.setState({ isCommittingMutation: false })\n              const {\n                setOrderShipping: { orderOrError },\n              } = data\n\n              if (orderOrError.error) {\n                const errorCode = orderOrError.error.code\n                if (\n                  errorCode &&\n                  (errorCode === \"missing_region\" ||\n                    errorCode === \"missing_country\" ||\n                    errorCode === \"missing_postal_code\")\n                ) {\n                  this.onMutationError(\n                    orderOrError.error,\n                    \"Invalid address\",\n                    \"There was an error processing your address. Please review and try again.\"\n                  )\n                } else {\n                  this.onMutationError(orderOrError.error)\n                }\n              } else {\n                this.props.router.push(`/order2/${this.props.order.id}/payment`)\n              }\n            },\n            onError: this.onMutationError.bind(this),\n          }\n        )\n      }\n    })\n  }\n\n  onMutationError(errors, errorModalTitle?, errorModalMessage?) {\n    this.setState({\n      isCommittingMutation: false,\n      isErrorModalOpen: true,\n      errorModalTitle,\n      errorModalMessage,\n    })\n  }\n\n  private validateAddress(address: Address) {\n    const {\n      name,\n      addressLine1,\n      city,\n      region,\n      country,\n      postalCode,\n      phoneNumber,\n    } = address\n    return {\n      name: validatePresence(name),\n      addressLine1: validatePresence(addressLine1),\n      city: validatePresence(city),\n      region: validatePresence(region),\n      country: validatePresence(country),\n      postalCode: validatePresence(postalCode),\n      phoneNumber: validatePresence(phoneNumber),\n    }\n  }\n\n  onCloseModal = () => {\n    this.setState({ isErrorModalOpen: false })\n  }\n\n  onAddressChange: AddressChangeHandler = (address, key) => {\n    this.setState({\n      address,\n      addressErrors: {\n        ...this.state.addressErrors,\n        [key]: this.validateAddress(address)[key],\n      },\n    })\n  }\n\n  render() {\n    const { order } = this.props\n    const { address, addressErrors, isCommittingMutation } = this.state\n    const isPickupAvailable = get(\n      this.props,\n      \"order.lineItems.edges[0].node.artwork.pickup_available\"\n    )\n\n    return (\n      <>\n        <Row>\n          <Col>\n            <BuyNowStepper currentStep={\"shipping\"} />\n          </Col>\n        </Row>\n        <Spacer mb={3} />\n\n        <Responsive>\n          {({ xs }) => (\n            <TwoColumnLayout\n              Content={\n                <Flex\n                  flexDirection=\"column\"\n                  style={isCommittingMutation ? { pointerEvents: \"none\" } : {}}\n                >\n                  {/* TODO: Make RadioGroup generic for the allowed values,\n                  which could also ensure the children only use\n                  allowed values. */}\n                  {isPickupAvailable && (\n                    <>\n                      <RadioGroup\n                        onSelect={(shippingOption: OrderFulfillmentType) =>\n                          this.setState({ shippingOption })\n                        }\n                        defaultValue={this.state.shippingOption}\n                      >\n                        <BorderedRadio value=\"SHIP\">\n                          Add shipping address\n                        </BorderedRadio>\n\n                        <BorderedRadio value=\"PICKUP\">\n                          Arrange for pickup (free)\n                          <Collapse\n                            open={this.state.shippingOption === \"PICKUP\"}\n                          >\n                            <Sans size=\"2\" color=\"black60\">\n                              After your order is confirmed, a specialist will\n                              contact you within 2 business days to coordinate\n                              pickup.\n                            </Sans>\n                          </Collapse>\n                        </BorderedRadio>\n                      </RadioGroup>\n                      <Spacer mb={3} />\n                    </>\n                  )}\n\n                  <Collapse\n                    open={\n                      !isPickupAvailable || this.state.shippingOption === \"SHIP\"\n                    }\n                  >\n                    <AddressForm\n                      defaultValue={address}\n                      errors={addressErrors}\n                      onChange={this.onAddressChange}\n                    />\n                  </Collapse>\n\n                  {!xs && (\n                    <Button\n                      onClick={this.onContinueButtonPressed}\n                      loading={isCommittingMutation}\n                      size=\"large\"\n                      width=\"100%\"\n                    >\n                      Continue\n                    </Button>\n                  )}\n                </Flex>\n              }\n              Sidebar={\n                <Flex flexDirection=\"column\">\n                  <TransactionSummary order={order} mb={xs ? 2 : 3} />\n                  <Helper\n                    artworkId={order.lineItems.edges[0].node.artwork.id}\n                  />\n                  {xs && (\n                    <>\n                      <Spacer mb={3} />\n                      <Button\n                        onClick={this.onContinueButtonPressed}\n                        loading={isCommittingMutation}\n                        size=\"large\"\n                        width=\"100%\"\n                      >\n                        Continue\n                      </Button>\n                    </>\n                  )}\n                </Flex>\n              }\n            />\n          )}\n        </Responsive>\n\n        <ErrorModal\n          onClose={this.onCloseModal}\n          show={this.state.isErrorModalOpen}\n          detailText={this.state.errorModalMessage}\n          headerText={this.state.errorModalTitle}\n        />\n      </>\n    )\n  }\n}\n\nexport const ShippingFragmentContainer = createFragmentContainer(\n  ShippingRoute,\n  graphql`\n    fragment Shipping_order on Order {\n      id\n      requestedFulfillment {\n        __typename\n        ... on Ship {\n          name\n          addressLine1\n          addressLine2\n          city\n          region\n          country\n          postalCode\n          phoneNumber\n        }\n      }\n      lineItems {\n        edges {\n          node {\n            artwork {\n              id\n              pickup_available\n            }\n          }\n        }\n      }\n      ...TransactionSummary_order\n    }\n  `\n)\n"]}]}