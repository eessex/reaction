{"remainingRequest":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js??ref--5-1!/Users/eve/development/reaction/src/Components/Publishing/Display/Canvas/CanvasContainer.tsx","dependencies":[{"path":"/Users/eve/development/reaction/src/Components/Publishing/Display/Canvas/CanvasContainer.tsx","mtime":1527877289000},{"path":"/Users/eve/development/reaction/.babelrc","mtime":1527877289000},{"path":"/Users/eve/development/reaction/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js","mtime":1509489566000}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.CanvasContainer = exports.CanvasLink = exports.maxAssetSize = exports.unitLayout = exports.CanvasContainerComponent = void 0;\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _reactSizeme = _interopRequireDefault(require(\"react-sizeme\"));\n\nvar _styledComponents = _interopRequireDefault(require(\"styled-components\"));\n\nvar _resizer = require(\"../../../../Utils/resizer\");\n\nvar _track = require(\"../../../../Utils/track\");\n\nvar _Helpers = require(\"../../../Helpers\");\n\nvar _Constants = require(\"../../Constants\");\n\nvar _CanvasSlideshow = require(\"./CanvasSlideshow\");\n\nvar _CanvasText = require(\"./CanvasText\");\n\nvar _CanvasVideo = require(\"./CanvasVideo\");\n\nvar _ExternalTrackers = require(\"../ExternalTrackers\");\n\nvar _dec, _dec2, _class, _class2;\n\nvar _templateObject = /*#__PURE__*/ _taggedTemplateLiteral([\"\\n    width: 100%;\\n    max-width: 100%;\\n    height: auto;\\n    max-height: initial;\\n    object-fit: contain;\\n  \"], [\"\\n    width: 100%;\\n    max-width: 100%;\\n    height: auto;\\n    max-height: initial;\\n    object-fit: contain;\\n  \"]),\n    _templateObject2 = /*#__PURE__*/ _taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 460px;\\n  color: #000;\\n  text-decoration: none;\\n  align-items: center;\\n  position: relative;\\n  display: flex;\\n  flex-direction: row-reverse;\\n  justify-content: \", \"\\n  \", \"\\n  \", \"\\n\"], [\"\\n  width: 100%;\\n  height: 460px;\\n  color: #000;\\n  text-decoration: none;\\n  align-items: center;\\n  position: relative;\\n  display: flex;\\n  flex-direction: row-reverse;\\n  justify-content: \", \"\\n  \", \"\\n  \", \"\\n\"]),\n    _templateObject3 = /*#__PURE__*/ _taggedTemplateLiteral([\"\\n    \", \"\\n  \"], [\"\\n    \", \"\\n  \"]),\n    _templateObject4 = /*#__PURE__*/ _taggedTemplateLiteral([\"\\n    padding: 0;\\n    width: 100%;\\n    height: 400px;\\n    flex-direction: column;\\n    justify-content: flex-start;\\n  \"], [\"\\n    padding: 0;\\n    width: 100%;\\n    height: 400px;\\n    flex-direction: column;\\n    justify-content: flex-start;\\n  \"]),\n    _templateObject5 = /*#__PURE__*/ _taggedTemplateLiteral([\"\\n    max-width: 100%;\\n    width: 100%;\\n    height: auto;\\n  \"], [\"\\n    max-width: 100%;\\n    width: 100%;\\n    height: auto;\\n  \"]),\n    _templateObject6 = /*#__PURE__*/ _taggedTemplateLiteral([\"\\n  background: black;\\n  position: absolute;\\n  left: 0;\\n  right: 0;\\n  top: 0;\\n  bottom: 0;\\n  z-index: -1;\\n  &:before {\\n    content: '';\\n    background-image: url(\", \");\\n    position: absolute;\\n    left: 0;\\n    right: 0;\\n    top: 0;\\n    bottom: 0;\\n    background-size: cover;\\n    background-position: 50%;\\n    z-index: 1;\\n    opacity: .7;\\n  }\\n\"], [\"\\n  background: black;\\n  position: absolute;\\n  left: 0;\\n  right: 0;\\n  top: 0;\\n  bottom: 0;\\n  z-index: -1;\\n  &:before {\\n    content: '';\\n    background-image: url(\", \");\\n    position: absolute;\\n    left: 0;\\n    right: 0;\\n    top: 0;\\n    bottom: 0;\\n    background-size: cover;\\n    background-position: 50%;\\n    z-index: 1;\\n    opacity: .7;\\n  }\\n\"]);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _taggedTemplateLiteral(strings, raw) { return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) { var desc = {}; Object['ke' + 'ys'](descriptor).forEach(function (key) { desc[key] = descriptor[key]; }); desc.enumerable = !!desc.enumerable; desc.configurable = !!desc.configurable; if ('value' in desc || desc.initializer) { desc.writable = true; } desc = decorators.slice().reverse().reduce(function (desc, decorator) { return decorator(target, property, desc) || desc; }, desc); if (context && desc.initializer !== void 0) { desc.value = desc.initializer ? desc.initializer.call(context) : void 0; desc.initializer = undefined; } if (desc.initializer === void 0) { Object['define' + 'Property'](target, property, desc); desc = null; } return desc; }\n\nfunction _sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _slicedToArray(arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return _sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }\n\nvar CanvasContainerComponent = (_dec = (0, _track.track)(), _dec2 = (0, _track.track)(function (props, _ref) {\n  var _ref2 = _slicedToArray(_ref, 1),\n      e = _ref2[0];\n\n  return !isVideoClickArea(e) && {\n    action: \"Click\",\n    label: \"Display ad clickthrough\",\n    entity_type: \"display_ad\",\n    campaign_name: props.campaign.name,\n    unit_layout: unitLayout(props)\n  };\n}), _dec(_class = (_class2 =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(CanvasContainerComponent, _React$Component);\n\n  function CanvasContainerComponent(props) {\n    var _this;\n\n    _classCallCheck(this, CanvasContainerComponent);\n\n    _this = _possibleConstructorReturn(this, (CanvasContainerComponent.__proto__ || Object.getPrototypeOf(CanvasContainerComponent)).call(this, props));\n    Object.defineProperty(_assertThisInitialized(_this), \"canvasVideoHandlers\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(_assertThisInitialized(_this), \"state\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: {\n        isMounted: false\n      }\n    });\n    _this.openLink = _this.openLink.bind(_assertThisInitialized(_this));\n    return _this;\n  }\n\n  _createClass(CanvasContainerComponent, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.setState({\n        isMounted: true\n      });\n    } // TODO: Ensure that full element can be clicked on video complete\n    // Prevent links from blocking video playback.\n\n  }, {\n    key: \"openLink\",\n    value: function openLink(e) {\n      e.preventDefault();\n\n      if (!isVideoClickArea(e)) {\n        if (this.canvasVideoHandlers) {\n          this.canvasVideoHandlers.pauseVideo();\n        }\n\n        var url = (0, _ExternalTrackers.replaceWithCacheBuster)(e.currentTarget.attributes.href.value, (0, _Constants.getCurrentUnixTimestamp)());\n        window.open(url, \"_blank\");\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _props = this.props,\n          campaign = _props.campaign,\n          disclaimer = _props.disclaimer,\n          size = _props.size,\n          unit = _props.unit;\n      var assets = unit.assets,\n          cover_image_url = unit.cover_image_url,\n          layout = unit.layout,\n          url = unit.link.url;\n      var isOverlay = layout === \"overlay\";\n      var isSlideshow = layout === \"slideshow\"; // Props for Link units\n\n      var linkProps = {\n        onClick: this.openLink,\n        href: url,\n        target: \"_blank\",\n        containerWidth: size.width,\n        layout: layout // TODO: For whatever the slideshow leads to a race condition when rendering\n        // app in Force. Defer execution and everything works fine.\n\n      };\n\n      if (!this.state.isMounted) {\n        return _react.default.createElement(\"div\", null);\n      } // Overlay\n\n\n      if (isOverlay) {\n        var _backgroundUrl = assets[0].url;\n        return _react.default.createElement(CanvasLink, linkProps, _react.default.createElement(Background, {\n          backgroundUrl: _backgroundUrl\n        }), _react.default.createElement(_CanvasText.CanvasText, {\n          unit: unit\n        })); // Slideshow\n      } else if (isSlideshow) {\n        var slideshowProps = {\n          unit: unit,\n          campaign: campaign,\n          disclaimer: disclaimer,\n          containerWidth: size.width\n        };\n        return _react.default.createElement(_CanvasSlideshow.CanvasSlideshow, slideshowProps, _react.default.createElement(CanvasLink, linkProps, _react.default.createElement(_CanvasText.CanvasText, {\n          unit: unit,\n          disclaimer: disclaimer\n        }))); // Canvas -- Video / Image\n      } else {\n        var _unit$assets = _slicedToArray(unit.assets, 1),\n            asset = _unit$assets[0];\n\n        var isVideo = asset && asset.url.includes(\"mp4\");\n        return _react.default.createElement(CanvasLink, linkProps, isVideo ? _react.default.createElement(_CanvasVideo.CanvasVideo, {\n          coverUrl: cover_image_url,\n          src: asset.url,\n          campaign: campaign,\n          onInit: function onInit(h) {\n            return _this2.canvasVideoHandlers = h;\n          }\n        }) : _react.default.createElement(Image, {\n          src: (0, _resizer.crop)(asset.url, {\n            width: 1200,\n            height: 760,\n            isDisplayAd: true\n          })\n        }), _react.default.createElement(StandardContainer, null, _react.default.createElement(_CanvasText.CanvasText, {\n          unit: unit,\n          disclaimer: disclaimer\n        })));\n      }\n    }\n  }]);\n\n  return CanvasContainerComponent;\n}(_react.default.Component), (_applyDecoratedDescriptor(_class2.prototype, \"openLink\", [_dec2], Object.getOwnPropertyDescriptor(_class2.prototype, \"openLink\"), _class2.prototype)), _class2)) || _class);\nexports.CanvasContainerComponent = CanvasContainerComponent;\nObject.defineProperty(CanvasContainerComponent, \"defaultProps\", {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  value: {\n    size: {\n      width: 1250\n    }\n  }\n});\nvar Div = _styledComponents.default.div;\nvar responsiveLink = _styledComponents.default.a;\n\nvar unitLayout = function unitLayout(props) {\n  switch (props.unit.layout) {\n    case \"overlay\":\n      return \"canvas_overlay\";\n\n    case \"slideshow\":\n      return \"canvas_slideshow\";\n\n    default:\n      return \"canvas_standard\";\n  }\n};\n\nexports.unitLayout = unitLayout;\n\nvar isVideoClickArea = function isVideoClickArea(e) {\n  var videoClasses = [\"PlayButton\", \"PlayButton__PlayButtonCaret\", \"CanvasVideo__video\"];\n  return videoClasses.some(function (c) {\n    return e.target.className.includes(c);\n  });\n};\n\nvar maxAssetSize = function maxAssetSize(containerWidth) {\n  var width = containerWidth * 0.65;\n  var height = width * 0.59;\n  return {\n    width: width,\n    height: height\n  };\n};\n\nexports.maxAssetSize = maxAssetSize;\n\nvar Image =\n/*#__PURE__*/\n_styledComponents.default.img.withConfig({\n  displayName: \"CanvasContainer__Image\",\n  componentId: \"qubp26-0\"\n})([\"display:block;width:65%;height:100%;object-fit:cover;\", \";\"], _Helpers.pMedia.sm(_templateObject));\n\nvar CanvasLink = responsiveLink(_templateObject2, function (props) {\n  return props.layout === \"standard\" ? \"space-between;\" : \"center;\";\n}, function (props) {\n  return _Helpers.pMedia.lg(_templateObject3, props.layout !== \"overlay\" && \"max-height: \" + maxAssetSize(props.containerWidth).height + \"px;\");\n}, _Helpers.pMedia.sm(_templateObject4));\nexports.CanvasLink = CanvasLink;\n\nvar StandardContainer =\n/*#__PURE__*/\n_styledComponents.default.div.withConfig({\n  displayName: \"CanvasContainer__StandardContainer\",\n  componentId: \"qubp26-1\"\n})([\"max-width:calc(35% - 20px);height:100%;margin-right:auto;\", \";\"], _Helpers.pMedia.sm(_templateObject5));\n\nvar Background = Div(_templateObject6, function (props) {\n  return props.backgroundUrl && props.backgroundUrl;\n});\nvar sizeMeOptions = {\n  refreshRate: _Constants.SIZE_ME_REFRESH_RATE,\n  noPlaceholder: true\n};\nvar CanvasContainer = (0, _reactSizeme.default)(sizeMeOptions)(CanvasContainerComponent);\nexports.CanvasContainer = CanvasContainer;",{"version":3,"sources":["src/Components/Publishing/Display/Canvas/CanvasContainer.tsx"],"names":["CanvasContainerComponent","props","e","isVideoClickArea","action","label","entity_type","campaign_name","campaign","name","unit_layout","unitLayout","isMounted","openLink","bind","setState","preventDefault","canvasVideoHandlers","pauseVideo","url","currentTarget","attributes","href","value","window","open","disclaimer","size","unit","assets","cover_image_url","layout","link","isOverlay","isSlideshow","linkProps","onClick","target","containerWidth","width","state","backgroundUrl","slideshowProps","asset","isVideo","includes","h","height","isDisplayAd","Component","Div","div","responsiveLink","a","videoClasses","some","className","c","maxAssetSize","Image","img","sm","CanvasLink","lg","StandardContainer","Background","sizeMeOptions","refreshRate","noPlaceholder","CanvasContainer"],"mappings":"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","file":"/Users/eve/development/reaction/src/Components/Publishing/Display/Canvas/CanvasContainer.tsx","sourceRoot":"/Users/eve/development/reaction","sourcesContent":["import React from \"react\"\nimport sizeMe from \"react-sizeme\"\nimport styled, { StyledFunction } from \"styled-components\"\nimport { crop } from \"../../../../Utils/resizer\"\nimport { track } from \"../../../../Utils/track\"\nimport { pMedia } from \"../../../Helpers\"\nimport { SIZE_ME_REFRESH_RATE } from \"../../Constants\"\nimport { CanvasSlideshow } from \"./CanvasSlideshow\"\nimport { CanvasText } from \"./CanvasText\"\nimport { CanvasVideo } from \"./CanvasVideo\"\nimport { replaceWithCacheBuster } from \"../ExternalTrackers\"\nimport { getCurrentUnixTimestamp } from \"../../Constants\"\n\ninterface CanvasContainerProps {\n  campaign: any\n  article?: any\n  disclaimer?: any\n  size?: {\n    width: number\n  }\n  unit?: any\n}\n\ninterface State {\n  isMounted: boolean\n}\n\n@track()\nexport class CanvasContainerComponent extends React.Component<\n  CanvasContainerProps,\n  State\n> {\n  static defaultProps = {\n    size: { width: 1250 },\n  }\n\n  public canvasVideoHandlers: any\n\n  state = {\n    isMounted: false,\n  }\n\n  constructor(props) {\n    super(props)\n    this.openLink = this.openLink.bind(this)\n  }\n\n  componentDidMount() {\n    this.setState({\n      isMounted: true,\n    })\n  }\n\n  // TODO: Ensure that full element can be clicked on video complete\n  // Prevent links from blocking video playback.\n  @track(\n    (props, [e]) =>\n      !isVideoClickArea(e) && {\n        action: \"Click\",\n        label: \"Display ad clickthrough\",\n        entity_type: \"display_ad\",\n        campaign_name: props.campaign.name,\n        unit_layout: unitLayout(props),\n      }\n  )\n  openLink(e) {\n    e.preventDefault()\n\n    if (!isVideoClickArea(e)) {\n      if (this.canvasVideoHandlers) {\n        this.canvasVideoHandlers.pauseVideo()\n      }\n\n      const url = replaceWithCacheBuster(\n        e.currentTarget.attributes.href.value,\n        getCurrentUnixTimestamp()\n      )\n      window.open(url, \"_blank\")\n    }\n  }\n\n  render() {\n    const { campaign, disclaimer, size, unit } = this.props\n    const {\n      assets,\n      cover_image_url,\n      layout,\n      link: { url },\n    } = unit\n    const isOverlay = layout === \"overlay\"\n    const isSlideshow = layout === \"slideshow\"\n\n    // Props for Link units\n    const linkProps = {\n      onClick: this.openLink,\n      href: url,\n      target: \"_blank\",\n      containerWidth: size.width,\n      layout,\n    }\n\n    // TODO: For whatever the slideshow leads to a race condition when rendering\n    // app in Force. Defer execution and everything works fine.\n    if (!this.state.isMounted) {\n      return <div />\n    }\n\n    // Overlay\n    if (isOverlay) {\n      const backgroundUrl = assets[0].url\n\n      return (\n        <CanvasLink {...linkProps}>\n          <Background backgroundUrl={backgroundUrl} />\n          <CanvasText unit={unit} />\n        </CanvasLink>\n      )\n\n      // Slideshow\n    } else if (isSlideshow) {\n      const slideshowProps = {\n        unit,\n        campaign,\n        disclaimer,\n        containerWidth: size.width,\n      }\n\n      return (\n        <CanvasSlideshow {...slideshowProps}>\n          <CanvasLink {...linkProps}>\n            <CanvasText unit={unit} disclaimer={disclaimer} />\n          </CanvasLink>\n        </CanvasSlideshow>\n      )\n\n      // Canvas -- Video / Image\n    } else {\n      const [asset] = unit.assets\n      const isVideo = asset && asset.url.includes(\"mp4\")\n\n      return (\n        <CanvasLink {...linkProps}>\n          {isVideo ? (\n            <CanvasVideo\n              coverUrl={cover_image_url}\n              src={asset.url}\n              campaign={campaign}\n              onInit={h => (this.canvasVideoHandlers = h)}\n            />\n          ) : (\n            <Image\n              src={crop(asset.url, {\n                width: 1200,\n                height: 760,\n                isDisplayAd: true,\n              })}\n            />\n          )}\n\n          <StandardContainer>\n            <CanvasText unit={unit} disclaimer={disclaimer} />\n          </StandardContainer>\n        </CanvasLink>\n      )\n    }\n  }\n}\n\ninterface DivProps extends React.HTMLProps<HTMLDivElement> {\n  backgroundUrl?: string\n}\n\ninterface ResponsiveProps extends React.HTMLProps<HTMLLinkElement> {\n  containerWidth: any\n  href: any\n  layout: string\n  target: string\n}\n\nconst Div: StyledFunction<DivProps> = styled.div\nconst responsiveLink: StyledFunction<ResponsiveProps> = styled.a\n\nexport const unitLayout = props => {\n  switch (props.unit.layout) {\n    case \"overlay\":\n      return \"canvas_overlay\"\n    case \"slideshow\":\n      return \"canvas_slideshow\"\n    default:\n      return \"canvas_standard\"\n  }\n}\n\nconst isVideoClickArea = e => {\n  const videoClasses = [\n    \"PlayButton\",\n    \"PlayButton__PlayButtonCaret\",\n    \"CanvasVideo__video\",\n  ]\n  return videoClasses.some(c => e.target.className.includes(c))\n}\n\nexport const maxAssetSize = containerWidth => {\n  const width = containerWidth * 0.65\n  const height = width * 0.59\n  return { width, height }\n}\n\nconst Image = styled.img`\n  display: block;\n  width: 65%;\n  height: 100%;\n  object-fit: cover;\n  ${pMedia.sm`\n    width: 100%;\n    max-width: 100%;\n    height: auto;\n    max-height: initial;\n    object-fit: contain;\n  `};\n`\nexport const CanvasLink = responsiveLink`\n  width: 100%;\n  height: 460px;\n  color: #000;\n  text-decoration: none;\n  align-items: center;\n  position: relative;\n  display: flex;\n  flex-direction: row-reverse;\n  justify-content: ${props =>\n    props.layout === \"standard\" ? \"space-between;\" : \"center;\"}\n  ${props => pMedia.lg`\n    ${props.layout !== \"overlay\" &&\n      \"max-height: \" + maxAssetSize(props.containerWidth).height + \"px;\"}\n  `}\n  ${pMedia.sm`\n    padding: 0;\n    width: 100%;\n    height: 400px;\n    flex-direction: column;\n    justify-content: flex-start;\n  `}\n`\nconst StandardContainer = styled.div`\n  max-width: calc(35% - 20px);\n  height: 100%;\n  margin-right: auto;\n  ${pMedia.sm`\n    max-width: 100%;\n    width: 100%;\n    height: auto;\n  `};\n`\nconst Background = Div`\n  background: black;\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  z-index: -1;\n  &:before {\n    content: '';\n    background-image: url(${props =>\n      props.backgroundUrl && props.backgroundUrl});\n    position: absolute;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n    background-size: cover;\n    background-position: 50%;\n    z-index: 1;\n    opacity: .7;\n  }\n`\n\nconst sizeMeOptions = {\n  refreshRate: SIZE_ME_REFRESH_RATE,\n  noPlaceholder: true,\n}\n\nexport const CanvasContainer = sizeMe(sizeMeOptions)(CanvasContainerComponent)\n"]}]}