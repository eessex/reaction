{"remainingRequest":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js??ref--5-1!/Users/eve/development/reaction/src/Components/Publishing/Sections/Sections.tsx","dependencies":[{"path":"/Users/eve/development/reaction/src/Components/Publishing/Sections/Sections.tsx","mtime":1527879689000},{"path":"/Users/eve/development/reaction/.babelrc","mtime":1527877289000},{"path":"/Users/eve/development/reaction/node_modules/cache-loader/dist/cjs.js","mtime":1510929699000},{"path":"/Users/eve/development/reaction/node_modules/babel-loader/lib/index.js","mtime":1509489566000}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Sections = void 0;\n\nvar _lodash = require(\"lodash\");\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactDom = _interopRequireDefault(require(\"react-dom\"));\n\nvar _styledComponents = _interopRequireDefault(require(\"styled-components\"));\n\nvar _Helpers = require(\"../../Helpers\");\n\nvar _Authors = require(\"./Authors\");\n\nvar _Embed = require(\"./Embed\");\n\nvar _ImageCollection = require(\"./ImageCollection\");\n\nvar _ImageSetPreview = require(\"./ImageSetPreview\");\n\nvar _SectionContainer = require(\"./SectionContainer\");\n\nvar _Text = require(\"./Text\");\n\nvar _Video = require(\"./Video\");\n\nvar _templateObject = /*#__PURE__*/ _taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: column;\\n  align-items: center;\\n  width: 100%;\\n  margin: \", \"\\n  max-width: \", \";\\n\\n  \", \"\\n\\n  \", \"\\n  \", \"\\n\"], [\"\\n  display: flex;\\n  flex-direction: column;\\n  align-items: center;\\n  width: 100%;\\n  margin: \", \"\\n  max-width: \", \";\\n\\n  \", \"\\n\\n  \", \"\\n  \", \"\\n\"]),\n    _templateObject2 = /*#__PURE__*/ _taggedTemplateLiteral([\"\\n    max-width: \", \";\\n    \", \"\\n  \"], [\"\\n    max-width: \", \";\\n    \", \"\\n  \"]),\n    _templateObject3 = /*#__PURE__*/ _taggedTemplateLiteral([\"\\n    max-width: \", \";\\n  \"], [\"\\n    max-width: \", \";\\n  \"]);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {}; if (desc.get || desc.set) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } } newObj.default = obj; return newObj; } }\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _taggedTemplateLiteral(strings, raw) { return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\n/**\n * When isMobile, hide sidebar and inject DisplayAd into the body of the\n * article at a specific paragraph index.\n */\nvar MOBILE_DISPLAY_INJECT_INDEX = 1;\nvar MOBILE_DISPLAY_INJECT_ID_PREFIX = \"__mobile_display_inject__\";\n\nvar Sections =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Sections, _Component);\n\n  function Sections() {\n    var _ref;\n\n    var _temp, _this;\n\n    _classCallCheck(this, Sections);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _possibleConstructorReturn(_this, (_temp = _this = _possibleConstructorReturn(this, (_ref = Sections.__proto__ || Object.getPrototypeOf(Sections)).call.apply(_ref, [this].concat(args))), Object.defineProperty(_assertThisInitialized(_this), \"displayInjectId\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: void 0\n    }), Object.defineProperty(_assertThisInitialized(_this), \"state\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: {\n        shouldInjectMobileDisplay: false\n      }\n    }), Object.defineProperty(_assertThisInitialized(_this), \"getContentStartIndex\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value() {\n        var _this$props$article = _this.props.article,\n            layout = _this$props$article.layout,\n            sections = _this$props$article.sections;\n\n        if (layout === \"feature\") {\n          var firstText = sections.findIndex(function (section) {\n            return section.type === \"text\";\n          });\n          return firstText;\n        }\n      }\n    }), Object.defineProperty(_assertThisInitialized(_this), \"getContentEndIndex\", {\n      configurable: true,\n      enumerable: true,\n      writable: true,\n      value: function value() {\n        var _this$props$article2 = _this.props.article,\n            layout = _this$props$article2.layout,\n            sections = _this$props$article2.sections;\n\n        if ([\"feature\", \"standard\"].includes(layout)) {\n          var lastText = (0, _lodash.findLastIndex)(sections, function (section) {\n            return section.type === \"text\";\n          });\n          return lastText;\n        }\n      }\n    }), _temp));\n  }\n\n  _createClass(Sections, [{\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      var _props = this.props,\n          layout = _props.article.layout,\n          isMobile = _props.isMobile;\n      this.injectDisplayPanelMarker = (0, _lodash.once)(this.injectDisplayPanelMarker);\n      var shouldInjectMobileDisplay = isMobile && layout !== \"feature\";\n      this.setState({\n        shouldInjectMobileDisplay: shouldInjectMobileDisplay\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (this.state.shouldInjectMobileDisplay) {\n        this.mountDisplayToMarker();\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      var _this2 = this;\n\n      var isMobile = this.props.isMobile;\n\n      if (prevProps.isMobile !== isMobile) {\n        this.setState({\n          shouldInjectMobileDisplay: isMobile\n        }, function () {\n          if (isMobile && _this2.state.shouldInjectMobileDisplay) {\n            _this2.mountDisplayToMarker();\n          }\n        });\n      }\n    }\n    /**\n     * Inject DisplayAd after a specific paragraph index\n     */\n\n  }, {\n    key: \"injectDisplayPanelMarker\",\n    value: function injectDisplayPanelMarker(body) {\n      var _this3 = this;\n\n      var articleId = this.props.article.id;\n      var tag = \"</p>\";\n      var updatedBody = (0, _lodash.compact)(body.split(tag)).map(function (p) {\n        return p + tag;\n      }).reduce(function (arr, block, paragraphIndex) {\n        if (paragraphIndex === MOBILE_DISPLAY_INJECT_INDEX) {\n          _this3.displayInjectId = \"\".concat(MOBILE_DISPLAY_INJECT_ID_PREFIX).concat(articleId);\n          return arr.concat([block, \"<div id=\\\"\".concat(_this3.displayInjectId, \"\\\"></div>\")]);\n        } else {\n          return arr.concat([block]);\n        }\n      }, []).join(\"\");\n      return updatedBody;\n    }\n  }, {\n    key: \"mountDisplayToMarker\",\n    value: function mountDisplayToMarker() {\n      var DisplayPanel = this.props.DisplayPanel;\n      var displayMountPoint = document.getElementById(this.displayInjectId);\n\n      if (displayMountPoint) {\n        _reactDom.default.render(_react.default.createElement(DisplayPanel, null), displayMountPoint);\n      } else {\n        console.error(\"(reaction/Sections.tsx) Error mounting Display: DOM node \", \"not found\", displayMountPoint);\n      }\n    }\n  }, {\n    key: \"getSection\",\n    value: function getSection(section, index) {\n      var _props2 = this.props,\n          article = _props2.article,\n          showToolTips = _props2.showToolTips,\n          showToolTipMarketData = _props2.showToolTipMarketData;\n      var sections = {\n        image_collection: _react.default.createElement(_ImageCollection.ImageCollection, {\n          sectionLayout: section.layout,\n          articleLayout: article.layout,\n          images: section.images,\n          targetHeight: 500,\n          gutter: 10\n        }),\n        image_set: _react.default.createElement(_ImageSetPreview.ImageSetPreview, {\n          section: section\n        }),\n        video: _react.default.createElement(_Video.Video, {\n          section: section\n        }),\n        embed: _react.default.createElement(_Embed.Embed, {\n          section: section\n        }),\n        text: _react.default.createElement(_Text.Text, {\n          html: section.body,\n          layout: article.layout,\n          isContentStart: index === this.getContentStartIndex(),\n          isContentEnd: index === this.getContentEndIndex(),\n          showToolTips: showToolTips,\n          showToolTipMarketData: showToolTipMarketData\n        }),\n        default: false\n      };\n      var sectionComponent = sections[section.type] || sections.default;\n      return sectionComponent;\n    }\n  }, {\n    key: \"renderSections\",\n    value: function renderSections() {\n      var _this4 = this;\n\n      var article = this.props.article;\n      var shouldInjectMobileDisplay = this.state.shouldInjectMobileDisplay;\n      var displayMarkerInjected = false;\n      var renderedSections = article.sections.map(function (sectionItem, index) {\n        var shouldInject = shouldInjectMobileDisplay && sectionItem.type === \"text\" && !displayMarkerInjected;\n        var section = sectionItem;\n\n        if (shouldInject) {\n          try {\n            section = (0, _lodash.clone)(sectionItem);\n            section.body = _this4.injectDisplayPanelMarker(section.body);\n            displayMarkerInjected = true;\n          } catch (error) {\n            console.error(\"(reaction/Sections.jsx) Error injecting Display:\", error);\n          }\n        }\n\n        var child = _this4.getSection(section, index);\n\n        if (child) {\n          return _react.default.createElement(_SectionContainer.SectionContainer, {\n            key: index,\n            layout: section.layout,\n            articleLayout: article.layout,\n            type: section.type\n          }, child);\n        }\n      });\n      return renderedSections;\n    }\n  }, {\n    key: \"renderAuthors\",\n    value: function renderAuthors() {\n      var authors = this.props.article.authors;\n\n      if (authors) {\n        return _react.default.createElement(_SectionContainer.SectionContainer, {\n          type: \"author\"\n        }, _react.default.createElement(_Authors.Authors, {\n          authors: authors\n        }));\n      }\n    }\n  }, {\n    key: \"renderPostScript\",\n    value: function renderPostScript() {\n      var article = this.props.article;\n      var layout = article.layout,\n          postscript = article.postscript;\n\n      if (postscript) {\n        return _react.default.createElement(_SectionContainer.SectionContainer, {\n          type: \"text\"\n        }, _react.default.createElement(_Text.Text, {\n          html: postscript,\n          layout: layout,\n          postscript: Boolean(postscript)\n        }));\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var article = this.props.article;\n      return _react.default.createElement(StyledSections, {\n        layout: article.layout\n      }, this.renderSections(), this.renderAuthors(), this.renderPostScript());\n    }\n  }]);\n\n  return Sections;\n}(_react.Component);\n\nexports.Sections = Sections;\nObject.defineProperty(Sections, \"defaultProps\", {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  value: {\n    isMobile: false\n  }\n});\n\nvar chooseMargin = function chooseMargin(layout) {\n  if (layout === \"standard\") {\n    return \"0;\";\n  } else if (layout === \"feature\") {\n    return \"80px auto 0 auto;\";\n  }\n};\n\nvar div = _styledComponents.default.div;\nvar StyledSections = div(_templateObject, function (props) {\n  return chooseMargin(props.layout);\n}, function (props) {\n  return props.layout === \"standard\" ? \"780px\" : \"auto\";\n}, function (props) {\n  return _Helpers.pMedia.xl(_templateObject2, props.layout === \"standard\" ? \"680px\" : \"auto\", props.layout === \"feature\" ? \"margin: 80px auto 0 auto\" : \"\");\n}, function (props) {\n  return _Helpers.pMedia.md(_templateObject3, props.layout === \"standard\" ? \"780px\" : \"auto\");\n}, function (props) {\n  return _Helpers.pMedia.xs(_templateObject2, props.layout === \"standard\" ? \"780px\" : \"auto\", props.layout === \"feature\" ? \"margin: 30px auto 0 auto\" : \"\");\n});",{"version":3,"sources":["src/Components/Publishing/Sections/Sections.tsx"],"names":["MOBILE_DISPLAY_INJECT_INDEX","MOBILE_DISPLAY_INJECT_ID_PREFIX","Sections","shouldInjectMobileDisplay","props","article","layout","sections","firstText","findIndex","section","type","includes","lastText","isMobile","injectDisplayPanelMarker","setState","state","mountDisplayToMarker","prevProps","body","articleId","id","tag","updatedBody","split","map","p","reduce","arr","block","paragraphIndex","displayInjectId","concat","join","DisplayPanel","displayMountPoint","document","getElementById","render","console","error","index","showToolTips","showToolTipMarketData","image_collection","images","image_set","video","embed","text","getContentStartIndex","getContentEndIndex","default","sectionComponent","displayMarkerInjected","renderedSections","sectionItem","shouldInject","child","getSection","authors","postscript","Boolean","renderSections","renderAuthors","renderPostScript","chooseMargin","div","StyledSections","xl","md","xs"],"mappings":"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","file":"/Users/eve/development/reaction/src/Components/Publishing/Sections/Sections.tsx","sourceRoot":"/Users/eve/development/reaction","sourcesContent":["import { clone, compact, findLastIndex, once } from \"lodash\"\nimport React, { Component } from \"react\"\nimport ReactDOM from \"react-dom\"\nimport styled, { StyledFunction } from \"styled-components\"\nimport { pMedia } from \"../../Helpers\"\nimport { ArticleData } from \"../Typings\"\nimport { Authors } from \"./Authors\"\nimport { Embed } from \"./Embed\"\nimport { ImageCollection } from \"./ImageCollection\"\nimport { ImageSetPreview } from \"./ImageSetPreview\"\nimport { SectionContainer } from \"./SectionContainer\"\nimport { Text } from \"./Text\"\nimport { Video } from \"./Video\"\n\ninterface Props {\n  DisplayPanel?: any\n  article: ArticleData\n  isMobile?: boolean\n  showToolTips?: boolean\n  showToolTipMarketData?: boolean\n}\n\ninterface State {\n  shouldInjectMobileDisplay: boolean\n}\n\n/**\n * When isMobile, hide sidebar and inject DisplayAd into the body of the\n * article at a specific paragraph index.\n */\nconst MOBILE_DISPLAY_INJECT_INDEX = 1\nconst MOBILE_DISPLAY_INJECT_ID_PREFIX = \"__mobile_display_inject__\"\n\nexport class Sections extends Component<Props, State> {\n  static defaultProps = {\n    isMobile: false,\n  }\n\n  displayInjectId: string\n\n  state = {\n    shouldInjectMobileDisplay: false,\n  }\n\n  componentWillMount() {\n    const {\n      article: { layout },\n      isMobile,\n    } = this.props\n\n    this.injectDisplayPanelMarker = once(this.injectDisplayPanelMarker)\n    const shouldInjectMobileDisplay = isMobile && layout !== \"feature\"\n\n    this.setState({\n      shouldInjectMobileDisplay,\n    })\n  }\n\n  componentDidMount() {\n    if (this.state.shouldInjectMobileDisplay) {\n      this.mountDisplayToMarker()\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    const { isMobile } = this.props\n\n    if (prevProps.isMobile !== isMobile) {\n      this.setState(\n        {\n          shouldInjectMobileDisplay: isMobile,\n        },\n        () => {\n          if (isMobile && this.state.shouldInjectMobileDisplay) {\n            this.mountDisplayToMarker()\n          }\n        }\n      )\n    }\n  }\n\n  /**\n   * Inject DisplayAd after a specific paragraph index\n   */\n  injectDisplayPanelMarker(body) {\n    const articleId = this.props.article.id\n    const tag = \"</p>\"\n    const updatedBody = compact(body.split(tag))\n      .map(p => p + tag)\n      .reduce((arr, block, paragraphIndex) => {\n        if (paragraphIndex === MOBILE_DISPLAY_INJECT_INDEX) {\n          this.displayInjectId = `${MOBILE_DISPLAY_INJECT_ID_PREFIX}${articleId}`\n          return arr.concat([block, `<div id=\"${this.displayInjectId}\"></div>`])\n        } else {\n          return arr.concat([block])\n        }\n      }, [])\n      .join(\"\")\n\n    return updatedBody\n  }\n\n  mountDisplayToMarker() {\n    const { DisplayPanel } = this.props\n    const displayMountPoint = document.getElementById(this.displayInjectId)\n\n    if (displayMountPoint) {\n      ReactDOM.render(<DisplayPanel />, displayMountPoint)\n    } else {\n      console.error(\n        \"(reaction/Sections.tsx) Error mounting Display: DOM node \",\n        \"not found\",\n        displayMountPoint\n      )\n    }\n  }\n\n  getContentStartIndex = () => {\n    const {\n      article: { layout, sections },\n    } = this.props\n\n    if (layout === \"feature\") {\n      const firstText = sections.findIndex(section => {\n        return section.type === \"text\"\n      })\n      return firstText\n    }\n  }\n\n  getContentEndIndex = () => {\n    const {\n      article: { layout, sections },\n    } = this.props\n\n    if ([\"feature\", \"standard\"].includes(layout)) {\n      const lastText = findLastIndex(sections, section => {\n        return section.type === \"text\"\n      })\n      return lastText\n    }\n  }\n\n  getSection(section, index) {\n    const { article, showToolTips, showToolTipMarketData } = this.props\n\n    const sections = {\n      image_collection: (\n        <ImageCollection\n          sectionLayout={section.layout}\n          articleLayout={article.layout}\n          images={section.images}\n          targetHeight={500}\n          gutter={10}\n        />\n      ),\n      image_set: <ImageSetPreview section={section} />,\n      video: <Video section={section} />,\n      embed: <Embed section={section} />,\n      text: (\n        <Text\n          html={section.body}\n          layout={article.layout}\n          isContentStart={index === this.getContentStartIndex()}\n          isContentEnd={index === this.getContentEndIndex()}\n          showToolTips={showToolTips}\n          showToolTipMarketData={showToolTipMarketData}\n        />\n      ),\n      default: false,\n    }\n\n    const sectionComponent = sections[section.type] || sections.default\n    return sectionComponent\n  }\n\n  renderSections() {\n    const { article } = this.props\n    const { shouldInjectMobileDisplay } = this.state\n    let displayMarkerInjected = false\n\n    const renderedSections = article.sections.map((sectionItem, index) => {\n      const shouldInject =\n        shouldInjectMobileDisplay &&\n        sectionItem.type === \"text\" &&\n        !displayMarkerInjected\n\n      let section = sectionItem\n\n      if (shouldInject) {\n        try {\n          section = clone(sectionItem)\n          section.body = this.injectDisplayPanelMarker(section.body)\n          displayMarkerInjected = true\n        } catch (error) {\n          console.error(\n            \"(reaction/Sections.jsx) Error injecting Display:\",\n            error\n          )\n        }\n      }\n\n      const child = this.getSection(section, index)\n\n      if (child) {\n        return (\n          <SectionContainer\n            key={index}\n            layout={section.layout}\n            articleLayout={article.layout}\n            type={section.type}\n          >\n            {child}\n          </SectionContainer>\n        )\n      }\n    })\n\n    return renderedSections\n  }\n\n  renderAuthors() {\n    const {\n      article: { authors },\n    } = this.props\n\n    if (authors) {\n      return (\n        <SectionContainer type=\"author\">\n          <Authors authors={authors} />\n        </SectionContainer>\n      )\n    }\n  }\n\n  renderPostScript() {\n    const { article } = this.props\n    const { layout, postscript } = article\n\n    if (postscript) {\n      return (\n        <SectionContainer type=\"text\">\n          <Text\n            html={postscript}\n            layout={layout}\n            postscript={Boolean(postscript)}\n          />\n        </SectionContainer>\n      )\n    }\n  }\n\n  render() {\n    const { article } = this.props\n\n    return (\n      <StyledSections layout={article.layout}>\n        {this.renderSections()}\n        {this.renderAuthors()}\n        {this.renderPostScript()}\n      </StyledSections>\n    )\n  }\n}\n\nconst chooseMargin = layout => {\n  if (layout === \"standard\") {\n    return \"0;\"\n  } else if (layout === \"feature\") {\n    return \"80px auto 0 auto;\"\n  }\n}\n\nconst div: StyledFunction<{ layout: string }> = styled.div\nconst StyledSections = div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  width: 100%;\n  margin: ${props => chooseMargin(props.layout)}\n  max-width: ${props => (props.layout === \"standard\" ? \"780px\" : \"auto\")};\n\n  ${props => pMedia.xl`\n    max-width: ${props.layout === \"standard\" ? \"680px\" : \"auto\"};\n    ${props.layout === \"feature\" ? \"margin: 80px auto 0 auto\" : \"\"}\n  `}\n\n  ${props => pMedia.md`\n    max-width: ${props.layout === \"standard\" ? \"780px\" : \"auto\"};\n  `}\n  ${props => pMedia.xs`\n    max-width: ${props.layout === \"standard\" ? \"780px\" : \"auto\"};\n    ${props.layout === \"feature\" ? \"margin: 30px auto 0 auto\" : \"\"}\n  `}\n`\n"]}]}